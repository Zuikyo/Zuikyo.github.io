<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="zuik's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="ğŸ¼">
<meta property="og:type" content="website">
<meta property="og:title" content="zuik's blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="zuik's blog">
<meta property="og:description" content="ğŸ¼">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zuik's blog">
<meta name="twitter:description" content="ğŸ¼">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'åšä¸»'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> zuik's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">zuik's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">å†™ç‚¹åˆ«äººæ²¡å†™è¿‡çš„</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/11/iOS VIPERæ¶æ„å®è·µ(äºŒ)ï¼šVIPERè¯¦è§£ä¸å®ç°/" itemprop="url">
                  iOS VIPERæ¶æ„å®è·µ(äºŒ)ï¼šVIPERè¯¦è§£ä¸å®ç°
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2017-08-11T16:55:29+08:00" content="2017-08-11">
              2017-08-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ä»£ç æ¶æ„/" itemprop="url" rel="index">
                    <span itemprop="name">ä»£ç æ¶æ„</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/08/11/iOS VIPERæ¶æ„å®è·µ(äºŒ)ï¼šVIPERè¯¦è§£ä¸å®ç°/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/11/iOS VIPERæ¶æ„å®è·µ(äºŒ)ï¼šVIPERè¯¦è§£ä¸å®ç°/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ç¬¬ä¸€ç¯‡æ–‡ç« å¯¹VIPERè¿›è¡Œäº†ç®€å•çš„ä»‹ç»ï¼Œè¿™ç¯‡æ–‡ç« å°†ä»VIPERçš„æºå¤´å¼€å§‹ï¼Œæ¯”è¾ƒç°æœ‰çš„å‡ ç§VIPERå®ç°ï¼Œå¯¹VIPERè¿›è¡Œè¿›ä¸€æ­¥çš„èŒè´£å‰–æï¼Œå¹¶å¯¹å„ç§ç»†èŠ‚å®ç°é—®é¢˜è¿›è¡ŒæŒ–æ˜å’Œæ¢è®¨ã€‚æœ€åç»™å‡ºä¸¤ä¸ªå®Œæ•´çš„VIPERå®ç°ï¼Œå¹¶ä¸”æä¾›å¿«é€Ÿç”ŸæˆVIPERä»£ç çš„æ¨¡æ¿ã€‚</p>
<p>ä¸¤ä¸ªå®ç°å±•ç¤ºäº†ä»¥ä¸‹é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>å¦‚ä½•å½»åº•åœ°è§£å†³ä¸åŒæ¨¡å—ä¹‹é—´çš„è€¦åˆ</li>
<li>å¦‚ä½•åœ¨ä¸€ä¸ªæ¨¡å—é‡Œå¼•å…¥å­æ¨¡å—</li>
<li>å­æ¨¡å—å’Œçˆ¶æ¨¡å—ä¹‹é—´å¦‚ä½•é€šä¿¡</li>
<li>å¦‚ä½•å¯¹æ¨¡å—è¿›è¡Œä¾èµ–æ³¨å…¥</li>
<li>é¢å‘æ¥å£çš„è·¯ç”±å·¥å…·</li>
</ul>
<h2 id="èµ·æº"><a href="#èµ·æº" class="headerlink" title="èµ·æº"></a>èµ·æº</h2><p>VIPERæ¶æ„ï¼Œæœ€åˆæ˜¯2013å¹´åœ¨MutualMobileçš„æŠ€æœ¯åšå®¢ä¸Šï¼Œç”±Jeff Gilbert å’Œ Conrad Stoll æå‡ºçš„ã€‚ä»–ä»¬çš„åšå®¢ç½‘ç«™æœ‰è¿‡ä¸€æ¬¡è¿ç§»ï¼ŒåŸæ–‡åœ°å€å·²ç»å¤±æ•ˆï¼Œè¿™æ˜¯è¿ç§»åçš„åšæ–‡ï¼š<a href="https://mutualmobile.com/posts/meet-viper-fast-agile-non-lethal-ios-architecture-framework" target="_blank" rel="external">MEET VIPER: MUTUAL MOBILEâ€™S APPLICATION OF CLEAN ARCHITECTURE FOR IOS APPS</a>ã€‚</p>
<p>è¿™æ˜¯æ–‡ç« ä¸­æå‡ºçš„æ¶æ„ç¤ºæ„å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-13daad61ed8db39c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="viper_mutualmobile"></p>
<p>Wireframeå¯ä»¥çœ‹ä½œæ˜¯Routerçš„å¦ä¸€ç§è¡¨è¾¾ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒVIPERä¹‹é—´çš„å…³ç³»å·²ç»å¾ˆæ˜ç¡®äº†ã€‚ä¹‹åï¼Œä½œè€…åœ¨2014å¹´åœ¨objc.ioä¸Šå‘è¡¨äº†å¦ä¸€ç¯‡æ›´è¯¦ç»†çš„ä»‹ç»æ–‡ç« ï¼š<a href="https://www.objc.io/issues/13-architecture/viper/" target="_blank" rel="external">Architecting iOS Apps with VIPER</a>ã€‚</p>
<p>åœ¨ä½œè€…çš„ç¬¬ä¸€ç¯‡æ–‡ç« é‡Œï¼Œé˜è¿°äº†VIPERæ˜¯åœ¨æ¥è§¦åˆ°äº†Uncle Bobçš„<a href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html" target="_blank" rel="external">Clean Architecture</a>åï¼Œå¯¹Clean Architectureçš„ä¸€æ¬¡å®è·µã€‚å› æ­¤ï¼ŒVIPERçœŸæ­£çš„æºå¤´åº”è¯¥æ˜¯Clean Architectureã€‚</p>
<h2 id="Clean-Architecture"><a href="#Clean-Architecture" class="headerlink" title="Clean Architecture"></a>Clean Architecture</h2><p>ç”±Uncle Bobåœ¨2011å¹´æå‡ºçš„<code>Clean Architecture</code>ï¼Œæ˜¯ä¸€ä¸ªå¹³å°æ— å…³çš„æŠ½è±¡æ¶æ„ã€‚æƒ³è¦è¯¦ç»†å­¦ä¹ çš„ï¼Œå¯ä»¥é˜…è¯»ä½œè€…çš„åŸæ–‡ï¼š<a href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html" target="_blank" rel="external">Clean Architecture</a>ï¼Œç¿»è¯‘ï¼š<a href="http://www.jdon.com/artichect/the-clean-architecture.html" target="_blank" rel="external">å¹²å‡€çš„æ¶æ„The Clean Architecture</a>ã€‚</p>
<p>å®ƒé€šè¿‡æ¢³ç†è½¯ä»¶ä¸­ä¸åŒå±‚ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæå‡ºäº†ä¸€ä¸ªè‡ªå¤–å‘å†…ï¼Œå•å‘ä¾èµ–çš„æ¶æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-dda97ce26c973609.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Clean Architecture"></p>
<p>è¶Šé è¿‘å†…å±‚ï¼Œè¶Šå˜å¾—æŠ½è±¡ï¼Œè¶Šæ¥è¿‘è®¾è®¡çš„æ ¸å¿ƒã€‚è¶Šé è¿‘å¤–å±‚ï¼Œè¶Šå’Œå…·ä½“çš„å¹³å°å’Œå®ç°æŠ€æœ¯ç›¸å…³ã€‚å†…å±‚çš„éƒ¨åˆ†å®Œå…¨ä¸çŸ¥é“å¤–å±‚çš„å­˜åœ¨å’Œå®ç°æ–¹å¼ï¼Œä»£ç åªèƒ½ä»å¤–å±‚å‘å†…å±‚å¼•ç”¨ï¼Œç›®çš„æ˜¯ä¸ºäº†å®ç°å±‚ä¸å±‚ä¹‹é—´çš„éš”ç¦»ã€‚å°†ä¸åŒæŠ½è±¡ç¨‹åº¦çš„å±‚è¿›è¡Œéš”ç¦»ï¼Œåšåˆ°äº†æŠŠä¸šåŠ¡è§„åˆ™å’Œå…·ä½“å®ç°åˆ†ç¦»å¼€ã€‚ä½ å¯ä»¥æŠŠå¤–å±‚çœ‹ä½œæ˜¯å†…å±‚çš„delegateï¼Œå¤–å±‚åªèƒ½é€šè¿‡å†…å±‚æä¾›çš„delegateæ¥å£æ¥ä½¿ç”¨å†…å±‚ã€‚</p>
<h3 id="Enterprise-Business-Rules"><a href="#Enterprise-Business-Rules" class="headerlink" title="Enterprise Business Rules"></a>Enterprise Business Rules</h3><p>ä»£è¡¨äº†è¿™ä¸ªè½¯ä»¶é¡¹ç›®çš„ä¸šåŠ¡è§„åˆ™ã€‚ç”±æ•°æ®å®ä½“ä½“ç°ï¼Œæ˜¯ä¸€äº›å¯ä»¥åœ¨ä¸åŒçš„ç¨‹åºåº”ç”¨ä¹‹é—´å…±äº«çš„æ•°æ®ç»“æ„ã€‚</p>
<h3 id="Application-Business-Rules"><a href="#Application-Business-Rules" class="headerlink" title="Application Business Rules"></a>Application Business Rules</h3><p>ä»£è¡¨äº†æœ¬åº”ç”¨æ‰€ä½¿ç”¨çš„ä¸€äº›ä¸šåŠ¡è§„åˆ™ã€‚å°è£…å’Œå®ç°äº†ç”¨åˆ°çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œä¼šå°†å„ç§å®ä½“çš„æ•°æ®ç»“æ„è½¬ä¸ºåœ¨ç”¨ä¾‹ä¸­ä¼ é€’çš„å®ä½“ç±»ï¼Œä½†æ˜¯å’Œå…·ä½“çš„æ•°æ®åº“æŠ€æœ¯æˆ–è€…UIæ— å…³ã€‚</p>
<h3 id="Interface-Adapters"><a href="#Interface-Adapters" class="headerlink" title="Interface Adapters"></a>Interface Adapters</h3><p>æ¥å£é€‚é…å±‚ã€‚å°†ç”¨ä¾‹çš„è§„åˆ™å’Œå…·ä½“çš„å®ç°æŠ€æœ¯è¿›è¡ŒæŠ½è±¡åœ°å¯¹æ¥ï¼Œå°†ç”¨ä¾‹ä¸­ç”¨åˆ°çš„å®ä½“ç±»è½¬ä¸ºä¾›æ•°æ®åº“å­˜å‚¨çš„æ ¼å¼æˆ–è€…ä¾›Viewå±•ç¤ºçš„æ ¼å¼ã€‚ç±»ä¼¼äºMVVMä¸­æŠŠModelçš„æ•°æ®ä¼ é€’ç»™ViewModelä¾›Viewæ˜¾ç¤ºã€‚</p>
<p>å³ä¸‹è§’è¡¨ç¤ºäº†æ¥å£é€‚é…å±‚ä¸­ä¸åŒæ¨¡å—é—´çš„é€šä¿¡æ–¹å¼ã€‚ä¸åŒçš„æ¨¡å—åœ¨ä¸šåŠ¡ç”¨ä¾‹ä¸­äº§ç”Ÿå…³è”å’Œæ•°æ®ä¼ é€’ã€‚Inputã€Outputå°±æ˜¯Use Caseæä¾›ç»™å¤–å±‚çš„æ•°æ®æµåŠ¨æ¥å£ã€‚</p>
<h3 id="Frameworks-amp-Drivers"><a href="#Frameworks-amp-Drivers" class="headerlink" title="Frameworks &amp; Drivers"></a>Frameworks &amp; Drivers</h3><p>åº“å’Œé©±åŠ¨å±‚ï¼Œä»£è¡¨äº†é€‰ç”¨çš„å„ç§å…·ä½“çš„å®ç°æŠ€æœ¯ï¼Œä¾‹å¦‚æŒä¹…å±‚ä½¿ç”¨SQLiteè¿˜æ˜¯Core Dataï¼Œç½‘ç»œå±‚ä½¿ç”¨NSURLSessionã€NSURLConnectionè¿˜æ˜¯AFNetworkingç­‰ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¯ä»¥çœ‹åˆ°ï¼ŒClean Architectureé‡Œå·²ç»å‡ºç°äº†Use Caseã€Interactorã€Presenterç­‰æ¦‚å¿µï¼Œå®ƒä¸ºVIPERçš„å·¥ç¨‹å®ç°æä¾›äº†è®¾è®¡æ€æƒ³ï¼ŒVIPERå°†å®ƒçš„è®¾è®¡è½¬åŒ–æˆäº†å…·ä½“çš„å®ç°ã€‚VIPERé‡Œçš„å„éƒ¨åˆ†æ­£æ˜¯å­˜åœ¨ç€ç”±å¤–å‘å†…çš„ä¾èµ–ï¼Œä»å¤–å‘å†…è¡¨ç°ä¸ºï¼š<code>View -&gt; Presenter -&gt; Interactor -&gt; Entity</code>ï¼Œ<code>Wireframe</code>ä¸¥æ ¼æ¥è¯´ä¹Ÿæ˜¯ä¸€ç±»ç‰¹æ®Šçš„Use Caseï¼Œç”¨äºä¸åŒæ¨¡å—ä¹‹é—´é€šä¿¡ï¼Œè¿æ¥äº†ä¸åŒçš„<code>Presenter</code>ã€‚</p>
<p>å¿…é¡»è¦è®°ä½çš„æ˜¯ï¼Œ<strong>VIPERæ¶æ„æ˜¯æ ¹æ®ç”±å¤–å‘å†…çš„ä¾èµ–å…³ç³»æ¥è®¾è®¡çš„</strong>ã€‚è¿™å¥è¯æ˜¯æŒ‡å¯¼æˆ‘ä»¬è¿›è¡Œè¿›ä¸€æ­¥è®¾è®¡å’Œä¼˜åŒ–çš„å…³é”®ã€‚</p>
<h2 id="ç°æœ‰çš„å„ç§VIPERå®ç°"><a href="#ç°æœ‰çš„å„ç§VIPERå®ç°" class="headerlink" title="ç°æœ‰çš„å„ç§VIPERå®ç°"></a>ç°æœ‰çš„å„ç§VIPERå®ç°</h2><p>MutualMobileçš„é‚£ä¸¤ç¯‡æ–‡ç« è™½ç„¶å·²ç»æ˜ç¡®äº†VIPERå„éƒ¨åˆ†ä¹‹é—´çš„èŒè´£ï¼Œå¹¶ä¸”ç»™å‡ºäº†ç®€å•çš„Demoï¼Œä½†æ˜¯å¯¹Wireframeéƒ¨åˆ†çš„å®ç°æœ‰äº›äº‰è®®ï¼Œè§£è€¦åšå¾—ä¸å¤Ÿå½»åº•ï¼Œå¹¶ä¸”å¯¹å„å±‚ä¹‹é—´å¦‚ä½•äº¤äº’è¿˜å¤„åœ¨æœ€ç®€å•çš„å®ç°ä¸Šã€‚ä¹‹åå‡ºç°äº†æŒºå¤šæ–‡ç« æ¥å°†VIPERè¿›ä¸€æ­¥ç»†åŒ–ï¼Œä¸è¿‡æŸäº›ç»†èŠ‚çš„å®ç°ä¸Šæœ‰äº›å·®åˆ«ï¼Œåœ¨ç»™å‡ºæˆ‘è‡ªå·±çš„VIPERä¹‹å‰ï¼Œæˆ‘å°†å…ˆå¯¹è¿™äº›å®ç°è¿›è¡Œä¸€æ¬¡ç»¼åˆçš„æ¯”è¾ƒåˆ†æï¼Œçœ‹çœ‹ä»–ä»¬éƒ½ä½¿ç”¨äº†å“ªäº›æŠ€æœ¯ï¼Œé‡åˆ°äº†å“ªäº›äº‰è®®ç‚¹ã€‚ä¸åŒå®ç°ä¹‹é—´å·²ç»å…¬è®¤çš„åœ°æ–¹æˆ‘å°±ä¸å†å•ç‹¬åˆ—å‡ºäº†ã€‚</p>
<h3 id="Brigadeå›¢é˜Ÿçš„å®ç°"><a href="#Brigadeå›¢é˜Ÿçš„å®ç°" class="headerlink" title="Brigadeå›¢é˜Ÿçš„å®ç°"></a>Brigadeå›¢é˜Ÿçš„å®ç°</h3><p>åŸæ–‡åœ°å€ï¼š<a href="https://brigade.engineering/brigades-experience-using-an-mvc-alternative-36ef1601a41f" target="_blank" rel="external">Brigadeâ€™s Experience Using an MVC Alternative: VIPER architecture for iOS applications</a>ã€‚</p>
<p>æ–‡ç« æŠŠVIPERçš„ä¼˜ç‚¹æ€»ç»“äº†ä¸€ä¸‹ï¼Œæå‡ºäº†è¿™æ ·çš„æ¶æ„å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-76a4f532c58da061.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Brigadeâ€™s VIPER"></p>
<p>ä»–ä»¬å¯¹VIPERçš„å„éƒ¨åˆ†éƒ½æ²¡æœ‰å¼‚è®®ï¼Œåªæ˜¯å¯¹Interactorçš„å®ç°è¿›è¡Œäº†è¿›ä¸€æ­¥ç»†åŒ–ã€‚ç”¨ä¸€ä¸ªData Manageræä¾›ç»™å„ä¸ªUse Caseç®¡ç†Entityï¼Œæ¯”å¦‚è·å–ã€å­˜å‚¨åŠŸèƒ½ã€‚åœ¨Serviceä¸­è°ƒç”¨ç½‘ç»œå±‚å»è·å–æœåŠ¡ç«¯çš„æ•°æ®ã€‚</p>
<p>æ–‡ç« ä¸­è¿˜è®¤ä¸ºåº”è¯¥ç”±Wireframeè´Ÿè´£åˆå§‹åŒ–æ•´ä¸ªVIPERï¼Œç”Ÿæˆå„éƒ¨åˆ†çš„ç±»ï¼Œå¹¶è®¾ç½®ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”å¼•ç”¨å¦ä¸€ä¸ªæ¨¡å—çš„Wireframeï¼Œè´Ÿè´£è·³è½¬åˆ°å¦ä¸€ä¸ªç•Œé¢ã€‚</p>
<p>å’Œè¿™ä¸ªå®ç°ç±»ä¼¼çš„è¿˜æœ‰ï¼š</p>
<ul>
<li><a href="https://swifting.io/blog/2016/03/07/8-viper-to-be-or-not-to-be/" target="_blank" rel="external">VIPER to be or not to be?</a>ã€‚è¿™ç¯‡æ–‡ç« é‡Œç»™å‡ºäº†ä¸€ä¸ªUnit Testçš„ä¾‹å­ï¼Œè¿˜æ¢è®¨äº†åº”è¯¥åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å¼€å§‹åº”ç”¨VIPERã€‚</li>
<li><a href="https://cheesecakelabs.com/blog/best-practices-viper-architecture/" target="_blank" rel="external">VIPER architecture: Our best practices to build an app like a boss</a>ã€‚Demoåœ°å€ï¼š<a href="https://github.com/CheesecakeLabs/Boilerplate_iOS_VIPER" target="_blank" rel="external">Boilerplate_iOS_VIPER</a>ã€‚</li>
</ul>
<p>é’ˆå¯¹VIPERéœ€è¦ç¼–å†™å¤ªå¤šåˆå§‹åŒ–ä»£ç çš„éº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨Xcodeè‡ªå¸¦çš„Templateè§£å†³ã€‚è€Œå¾ˆå¤šä½œè€…éƒ½æåˆ°äº†ä¸€ä¸ªä»£ç ç”Ÿæˆå·¥å…·ï¼š<a href="https://github.com/rambler-digital-solutions/Generamba" target="_blank" rel="external">Generamba</a>ã€‚</p>
<h4 id="äº‰è®®"><a href="#äº‰è®®" class="headerlink" title="äº‰è®®"></a>äº‰è®®</h4><p>æ–‡ç« å¹¶æ²¡æœ‰å¯¹VIPERè¿›è¡Œä¿®æ”¹ï¼Œåªæ˜¯è¿›ä¸€æ­¥ç»†åŒ–äº†ã€‚è¿™åº”è¯¥æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„å®ç°ã€‚å¦‚æœä½ è¦å®æ–½VIPERï¼Œå‚ç…§è¿™ç¯‡æ–‡ç« æ¥æ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†æ˜¯å®ƒæ²¡æœ‰æ¢è®¨çš„é—®é¢˜æ˜¯ï¼š</p>
<ul>
<li>å¦‚ä½•è§£å†³ä¸åŒWrieframeä¹‹é—´çš„è€¦åˆï¼Ÿ</li>
<li>Wrieframeå¦‚ä½•çŸ¥é“å…¶ä»–æ¨¡å—éœ€è¦çš„åˆå§‹åŒ–å‚æ•°ï¼Ÿ</li>
<li>åœ¨æ¨¡å—é—´é€šä¿¡æ—¶ï¼ŒInteractorçš„æ•°æ®å¦‚ä½•ä¼ é€’ç»™å¦ä¸€ä¸ªæ¨¡å—ï¼Ÿ</li>
<li>çˆ¶æ¨¡å—å’Œå­æ¨¡å—ä¹‹é—´æ˜¯æ€æ ·çš„å…³ç³»ï¼Ÿ</li>
</ul>
<h3 id="Rambler-amp-Coå›¢é˜Ÿçš„å®ç°"><a href="#Rambler-amp-Coå›¢é˜Ÿçš„å®ç°" class="headerlink" title="Rambler&amp;Coå›¢é˜Ÿçš„å®ç°"></a>Rambler&amp;Coå›¢é˜Ÿçš„å®ç°</h3><p>ä¸€ä¸ªå¯¹VIPERååˆ†æ„Ÿå…´è¶£çš„ä¿„å›½å›¢é˜Ÿï¼Œç¼–å†™äº†ä¸€æœ¬å…³äºVIPERçš„ä¹¦ï¼š<a href="https://github.com/strongself/The-Book-of-VIPER" target="_blank" rel="external">The-Book-of-VIPER</a>ã€‚å¹¶ä¸”ç»™å‡ºäº†ä¸€ä¸ªç›®å‰ç½‘ç»œä¸Šå®ç°å®Œæˆåº¦æœ€é«˜çš„å¼€æºDemoï¼š<a href="https://github.com/rambler-digital-solutions/rambler-it-ios" target="_blank" rel="external">rambler-it-ios</a>ï¼Œä»¥åŠä»–ä»¬ç”¨äºå®æ–½VIPERçš„åº“ï¼š<a href="https://github.com/rambler-digital-solutions/ViperMcFlurry" target="_blank" rel="external">ViperMcFlurry</a>ã€‚</p>
<p>ä»–ä»¬æ•´ç†çš„VIPERæ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-9f35c09e9c9b0f12.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Rambler&amp;Co&#39;s VIPER"></p>
<p>å’Œå…¶ä»–å®ç°ä¸åŒçš„æ˜¯ï¼Œä»–ä»¬æŠŠVIPERçš„åˆå§‹åŒ–å’Œè£…é…å·¥ä½œå•ç‹¬æ”¾åˆ°äº†ä¸€ä¸ªAssemblyé‡Œï¼ŒRouteråªåšç•Œé¢è·³è½¬çš„å·¥ä½œã€‚å¹¶ä¸”æŠŠVIPERå†…ä¸åŒéƒ¨åˆ†ä¹‹é—´çš„é€šä¿¡ç»Ÿä¸€ç”¨Inputå’ŒOutputæ¥è¡¨ç¤ºã€‚Inputè¡¨ç¤ºå¤–éƒ¨ä¸»åŠ¨è°ƒç”¨æ¨¡å—æä¾›çš„æ¥å£ï¼ŒOutputè¡¨ç¤ºæ¨¡å—é€šè¿‡å¤–éƒ¨å®ç°æ‰€è¦æ±‚çš„æ¥å£ï¼Œå°†äº‹ä»¶ä¼ é€’åˆ°å¤–éƒ¨ã€‚</p>
<p>ä¹‹æ‰€ä»¥å°†æ¨¡å—åˆå§‹åŒ–å•ç‹¬æ”¾åˆ°Assemblyé‡Œï¼Œæ˜¯å› ä¸ºRouterå¦‚æœè´Ÿè´£åˆå§‹åŒ–æœ¬æ¨¡å—ï¼Œä¼šè¿èƒŒå•ä¸€èŒè´£åŸåˆ™ã€‚</p>
<h4 id="äº‰è®®-1"><a href="#äº‰è®®-1" class="headerlink" title="äº‰è®®"></a>äº‰è®®</h4><p>è¿™ä¸ªå®ç°çš„æ„¿æ™¯å¾ˆå¥½ï¼Œåªæ˜¯åœ¨è½¬å˜ä¸ºå…·ä½“å®ç°çš„æ—¶å€™ä¸å¤Ÿå®Œç¾ï¼Œæœ‰å¾ˆå¤šé—®é¢˜å°šå¾…è§£å†³ã€‚å…·ä½“å¯ä»¥å‚è§Demoã€‚</p>
<ul>
<li>Assemblyä½¿ç”¨äº†<a href="https://github.com/appsquickly/Typhoon" target="_blank" rel="external">Typhoon</a>è¿™ä¸ªä¾èµ–æ³¨å…¥å·¥å…·ï¼Œé€šè¿‡Method Swizzlingè‡ªåŠ¨åˆå§‹åŒ–VIPERçš„å„ä¸ªéƒ¨åˆ†</li>
</ul>
<p>æˆ‘å¯¹Typhoonè¿™ä¸ªä¾èµ–æ³¨å…¥å·¥å…·ä¸æ˜¯ç‰¹åˆ«æ„Ÿå†’ï¼Œå®ƒä½¿ç”¨äº†ååˆ†å¤æ‚çš„run timeæŠ€æœ¯ï¼Œæƒ³è¦è¿½è¸ªä¸€ä¸ªå¯¹è±¡çš„æ³¨å…¥è¿‡ç¨‹æ—¶ï¼Œä¼šçœ‹å¾—æ™•å¤´è½¬å‘ã€‚è€Œä¸”å®ƒæ— æ³•å®ç°è¿è¡Œæ—¶ç”±è°ƒç”¨æ–¹åŠ¨æ€æ³¨å…¥ï¼Œåªèƒ½å®ç°é¢„å®šä¹‰å¥½çš„é™æ€æ³¨å…¥ã€‚ä¹Ÿå°±æ˜¯ä¸èƒ½åŠ¨æ€ä¼ å‚ã€‚</p>
<ul>
<li>ä½¿ç”¨storyboardè¿›è¡Œè·¯ç”±</li>
</ul>
<p>åœ¨Demoä¸­å®ç°äº†åœ¨æ‰§è¡Œsegueæ—¶ç”¨blockæ¥ä½¿ç”¨<code>-prepareForSegue:sender:</code>ï¼Œå®ç°å‘ç›®çš„ç•Œé¢ä¼ å‚ï¼Œå®ç°äº†åŠ¨æ€æ³¨å…¥ã€‚ä½†æ˜¯è¿™æ ·å°±æŠŠè·¯ç”±é™å®šåœ¨äº†storyboardçš„segueæŠ€æœ¯ä¸Šï¼Œé‚£ä¹ˆå¯¹äºé‚£äº›æ²¡æœ‰ä½¿ç”¨storyboardçš„é¡¹ç›®åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸDemoå¹¶æ²¡æœ‰ç»™å‡ºç­”æ¡ˆã€‚è€Œä¸”<code>-prepareForSegue:sender:</code>åªèƒ½å‘Viewä¼ å‚ï¼Œä½†æ˜¯æœ‰ä¸€äº›å‚æ•°æ˜¯Viewä¸åº”è¯¥æ¥è§¦åˆ°çš„ï¼Œè€Œæ˜¯åº”è¯¥ç›´æ¥ä¼ ç»™Presenteræˆ–è€…Interactorçš„ã€‚</p>
<ul>
<li>æœ‰æ—¶å€™æ¨¡å—éœ€è¦ä»Outputä¸­è·å–æ•°æ®ï¼Œä¾‹å¦‚Presenterä¸»åŠ¨è·å–Viewä¸­çš„æ–‡å­—ï¼Œä¼ é€’ç»™Interactorï¼Œæ­¤æ—¶<code>Output</code>å¹¶ä¸èƒ½å®Œæ•´æè¿°å®ƒçš„èŒè´£ï¼Œè¿˜å¯ä»¥å†è¿›ä¸€æ­¥åˆ’åˆ†</li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä»¬çš„æ–¹æ¡ˆåœ¨è®¾è®¡ä¸Šæ˜¯ä¸é”™çš„ï¼Œä½†åœ¨æŠ€æœ¯ä¸Šè¿˜æœ‰å¾ˆå¤šæ”¹è¿›ç©ºé—´ã€‚</p>
<h3 id="Uberå›¢é˜Ÿçš„å®ç°"><a href="#Uberå›¢é˜Ÿçš„å®ç°" class="headerlink" title="Uberå›¢é˜Ÿçš„å®ç°"></a>Uberå›¢é˜Ÿçš„å®ç°</h3><p>Uberç”±äºä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚ï¼Œæ—§é¡¹ç›®çš„æ¶æ„å·²ç»æ— æ³•æ»¡è¶³å½“å‰çš„éœ€æ±‚ï¼Œå› æ­¤åœ¨2016å¹´å®Œå…¨é‡æ„äº†ä»–ä»¬çš„ rider appã€‚ä»–ä»¬å€Ÿé‰´VIPERï¼Œå¹¶ä¸”è®¾è®¡å‡ºäº†ä¸€ä¸ªVIPERçš„å˜ç§æ¶æ„ï¼šRibletsã€‚æ–‡ç« åœ°å€ï¼š<a href="https://eng.uber.com/new-rider-app/" target="_blank" rel="external">ENGINEERING THE ARCHITECTURE BEHIND UBERâ€™S NEW RIDER APP</a>ã€‚</p>
<p>æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-ad4602f11ed62094.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="riblets"></p>
<p>æ•°æ®æµå‘å›¾ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-bdb29d6717472b5b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="riblets_æ•°æ®æµå‘"></p>
<p>çˆ¶æ¨¡å—å’Œå­æ¨¡å—ä¹‹é—´é€šä¿¡ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-e71eed65c555ddc5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="riblet_çˆ¶å­æ¨¡å—é—´é€šä¿¡"></p>
<h4 id="å„éƒ¨åˆ†èŒè´£"><a href="#å„éƒ¨åˆ†èŒè´£" class="headerlink" title="å„éƒ¨åˆ†èŒè´£"></a>å„éƒ¨åˆ†èŒè´£</h4><p>è¿™é‡Œåªåˆ—å‡ºä¸€äº›å’ŒVIPERæœ‰å·®å¼‚çš„åœ°æ–¹ï¼š</p>
<ul>
<li>Builderè´Ÿè´£åˆå§‹åŒ–Ribletsæ¨¡å—å†…çš„å„ä¸ªéƒ¨åˆ†ï¼Œå®šä¹‰äº†æ¨¡å—çš„ä¾èµ–å‚æ•°</li>
<li>Componentè´Ÿè´£è·å–å’Œåˆå§‹åŒ–é‚£äº›ä¸æ˜¯Ribletsæ¨¡å—å†…çš„éƒ¨åˆ†ï¼Œä¾‹å¦‚servicesï¼Œå¹¶æ³¨å…¥åˆ°Interactorä¸­</li>
<li>Routerè´Ÿè´£ç®¡ç†å­æ¨¡å—ï¼ŒæŒæœ‰å­æ¨¡å—çš„Routerï¼Œå¹¶æŠŠå­æ¨¡å—çš„Viewæ·»åŠ åˆ°è§†å›¾æ ‘ä¸Š</li>
<li>Interactoré€šè¿‡è°ƒç”¨Serviceç®¡ç†Modelï¼Œè€Œä¸æ˜¯åœ¨Interactorä¸­ç›´æ¥ç®¡ç†</li>
<li>Interactorå’Œå­æ¨¡å—çš„Interactoré€šè¿‡ç›‘å¬è€…æ¨¡å¼å’Œdelegateäº’ç›¸é€šä¿¡</li>
</ul>
<h4 id="æ•°æ®é©±åŠ¨"><a href="#æ•°æ®é©±åŠ¨" class="headerlink" title="æ•°æ®é©±åŠ¨"></a>æ•°æ®é©±åŠ¨</h4><p>æœ€å¤§çš„æ”¹å˜æ˜¯å°†Routerä»Presenterç§»åˆ°äº†Interactorï¼Œæ”¹å˜äº†æ¨¡å—çš„ä¸»ä»å…³ç³»ï¼Œæ•´ä¸ªæ¨¡å—çš„ç”Ÿå‘½å‘¨æœŸç°åœ¨ç”±Interactoræ¥ç®¡ç†ã€‚è€Œä¹‹å‰çš„VIPERæ¨¡å—æ˜¯ä¾èµ–äºViewçš„ç”Ÿå‘½å‘¨æœŸçš„ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ•´ä¸ªæ¶æ„å°±ä»Viewé©±åŠ¨å˜æˆäº†ä¸šåŠ¡é©±åŠ¨ï¼Œæˆ–è€…æ•°æ®é©±åŠ¨ã€‚</p>
<p>å…³äºè¿™ä¸ªæ”¹å˜ï¼ŒUberç»™å‡ºäº†ä¸¤ä¸ªåŸå› ï¼š</p>
<ul>
<li>æƒ³è¦ç»Ÿä¸€iOSå’ŒAndoridçš„è½¯ä»¶æ¶æ„ï¼Œä»¥åŠæ›´å¥½åœ°äº’ç›¸å€Ÿé‰´å¼€å‘ç»éªŒå’Œæ•™è®­ï¼Œå› è€Œéœ€è¦æ”¹å˜iOSä¸­è§†å›¾é©±åŠ¨çš„è®¾è®¡</li>
<li>æƒ³è¦åˆ›å»ºä¸€ä¸ªæ²¡æœ‰Viewï¼Œåªæœ‰ä¸šåŠ¡é€»è¾‘çš„æ¨¡å—ï¼Œå› æ­¤ç”Ÿå‘½å‘¨æœŸéœ€è¦ç”±Interactorç®¡ç†</li>
</ul>
<h4 id="äº‰è®®-2"><a href="#äº‰è®®-2" class="headerlink" title="äº‰è®®"></a>äº‰è®®</h4><p>Uberå›¢é˜Ÿçš„ç¡®å¾ˆæœ‰æƒ³æ³•ã€‚åœ¨å¯¹ä»–ä»¬çš„è¿™ä¸ªæ–¹æ¡ˆè¿›è¡Œæ·±å…¥å®è·µä¹‹å‰ï¼Œæˆ‘æ— æ³•è¯„è®ºè¿™ä¸ªæ–¹æ¡ˆæ˜¯å¥½æ˜¯åï¼Œæˆ‘åªåœ¨è¿™é‡Œæå‡ºä¸€äº›å®è·µä¸­å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>å…³äºUberç»™å‡ºçš„ç¬¬ä¸€ä¸ªåŸå› ï¼Œè¿™æ˜¯Uberå›¢é˜ŸåŸºäºåè°ƒä¸¤ä¸ªå¼€å‘å›¢é˜Ÿçš„æƒ…å†µè€Œåšå‡ºçš„é€‰æ‹©ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰ä»–ä»¬è¿™æ ·ç»Ÿä¸€å¼€å‘çš„éœ€æ±‚ï¼Œå¹¶æ²¡æœ‰å¿…è¦å€Ÿé‰´ã€‚iOSçš„UIKitæ˜¯ä¸€ä¸ªè§†å›¾é©±åŠ¨çš„æ¡†æ¶ï¼Œå¾ˆéš¾åšåˆ°100%æ•°æ®é©±åŠ¨ï¼Œåœ¨å®è·µä¸­å°†ä¼šé‡åˆ°è®¸å¤šéœ€è¦è§£å†³çš„é—®é¢˜ï¼Œé™¤éæœ‰è¶³å¤Ÿçš„å¼€å‘æ—¶é—´ï¼Œå¦åˆ™ä¸è¦è‰ç‡åœ°æŠ•å…¥å…¶ä¸­ã€‚æ˜¯å¦è¦ä½¿ç”¨æ•°æ®é©±åŠ¨çš„è®¾è®¡ï¼Œè¿˜æ˜¯åº”è¯¥ç”±é¡¹ç›®çš„ä¸šåŠ¡è®¾è®¡æ¥å†³å®šã€‚å½“æ•°æ®å˜åŒ–å¤§éƒ¨åˆ†æ˜¯ç”±åç«¯çš„Serviceå’Œç½‘ç»œæ•°æ®å¼•èµ·æ—¶ï¼Œå†å»è€ƒè™‘æ•°æ®é©±åŠ¨å§ã€‚ä¾‹å¦‚Uberçš„åœ°å›¾è·¯çº¿ç”±å®šä½æ¨¡å—ä¸æ–­è®¡ç®—ï¼Œè‡ªåŠ¨æ›´æ–°ï¼Œå°±æ¯”è¾ƒé€‚åˆä½¿ç”¨æ•°æ®é©±åŠ¨ã€‚</p>
<p>å…³äºç¬¬äºŒä¸ªåŸå› ï¼Œä¸€ä¸ªæ²¡æœ‰Viewå’ŒPresenterçš„VIPERï¼Œå°±åªå‰©ä¸‹Routerã€Interactorã€Modelï¼Œè¿™æ—¶è¿™ä¸ªæ¨¡å—å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡Routerè°ƒç”¨çš„Serviceæˆ–è€…Managerï¼Œè¿™ä¸ªServiceæœ‰è‡ªå·±çš„çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸï¼ŒServiceä¹Ÿå¯ä»¥åœ¨Viewé”€æ¯åç»§ç»­å®Œæˆå‰©ä½™çš„ä¸šåŠ¡å·¥ä½œï¼Œåªè¦ä¸šåŠ¡éœ€è¦ï¼Œå¯ä»¥è¿›è¡Œè‡ªæŒæœ‰ï¼Œè‡ªé‡Šæ”¾ã€‚è€Œä¸”è¿™ä¸ªServiceæœ€ç»ˆè¿˜æ˜¯ä¼šè¡¨ç°åœ¨æŸä¸ªViewä¸Šã€‚è¿™ä¹ˆçœ‹æ¥ï¼ŒRouterçš„å±‚çº§å·²ç»å‡é«˜äº†ï¼Œæˆä¸ºäº†æ•´ä¸ªappå†…çš„æ¨¡å—é—´é€šä¿¡å·¥å…·ï¼Œå¯ä»¥è¿æ¥ä»»æ„æ¨¡å—ï¼Œä¸ä»…ä»…æ˜¯VIPERï¼Œå› æ­¤Routerç”±è°æŒæœ‰ï¼Œå°±å®Œå…¨ç”±æ¨¡å—å†…éƒ¨è‡ªç”±ç®¡ç†äº†ã€‚</p>
<p>åªæ˜¯ï¼Œåœ¨iOSä¸­çš„VIPERé‡Œï¼Œå®é™…çš„è·¯ç”±APIéƒ½æ˜¯å­˜åœ¨äºUIViewControllerä¸Šçš„ï¼ŒRouterä¼šç›´æ¥å’ŒViewäº§ç”Ÿå¼•ç”¨ï¼ŒæŠŠRouteræ”¾åˆ°å’ŒViewéš”ç¦»çš„Interactoré‡Œä¼šç ´åéš”ç¦»ã€‚è€Œä¸”ä»Cleanæ¶æ„çš„åˆ†å±‚æ¥çœ‹ï¼Œå±‚çº§å‡é«˜åçš„Routeråº”è¯¥æ˜¯å¤„åœ¨Interface Adapterå±‚å’ŒFramework &amp; Driverå±‚ä¹‹é—´ï¼Œè€ŒInteractoråˆ™æ˜¯åœ¨Application Business Ruleså±‚ï¼Œç”±Interactoræ¥ç®¡ç†å…¶ä»–è§’è‰²ï¼Œä¼šç ´åäº†Clean Architectureé‡Œçš„ä¾èµ–å…³ç³»ã€‚</p>
<p>æ¯”å¦‚ä¸€ä¸ªæ²¡æœ‰Viewçš„ã€ç”¨äºç®¡ç†è¯­éŸ³é€šè¯æ•°æ®çš„Interactorï¼Œæ”¶åˆ°äº†é€šè¯å¼‚å¸¸ä¸­æ–­çš„äº‹ä»¶ï¼Œåœ¨å¤„ç†äº‹ä»¶æ—¶ï¼Œå®ƒä¸åº”è¯¥é€šè¿‡Routerå°†è‡ªå·±ç§»é™¤ï¼Œæˆ–è€…ç»“æŸæ•´ä¸ªè¯­éŸ³é€šè¯ä¸šåŠ¡ï¼Œæˆ–è€…è‡ªåŠ¨è°ƒç”¨é‡æ–°æ‹¨å·çš„ä¸šåŠ¡ï¼Œè¿™æ ·å¾ˆå®¹æ˜“ä¼šè®©ä¸åŒçš„Use Caseä¹‹é—´äº§ç”Ÿè€¦åˆï¼Œè¿™äº›éƒ½åº”è¯¥ç”±æ›´ä¸Šå±‚çš„Serviceå»é€‰æ‹©æ‰§è¡Œï¼Œå¦‚æœæœ‰é¡µé¢è·³è½¬çš„è®¾è®¡ï¼Œåˆ™åº”è¯¥æŠŠäº‹ä»¶è½¬å‘ç»™ä¸€ä¸ªå­˜åœ¨Presenterå±‚çš„Parent VIPERæ¨¡å—ï¼Œç”±parentæ¥å†³å®šæ˜¯é€€å‡ºé€šè¯ç•Œé¢è¿˜æ˜¯å¼¹çª—æç¤ºã€‚å½“ä¸€ä¸ªInteractoræ²¡æœ‰Presenterå’ŒViewæ—¶ï¼Œå®ƒä¸€å®šæ˜¯å¦ä¸€ä¸ªVIPERçš„å­æ¨¡å—ã€‚è¿™ä¹ˆçœ‹æ¥ï¼Œåœ¨æ²¡æœ‰Viewæ—¶ï¼Œæˆ–è®¸è®©Serviceæ¥æŒæœ‰Routeræ‰æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœçœŸçš„æœ‰æŠŠVIPERå˜æˆæ•°æ®é©±åŠ¨çš„éœ€æ±‚ï¼Œä¸»è¦è¿˜æ˜¯æºäºUberç»™å‡ºçš„ç¬¬ä¸€ä¸ªåŸºäºå›¢é˜Ÿç»Ÿä¸€çš„ç†ç”±ã€‚</p>
<h4 id="å…¶ä»–è®¾è®¡"><a href="#å…¶ä»–è®¾è®¡" class="headerlink" title="å…¶ä»–è®¾è®¡"></a>å…¶ä»–è®¾è®¡</h4><p>æ–‡ç« é‡Œè¿˜ç»™å‡ºäº†ä¸€äº›å¾ˆæœ‰å‚è€ƒä»·å€¼çš„å†…å®¹ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>å¯¹Interactorè¿›è¡Œæ³¨å…¥çš„Component</li>
<li>è§†å›¾æ ‘å˜æˆäº†Routeræ ‘</li>
<li>Interactorä¸ç›´æ¥ç»´æŠ¤Modelï¼Œè€Œæ˜¯é€šè¿‡å¯¹åº”çš„Serviceæ¥ç»´æŠ¤Model</li>
<li>çˆ¶æ¨¡å—å’Œå­æ¨¡å—ä¹‹é—´é€šè¿‡Interactoræ¥é€šä¿¡</li>
</ul>
<p>Uberçš„è¿™ä¸ªæ–¹æ¡ˆè®²äº†å¾ˆå¤šå…¶ä»–æ–¹æ¡ˆæ²¡æœ‰æåˆ°çš„æ–¹é¢ï¼Œæ¯”å¦‚ä¾èµ–æ³¨å…¥ã€å¦‚ä½•å¼•å…¥å­æ¨¡å—ç­‰é—®é¢˜ã€‚ä¸è¿‡è¿™ä¸ªæ–¹æ¡ˆå¹¶æ²¡æœ‰å¼€æºã€‚</p>
<h2 id="æ–¹æ¡ˆä¸€ï¼šæœ€å®Œæ•´çš„VIPER"><a href="#æ–¹æ¡ˆä¸€ï¼šæœ€å®Œæ•´çš„VIPER" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šæœ€å®Œæ•´çš„VIPER"></a>æ–¹æ¡ˆä¸€ï¼šæœ€å®Œæ•´çš„VIPER</h2><p>å„ç§å®ç°æ–¹æ¡ˆéƒ½åˆ†æäº†ä¸€éï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹è¿›è¡Œä¸€ä¸ªæ€»ç»“ã€‚é¦–å…ˆæ€»ç»“å‡ºä¸€ä¸ªç»å¯¹æ ‡å‡†çš„VIPERï¼Œå„éƒ¨åˆ†éµå¾ªéš”ç¦»å…³ç³»ï¼ŒåŒæ—¶è€ƒè™‘åˆ°ä¾èµ–æ³¨å…¥ã€å­æ¨¡å—é€šä¿¡ã€æ¨¡å—é—´è§£è€¦ç­‰é—®é¢˜ï¼Œå°†VIPERçš„å„éƒ¨åˆ†çš„èŒè´£å˜å¾—æ›´åŠ æ˜ç¡®ï¼Œä¹Ÿæ–°å¢äº†å‡ ä¸ªè§’è‰²ã€‚ç¤ºä¾‹å›¾å¦‚ä¸‹ï¼Œå„è§’è‰²çš„é¢œè‰²å’ŒClean Architectureå›¾ä¸­å„å±‚çš„é¢œè‰²å¯¹åº”ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-a204e884cdb08f63.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="thorough_viper"></p>
<p>ç¤ºä¾‹ä»£ç å°†ç”¨ä¸€ä¸ªç¬”è®°åº”ç”¨ä½œä¸ºæ¼”ç¤ºã€‚</p>
<h3 id="View"><a href="#View" class="headerlink" title="View"></a>View</h3><p>Viewå¯ä»¥æ˜¯ä¸€ä¸ªUIView + UIViewControllerï¼Œä¹Ÿå¯ä»¥åªæ˜¯ä¸€ä¸ªcustom UIViewï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç”¨äºç®¡ç†UIViewçš„Managerï¼Œåªè¦å®ƒå®ç°äº†Viewçš„æ¥å£å°±å¯ä»¥ã€‚</p>
<p>Viewå±‚çš„èŒè´£ï¼š</p>
<ul>
<li>å±•ç¤ºç•Œé¢ï¼Œç»„åˆå„ç§UIViewï¼Œå¹¶åœ¨UIViewControllerå†…ç®¡ç†å„ç§æ§ä»¶çš„å¸ƒå±€ã€æ›´æ–°</li>
<li>Viewå¯¹å¤–æš´éœ²å„ç§ç”¨äºæ›´æ–°UIçš„æ¥å£ï¼Œè€Œè‡ªå·±ä¸ä¸»åŠ¨æ›´æ–°UI</li>
<li>ViewæŒæœ‰ä¸€ä¸ªç”±å¤–éƒ¨æ³¨å…¥çš„eventHandlerå¯¹è±¡ï¼Œå°†Viewå±‚çš„äº‹ä»¶å‘é€ç»™eventHandler</li>
<li>ViewæŒæœ‰ä¸€ä¸ªç”±å¤–éƒ¨æ³¨å…¥çš„viewDataSourceå¯¹è±¡ï¼Œåœ¨Viewçš„æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œä¼šä»viewDataSourceè·å–ä¸€äº›ç”¨äºå±•ç¤ºçš„æ•°æ®ï¼ŒviewDataSourceçš„æ¥å£å‘½ååº”è¯¥å°½é‡å’Œå…·ä½“ä¸šåŠ¡æ— å…³</li>
<li>Viewå‘Presenteræä¾›routeSourceï¼Œä¹Ÿå°±æ˜¯ç”¨äºç•Œé¢è·³è½¬çš„æºç•Œé¢</li>
</ul>
<p>Viewå±‚ä¼šå¼•å…¥å„ç§è‡ªå®šä¹‰æ§ä»¶ï¼Œè¿™äº›æ§ä»¶æœ‰è®¸å¤šdelegateï¼Œéƒ½åœ¨Viewå±‚å®ç°ï¼Œç»Ÿä¸€åŒ…è£…åï¼Œå†äº¤ç»™Presenterå±‚å®ç°ã€‚å› ä¸ºPresenterå±‚å¹¶ä¸çŸ¥é“Viewçš„å®ç°ç»†èŠ‚ï¼Œå› æ­¤ä¹Ÿå°±ä¸çŸ¥é“è¿™äº›æ§ä»¶çš„æ¥å£ï¼ŒPresenterå±‚åªçŸ¥é“Viewå±‚ç»Ÿä¸€æš´éœ²å‡ºæ¥çš„æ¥å£ã€‚è€Œä¸”è¿™äº›æ§ä»¶çš„æ¥å£åœ¨å®šä¹‰æ—¶å¯èƒ½ä¼šå°†æ•°æ®è·å–ã€äº‹ä»¶å›è°ƒã€æ§ä»¶æ¸²æŸ“æ¥å£æ··æ‚èµ·æ¥ï¼Œæœ€å…·ä»£è¡¨æ€§çš„å°±æ˜¯<code>UITableViewDataSource</code>é‡Œçš„<code>-tableView:cellForRowAtIndexPath:</code>ã€‚è¿™ä¸ªæ¥å£åŒæ—¶æ¶‰åŠåˆ°äº†<code>UITableViewCell</code>å’Œæ¸²æŸ“cellæ‰€éœ€è¦çš„Modelï¼Œæ˜¯éå¸¸å®¹æ˜“äº§ç”Ÿè€¦åˆçš„åœ°æ–¹ï¼Œå› æ­¤éœ€è¦åšä¸€æ¬¡åˆ†è§£ã€‚åº”è¯¥åœ¨Viewçš„dataSourceé‡Œå®šä¹‰ä¸€ä¸ªä»å¤–éƒ¨è·å–æ‰€éœ€è¦çš„ç®€å•ç±»å‹æ•°æ®çš„æ–¹æ³•ï¼Œåœ¨<code>-tableView:cellForRowAtIndexPath:</code>é‡Œç”¨è·å–åˆ°çš„æ•°æ®æ¸²æŸ“cellã€‚ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@protocol ZIKNoteListViewEventHandler &lt;NSObject&gt;</div><div class="line">- (void)handleDidSelectRowAtIndexPath:(NSIndexPath *)indexPath;</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@protocol ZIKNoteListViewDataSource &lt;NSObject&gt;</div><div class="line">- (NSInteger)numberOfRowsInSection:(NSInteger)section;</div><div class="line">- (NSString *)textOfCellForRowAtIndexPath:(NSIndexPath *)indexPath;</div><div class="line">- (NSString *)detailTextOfCellForRowAtIndexPath:(NSIndexPath *)indexPath;</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">@interface ZIKNoteListViewController () &lt;UITableViewDelegate,UITableViewDataSource&gt;</div><div class="line">@property (nonatomic, strong) id&lt;ZIKNoteListViewEventHandler&gt; eventHandler;</div><div class="line">@property (nonatomic, strong) id&lt;ZIKNoteListViewDataSource&gt; viewDataSource;</div><div class="line">@property (weak, nonatomic) IBOutlet UITableView *noteListTableView;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ZIKNoteListViewController</div><div class="line"></div><div class="line">- (UITableViewCell *)cellForRowAtIndexPath:(NSIndexPath *)indexPath</div><div class="line">                                      text:(NSString *)text</div><div class="line">                                detailText:(NSString *)detailText &#123;</div><div class="line">    UITableViewCell *cell = [self.noteListTableView dequeueReusableCellWithIdentifier:@&quot;noteListCell&quot; forIndexPath:indexPath];</div><div class="line">    cell.textLabel.text = text;</div><div class="line">    cell.detailTextLabel.text = detailText;</div><div class="line">    return cell;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark UITableViewDataSource</div><div class="line"></div><div class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123;</div><div class="line">    return [self.viewDataSource numberOfRowsInSection:section];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">    NSString *text = [self.viewDataSource textOfCellForRowAtIndexPath:indexPath];</div><div class="line">    NSString *detailText = [self.viewDataSource detailTextOfCellForRowAtIndexPath:indexPath];</div><div class="line">    UITableViewCell *cell = [self cellForRowAtIndexPath:indexPath</div><div class="line">                                                   text:text</div><div class="line">                                             detailText:detailText];</div><div class="line">    return cell;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark UITableViewDelegate</div><div class="line"></div><div class="line">- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">    [tableView deselectRowAtIndexPath:indexPath animated:YES];</div><div class="line">    </div><div class="line">    [self.eventHandler handleDidSelectRowAtIndexPath:indexPath];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒviewDataSourceå’ŒeventHandleréƒ½æ˜¯ç”±Presenteræ¥æ‹…ä»»çš„ï¼ŒPresenteræ¥æ”¶åˆ°dataSourceè¯·æ±‚æ—¶ï¼Œä»Interactoré‡Œè·å–å¹¶è¿”å›å¯¹åº”çš„æ•°æ®ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨Viewå’ŒPresenterä¹‹é—´ç”¨ViewModelæ¥è¿›è¡Œäº¤äº’ã€‚</p>
<h3 id="Presenter"><a href="#Presenter" class="headerlink" title="Presenter"></a>Presenter</h3><p>Presenterç”±ViewæŒæœ‰ï¼Œå®ƒçš„èŒè´£æœ‰ï¼š</p>
<ul>
<li>æ¥æ”¶å¹¶å¤„ç†æ¥è‡ªViewçš„äº‹ä»¶</li>
<li>ç»´æŠ¤å’ŒViewç›¸å…³çš„å„ç§çŠ¶æ€å’Œé…ç½®ï¼Œæ¯”å¦‚ç•Œé¢æ˜¯å¦ä½¿ç”¨å¤œé—´æ¨¡å¼ç­‰</li>
<li>è°ƒç”¨Interactoræä¾›çš„Use Caseæ‰§è¡Œä¸šåŠ¡é€»è¾‘</li>
<li>å‘Interactoræä¾›Viewä¸­çš„æ•°æ®ï¼Œè®©Interactorç”Ÿæˆéœ€è¦çš„Model</li>
<li>æ¥æ”¶å¹¶å¤„ç†æ¥è‡ªInteractorçš„ä¸šåŠ¡äº‹ä»¶å›è°ƒäº‹ä»¶</li>
<li>é€šçŸ¥Viewè¿›è¡Œæ›´æ–°æ“ä½œ</li>
<li>é€šè¿‡Wireframeè·³è½¬åˆ°å…¶ä»–View</li>
</ul>
<p>Presenteræ˜¯Viewå’Œä¸šåŠ¡ä¹‹é—´çš„ä¸­è½¬ç«™ï¼Œå®ƒä¸åŒ…å«ä¸šåŠ¡å®ç°ä»£ç ï¼Œè€Œæ˜¯è´Ÿè´£è°ƒç”¨ç°æˆçš„å„ç§Use Caseï¼Œå°†å…·ä½“äº‹ä»¶è½¬åŒ–ä¸ºå…·ä½“ä¸šåŠ¡ã€‚Presenteré‡Œä¸åº”è¯¥å¯¼å…¥UIKitï¼Œå¦åˆ™å°±æœ‰å¯èƒ½å…¥ä¾µViewå±‚çš„æ¸²æŸ“å·¥ä½œã€‚Presenteré‡Œä¹Ÿä¸åº”è¯¥å‡ºç°Modelç±»ï¼Œå½“æ•°æ®ä»Interactorä¼ é€’åˆ°Presenteré‡Œæ—¶ï¼Œåº”è¯¥è½¬å˜ä¸ºç®€å•çš„æ•°æ®ç»“æ„ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">@interface ZIKNoteListViewPresenter () &lt;ZIKNoteListViewDataSource, ZIKNoteListViewEventHandler&gt;</div><div class="line">@property (nonatomic, strong) id&lt;ZIKNoteListWireframeProtocol&gt; wireframe;</div><div class="line">@property (nonatomic, weak) id&lt;ZIKViperView,ZIKNoteListViewProtocol&gt; view;</div><div class="line">@property (nonatomic, strong) id&lt;ZIKNoteListInteractorInput&gt; interactor;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ZIKNoteListViewPresenter</div><div class="line"></div><div class="line">#pragma mark ZIKNoteListViewDataSource</div><div class="line"></div><div class="line">- (NSInteger)numberOfRowsInSection:(NSInteger)section &#123;</div><div class="line">    return self.interactor.noteCount;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)textOfCellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">    NSString *title = [self.interactor titleForNoteAtIndex:indexPath.row];</div><div class="line">    return title;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)detailTextOfCellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">    NSString *content = [self.interactor contentForNoteAtIndex:indexPath.row];</div><div class="line">    return content;</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark ZIKNoteListViewEventHandler</div><div class="line"></div><div class="line">- (void)handleDidSelectRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">    NSString *uuid = [self.interactor noteUUIDAtIndex:indexPath.row];</div><div class="line">    NSString *title = [self.interactor noteTitleAtIndex:indexPath.row];</div><div class="line">    NSString *content = [self.interactor noteContentAtIndex:indexPath.row];</div><div class="line">    </div><div class="line">    [self.wireframe pushEditorViewForEditingNoteWithUUID:uuid title:title content:content delegate:self];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h3 id="Interactor"><a href="#Interactor" class="headerlink" title="Interactor"></a>Interactor</h3><p>Ineractorçš„èŒè´£ï¼š</p>
<ul>
<li>å®ç°å’Œå°è£…å„ç§ä¸šåŠ¡çš„Use Caseï¼Œä¾›å¤–éƒ¨è°ƒç”¨</li>
<li>ç»´æŠ¤å’Œä¸šåŠ¡ç›¸å…³çš„å„ç§çŠ¶æ€ï¼Œæ¯”å¦‚æ˜¯å¦æ­£åœ¨ç¼–è¾‘ç¬”è®°</li>
<li>Interactorå¯ä»¥è·å–å„ç§Managerå’ŒServiceï¼Œç”¨äºç»„åˆå®ç°ä¸šåŠ¡é€»è¾‘ï¼Œè¿™äº›Managerå’ŒServiceåº”è¯¥æ˜¯ç”±å¤–éƒ¨æ³¨å…¥çš„ä¾èµ–ï¼Œè€Œä¸æ˜¯ç›´æ¥å¼•ç”¨å…·ä½“çš„ç±»</li>
<li>é€šè¿‡DataManagerç»´æŠ¤Model</li>
<li>ç›‘å¬å„ç§å¤–éƒ¨çš„ä¸šåŠ¡äº‹ä»¶å¹¶å¤„ç†ï¼Œå¿…è¦æ—¶å°†äº‹ä»¶å‘é€ç»™eventHandler</li>
<li>InteractoræŒæœ‰ä¸€ä¸ªç”±å¤–éƒ¨æ³¨å…¥çš„eventHandlerå¯¹è±¡ï¼Œå°†éœ€è¦å¤–éƒ¨å¤„ç†çš„ä¸šåŠ¡äº‹ä»¶å‘é€ç»™eventHandlerï¼Œæˆ–è€…é€šè¿‡eventHandleræ¥å£å¯¹æŸäº›æ•°æ®æ“ä½œçš„è¿‡ç¨‹è¿›è¡Œå›è°ƒ</li>
<li>InteractoræŒæœ‰ä¸€ä¸ªç”±å¤–éƒ¨æ³¨å…¥çš„dataSourceå¯¹è±¡ï¼Œç”¨äºè·å–Viewä¸Šçš„æ•°æ®ï¼Œä»¥æ›´æ–°Model</li>
</ul>
<p>Interactoræ˜¯ä¸šåŠ¡çš„å®ç°è€…å’Œç»´æŠ¤è€…ï¼Œå®ƒä¼šè°ƒç”¨å„ç§Serviceæ¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œå°è£…æˆæ˜ç¡®çš„ç”¨ä¾‹ã€‚è€Œè¿™äº›Serviceåœ¨ä½¿ç”¨æ—¶ï¼Œä¹Ÿéƒ½æ˜¯åŸºäºæ¥å£çš„ï¼Œå› ä¸ºInteractorçš„å®ç°ä¸å’Œå…·ä½“çš„ç±»ç»‘å®šï¼Œè€Œæ˜¯ç”±Applicationæ³¨å…¥Interactoréœ€è¦çš„Serviceã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@protocol ZIKNoteListInteractorInput &lt;NSObject&gt;</div><div class="line">- (void)loadAllNotes;</div><div class="line">- (NSInteger)noteCount;</div><div class="line">- (NSString *)titleForNoteAtIndex:(NSUInteger)idx;</div><div class="line">- (NSString *)contentForNoteAtIndex:(NSUInteger)idx;</div><div class="line">- (NSString *)noteUUIDAtIndex:(NSUInteger)idx;</div><div class="line">- (NSString *)noteTitleAtIndex:(NSUInteger)idx;</div><div class="line">- (NSString *)noteContentAtIndex:(NSUInteger)idx;</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">@interface ZIKNoteListInteractor : NSObject &lt;ZIKNoteListInteractorInput&gt;</div><div class="line">@property (nonatomic, weak) id dataSource;</div><div class="line">@property (nonatomic, weak) id eventHandler;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ZIKNoteListInteractor</div><div class="line"></div><div class="line">- (void)loadAllNotes &#123;</div><div class="line">    [[ZIKNoteDataManager sharedInsatnce] fetchAllNotesWithCompletion:^(NSArray *notes) &#123;</div><div class="line">        [self.eventHandler didFinishLoadAllNotes];</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSArray&lt;ZIKNoteModel *&gt; *)noteList &#123;</div><div class="line">    return [ZIKNoteDataManager sharedInsatnce].noteList;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSInteger)noteCount &#123;</div><div class="line">    return self.noteList.count;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)titleForNoteAtIndex:(NSUInteger)idx &#123;</div><div class="line">    if (self.noteList.count - 1 &lt; idx) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    return [[self.noteList objectAtIndex:idx] title];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)contentForNoteAtIndex:(NSUInteger)idx &#123;</div><div class="line">    if (self.noteList.count - 1 &lt; idx) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    return [[self.noteList objectAtIndex:idx] content];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)noteUUIDAtIndex:(NSUInteger)idx &#123;</div><div class="line">    if (self.noteList.count - 1 &lt; idx) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    return [[self.noteList objectAtIndex:idx] uuid];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)noteTitleAtIndex:(NSUInteger)idx &#123;</div><div class="line">    if (self.noteList.count - 1 &lt; idx) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    return [[self.noteList objectAtIndex:idx] title];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSString *)noteContentAtIndex:(NSUInteger)idx &#123;</div><div class="line">    if (self.noteList.count - 1 &lt; idx) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    return [[self.noteList objectAtIndex:idx] content];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>å‘Interactoræä¾›å„ç§å°è£…å¥½çš„æœåŠ¡ï¼Œä¾‹å¦‚æ•°æ®åº“çš„è®¿é—®ã€å­˜å‚¨ï¼Œè°ƒç”¨å®šä½åŠŸèƒ½ç­‰ã€‚Serviceç”±Applicationåœ¨æ‰§è¡Œè·¯ç”±æ—¶æ³¨å…¥åˆ°Builderé‡Œï¼Œå†ç”±Buidleræ³¨å…¥åˆ°Interactoré‡Œã€‚ä¹Ÿå¯ä»¥åªæ³¨å…¥ä¸€ä¸ªService Routerï¼Œåœ¨è¿è¡Œæ—¶å†é€šè¿‡è¿™ä¸ªService Routeræ‡’åŠ è½½éœ€è¦çš„Serviceï¼Œç›¸å½“äºæ³¨å…¥äº†ä¸€ä¸ªæä¾›RouteråŠŸèƒ½çš„Serviceã€‚</p>
<p>Serviceå¯ä»¥çœ‹ä½œæ˜¯æ²¡æœ‰Viewçš„VIPERï¼Œä¹Ÿæœ‰è‡ªå·±çš„è·¯ç”±å’ŒBuilderã€‚</p>
<h3 id="Wireframe"><a href="#Wireframe" class="headerlink" title="Wireframe"></a>Wireframe</h3><p>ç¿»è¯‘æˆä¸­æ–‡å«çº¿æ¡†ï¼Œç”¨äºè¡¨è¾¾ä»ä¸€ä¸ªModuleåˆ°å¦ä¸€ä¸ªModuleçš„è¿‡ç¨‹ã€‚è™½ç„¶ä¹Ÿæ˜¯æ‰®æ¼”è€…æ‰§è¡Œè·¯ç”±çš„è§’è‰²ï¼Œä½†æ˜¯å…¶å®å®ƒå’ŒRouteræ˜¯æœ‰åŒºåˆ«çš„ã€‚</p>
<p>Wireframeå’Œstoryboardä¸­è¿æ¥å¥½çš„ä¸€ä¸ªä¸ªsegueç±»ä¼¼ï¼Œè´Ÿè´£æä¾›ä¸€ç³»åˆ—å…·ä½“çš„è·¯ç”±ç”¨ä¾‹ï¼Œè¿™ä¸ªç”¨ä¾‹é‡Œå·²ç»é…ç½®å¥½äº†æºç•Œé¢å’Œç›®çš„ç•Œé¢çš„ä¸€äº›ä¾èµ–ï¼ŒåŒ…æ‹¬è½¬åœºåŠ¨ç”»ã€æ¨¡å—é—´ä¼ å‚ç­‰ã€‚Wireframeçš„æ¥å£æ˜¯æä¾›ç»™æ¨¡å—å†…éƒ¨ä½¿ç”¨çš„ï¼Œå®ƒé€šè¿‡è°ƒç”¨Routeræ¥æ‰§è¡ŒçœŸæ­£çš„è·¯ç”±æ“ä½œã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@interface ZIKTNoteListWireframe : NSObject &lt;ZIKTViperWireframe&gt;</div><div class="line">- (void)presentLoginViewWithMessage:(NSString *)message delegate:(id&lt;ZIKTLoginViewDelegate&gt;)delegate completion:(void (^ __nullable)(void))completion;</div><div class="line">- (void)dismissLoginView:(UIViewController *)viewController animated:(BOOL)animated completion:(void (^ __nullable)(void))completion;</div><div class="line">- (void)presentEditorForCreatingNewNoteWithDelegate:(id&lt;ZIKTEditorDelegate&gt;)delegate completion:(void (^ __nullable)(void))completion;</div><div class="line">- (void)pushEditorViewForEditingNoteWithUUID:(NSString *)uuid title:(NSString *)title content:(NSString *)content delegate:(id&lt;ZIKTEditorDelegate&gt;)delegate;</div><div class="line">- (UIViewController *)editorViewForEditingNoteWithUUID:(NSString *)uuid title:(NSString *)title content:(NSString *)content delegate:(id&lt;ZIKTEditorDelegate&gt;)delegate;</div><div class="line">- (void)pushEditorViewController:(UIViewController *)destination fromViewController:(UIViewController *)source animated:(BOOL)animated;</div><div class="line">- (void)quitEditorViewWithAnimated:(BOOL)animated;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h3 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h3><p>Routeråˆ™æ˜¯ç”±Applicationæä¾›çš„å…·ä½“è·¯ç”±æŠ€æœ¯ï¼Œå¯ä»¥ç®€å•å°è£…UIKité‡Œçš„é‚£äº›è·³è½¬æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨URL Routeræ¥æ‰§è¡Œè·¯ç”±ã€‚ä½†æ˜¯ä¸€ä¸ªæ¨¡å—æ˜¯ä¸éœ€è¦çŸ¥é“appä½¿ç”¨çš„æ˜¯ä»€ä¹ˆå…·ä½“æŠ€æœ¯çš„ã€‚Routeræ‰æ˜¯çœŸæ­£è¿æ¥å„ä¸ªæ¨¡å—çš„åœ°æ–¹ã€‚å®ƒä¹Ÿè´Ÿè´£å¯»æ‰¾å¯¹åº”çš„ç›®çš„æ¨¡å—ï¼Œå¹¶ä¸”é€šè¿‡Buidlerè¿›è¡Œä¾èµ–æ³¨å…¥ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@interface ZIKTRouter : NSObject &lt;ZIKTViperRouter&gt;</div><div class="line">///å°è£…UIKitçš„è·³è½¬æ–¹æ³•</div><div class="line">+ (void)pushViewController:(UIViewController *)destination fromViewController:(UIViewController *)source animated:(BOOL)animated;</div><div class="line">+ (void)popViewController:(UIViewController *)viewController animated:(BOOL)animated;</div><div class="line">+ (void)presentViewController:(UIViewController *)viewControllerToPresent fromViewController:(UIViewController *)source animated:(BOOL)animated completion:(void (^ __nullable)(void))completion;</div><div class="line">+ (void)dismissViewController:(UIViewController *)viewController animated:(BOOL)animated completion:(void (^ __nullable)(void))completion;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ZIKTRouter (ZIKTEditor)</div><div class="line"></div><div class="line">+ (UIViewController *)viewForCreatingNoteWithDelegate:(id&lt;ZIKTEditorDelegate&gt;)delegate &#123;</div><div class="line">    return [ZIKTEditorBuilder viewForCreatingNoteWithDelegate:delegate];</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (UIViewController *)viewForEditingNoteWithUUID:(NSString *)uuid title:(NSString *)title content:(NSString *)content delegate:(id&lt;ZIKTEditorDelegate&gt;)delegate &#123;</div><div class="line">    return [ZIKTEditorBuilder viewForEditingNoteWithUUID:uuid title:title content:content delegate:delegate];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h3 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h3><p>ç”±Applicationå®ç°ï¼Œè´Ÿè´£åœ¨æ¨¡å—é€šä¿¡æ—¶è¿›è¡Œä¸€äº›æ¥å£çš„è½¬æ¢ï¼Œä¾‹å¦‚ä¸¤ä¸ªæ¨¡å—ä½¿ç”¨äº†ç›¸åŒä¸šåŠ¡åŠŸèƒ½çš„æŸä¸ªServiceï¼Œä½¿ç”¨çš„protocolå®ç°ä¸€æ ·ï¼Œä½†æ˜¯protocolåå­—ä¸ä¸€æ ·ï¼Œå°±å¯ä»¥åœ¨è·¯ç”±æ—¶ï¼Œåœ¨Adapteré‡Œè¿›è¡Œä¸€æ¬¡è½¬æ¢ã€‚ç”šè‡³åªè¦å®šä¹‰çš„é€»è¾‘ä¸€æ ·ï¼Œä¾èµ–å‚æ•°çš„åå­—å’Œæ•°æ®ç±»å‹ä¹Ÿå¯ä»¥å…è®¸ä¸åŒã€‚è¿™æ ·å°±èƒ½è®©æ¨¡å—ä¸ä¾èµ–äºæŸä¸ªå…·ä½“çš„protocolï¼Œè€Œæ˜¯ä¾èµ–äºprotocolå®é™…å®šä¹‰çš„ä¾èµ–å’Œæ¥å£ã€‚</p>
<p>æ³¨æ„è¿™é‡Œçš„Adapterå’ŒClean Architectureé‡Œçš„<code>Interface Adapter</code>æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™é‡Œçš„Adapterå°±æ˜¯å­—é¢æ„ä¹‰ä¸Šçš„æ¥å£è½¬æ¢ï¼Œè€ŒClean Architectureé‡Œçš„<code>Interface Adapter</code>å±‚æ›´åŠ æŠ½è±¡ï¼Œæ˜¯Use Caseå±‚ä¸å…·ä½“å®ç°æŠ€æœ¯ä¹‹é—´çš„è½¬æ¢ï¼Œå›Šæ‹¬äº†æ›´å¤šçš„è§’è‰²ã€‚</p>
<h3 id="Builder"><a href="#Builder" class="headerlink" title="Builder"></a>Builder</h3><p>è´Ÿè´£åˆå§‹åŒ–æ•´ä¸ªæ¨¡å—ï¼Œé…ç½®VIPERä¹‹é—´çš„å…³ç³»ï¼Œå¹¶å¯¹å¤–å£°æ˜æ¨¡å—éœ€è¦çš„ä¾èµ–ï¼Œè®©å¤–éƒ¨æ‰§è¡Œæ³¨å…¥ã€‚</p>
<h2 id="æ¨¡å—é—´è§£è€¦"><a href="#æ¨¡å—é—´è§£è€¦" class="headerlink" title="æ¨¡å—é—´è§£è€¦"></a>æ¨¡å—é—´è§£è€¦</h2><p>ä¸€ä¸ªVIPERæ¨¡å—å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œå¯ä»¥è¢«å•ç‹¬å°è£…æˆä¸€ä¸ªåº“ï¼Œè¢«appå¼•ç”¨ã€‚è¿™æ—¶å€™ï¼Œappå°±è´Ÿè´£å°†å„ä¸ªæ¨¡å—è¿æ¥èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­ç°è‰²çš„<code>Application Context</code>éƒ¨åˆ†ã€‚ä¸€ä¸ªæ¨¡å—ï¼Œè‚¯å®šæ˜¯å­˜åœ¨äºä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è¿è¡Œèµ·æ¥çš„ã€‚</p>
<p><code>Wireframe</code> -&gt; <code>Router</code> -&gt; <code>Adapter</code> -&gt; <code>Builder</code> å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„æ¨¡å—é—´è·¯ç”±ï¼Œå¹¶ä¸”å®ç°äº†æ¨¡å—é—´çš„è§£è€¦ã€‚</p>
<p>å…¶ä¸­Wireframeå’ŒBuilderæ˜¯åˆ†åˆ«ç”±å¼•ç”¨è€…æ¨¡å—å’Œè¢«å¼•ç”¨æ¨¡å—æä¾›çš„ï¼Œæ˜¯ä¸¤ä¸ªæ¨¡å—çš„å‡ºå£å’Œå…¥å£ï¼Œè€ŒRouterå’ŒAdapteråˆ™æ˜¯ç”±æ¨¡å—çš„ä½¿ç”¨è€…â€”â€”Applicationå®ç°çš„ã€‚</p>
<p>å½“ä¸¤ä¸ªæ¨¡å—ä¹‹é—´å­˜åœ¨å¼•ç”¨å…³ç³»æ—¶ï¼Œè¯´æ˜å­˜åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šçš„è€¦åˆï¼Œè¿™ç§è€¦åˆæ˜¯ä¸šåŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯ä¸å¯èƒ½æ¶ˆé™¤çš„ã€‚æˆ‘ä»¬èƒ½åšçš„å°±æ˜¯æŠŠè€¦åˆå°½é‡äº¤ç»™æ¨¡å—è°ƒç”¨è€…ï¼Œç”±Applicationæ¥æä¾›å…·ä½“çš„ç±»ï¼Œæ³¨å…¥åˆ°å„ä¸ªæ¨¡å—ä¹‹ä¸­ï¼Œè€Œæ¨¡å—å†…éƒ¨åªé¢å‘protocolå³å¯ã€‚è¿™æ ·çš„è¯ï¼Œè¢«å¼•ç”¨æ¨¡å—åªè¦å®ç°äº†ç›¸åŒçš„æ¥å£ï¼Œå°±å¯ä»¥éšæ—¶æ›¿æ¢ï¼Œç”šè‡³æ¥å£æœ‰ä¸€äº›å·®å¼‚æ—¶ï¼Œåªè¦è¢«å¼•ç”¨æ¨¡å—æä¾›äº†ç›¸åŒåŠŸèƒ½çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Adapteræ¥åšæ¥å£å…¼å®¹è½¬æ¢ï¼Œè®©å¼•ç”¨è€…æ¨¡å—æ— éœ€åšä»»ä½•ä¿®æ”¹ã€‚</p>
<p>Wireframeç›¸å½“äºæ’å¤´ï¼ŒBuilderç›¸å½“äºæ’åº§ï¼Œè€ŒRouterå’ŒAdapterç›¸å½“äºç”µè·¯å’Œè½¬æ¥å¤´ï¼Œå°†ä¸åŒè§„æ ¼çš„æ’åº§å’Œæ’å¤´è¿æ¥èµ·æ¥ã€‚æŠŠè¿™äº›è¿æ¥å’Œé€‚é…çš„å·¥ä½œäº¤ç»™Applicationå±‚ï¼Œå°±èƒ½è®©ä¸¤ä¸ªæ¨¡å—å®ç°å„è‡ªç‹¬ç«‹ã€‚</p>
<h2 id="å­æ¨¡å—"><a href="#å­æ¨¡å—" class="headerlink" title="å­æ¨¡å—"></a>å­æ¨¡å—</h2><p>å¤§éƒ¨åˆ†æ–¹æ¡ˆéƒ½æ²¡æœ‰è®¨è®ºå­æ¨¡å—å­˜åœ¨çš„æƒ…å†µã€‚åœ¨VIPERé‡Œå¦‚ä½•å¼•å…¥å¦ä¸€ä¸ªVIPERæ¨¡å—ï¼Ÿå¤šä¸ªæ¨¡å—ä¹‹é—´å¦‚ä½•äº¤äº’ï¼Ÿå­æ¨¡å—ç”±è°åˆå§‹åŒ–ã€ç”±è°ç®¡ç†ï¼Ÿ</p>
<p>å…¶ä»–å‡ ä¸ªå®ç°ä¸­ï¼Œåªæœ‰Uberè¾ƒä¸ºè¯¦ç»†åœ°è®¨è®ºäº†å­æ¨¡å—çš„é—®é¢˜ã€‚åœ¨Uberçš„Ribletsæ¶æ„é‡Œï¼Œå­æ¨¡å—çš„Routerè¢«æ·»åŠ åˆ°çˆ¶æ¨¡å—çš„Routerï¼Œæ¨¡å—ä¹‹é—´é€šè¿‡delegateå’Œç›‘å¬çš„æ–¹å¼è¿›è¡Œé€šä¿¡ã€‚è¿™æ ·åšä¼šè®©æ¨¡å—é—´äº§ç”Ÿä¸€å®šçš„è€¦åˆã€‚å¦‚æœå­æ¨¡å—æ˜¯ç”±äºçˆ¶Viewä½¿ç”¨äº†ä¸€ä¸ªå­Viewæ§ä»¶è€Œè¢«å¼•å…¥çš„ï¼Œé‚£ä¹ˆçˆ¶Interactorå°±ä¼šåœ¨ä»£ç é‡Œå¤šå‡ºä¸€ä¸ªå­Interactorï¼Œè¿™æ ·å°±å¯¼è‡´äº†Viewçš„å®ç°æ–¹å¼å½±å“äº†Interactorçš„å®ç°ã€‚</p>
<h3 id="å­æ¨¡å—çš„æ¥æº"><a href="#å­æ¨¡å—çš„æ¥æº" class="headerlink" title="å­æ¨¡å—çš„æ¥æº"></a>å­æ¨¡å—çš„æ¥æº</h3><p>å­æ¨¡å—çš„æ¥æºæœ‰ï¼š</p>
<ul>
<li>Viewå¼•ç”¨äº†ä¸€ä¸ªå°è£…å¥½çš„å­Viewæ§ä»¶ï¼Œè¿å¸¦ç€å¼•å…¥äº†å­Viewçš„æ•´ä¸ªVIPER</li>
<li>Interactorä½¿ç”¨äº†ä¸€ä¸ªService</li>
</ul>
<h3 id="é€šä¿¡æ–¹å¼"><a href="#é€šä¿¡æ–¹å¼" class="headerlink" title="é€šä¿¡æ–¹å¼"></a>é€šä¿¡æ–¹å¼</h3><p>å­Viewå¯èƒ½æ˜¯ä¸€ä¸ªUIViewï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªChild UIViewControllerã€‚å› æ­¤å­Viewæœ‰å¯èƒ½éœ€è¦å‘å¤–éƒ¨è¯·æ±‚æ•°æ®ï¼Œä¹Ÿå¯èƒ½ç‹¬ç«‹å®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼Œä¸éœ€è¦ä¾èµ–çˆ¶æ¨¡å—ã€‚</p>
<p>å¦‚æœå­Viewå¯ä»¥ç‹¬ç«‹ï¼Œé‚£åœ¨å­æ¨¡å—é‡Œä¸ä¼šå‡ºç°å’Œçˆ¶æ¨¡å—äº¤äº’çš„é€»è¾‘ï¼Œåªæœ‰æŠŠä¸€äº›äº‹ä»¶é€šè¿‡Outputä¼ é€’å‡ºå»çš„æ¥å£ã€‚è¿™æ—¶åªéœ€è¦æŠŠå­Viewçš„æ¥å£å°è£…åœ¨çˆ¶Viewçš„æ¥å£é‡Œå³å¯ï¼Œçˆ¶Presenterå’Œçˆ¶Interactoræ˜¯ä¸çŸ¥é“çˆ¶Viewæä¾›çš„è¿™å‡ ä¸ªæ¥å£æ˜¯é€šè¿‡å­Viewå®ç°çš„ã€‚è¿™æ ·çˆ¶æ¨¡å—å°±èƒ½æ¥æ”¶åˆ°å­æ¨¡å—çš„äº‹ä»¶äº†ï¼Œè€Œä¸”èƒ½å¤Ÿä¿æŒInteractorå’ŒPresenterã€Viewä¹‹é—´ä»ä½åˆ°é«˜çš„ä¾èµ–å…³ç³»ã€‚</p>
<p>å¦‚æœçˆ¶æ¨¡å—éœ€è¦è°ƒç”¨å­æ¨¡å—çš„æŸäº›åŠŸèƒ½ï¼Œæˆ–è€…ä»å­æ¨¡å—è·å–æ•°æ®ï¼Œå¯ä»¥é€‰æ‹©å°è£…åˆ°çˆ¶Viewçš„æ¥å£é‡Œï¼Œä¸è¿‡å¦‚æœæ¶‰åŠåˆ°æ•°æ®æ¨¡å‹ï¼Œå¹¶ä¸”ä¸æƒ³è®©æ•°æ®æ¨¡å‹å‡ºç°åœ¨Viewçš„æ¥å£ä¸­ï¼Œå¯ä»¥æŠŠå­Interactorä½œä¸ºçˆ¶Interactorçš„ä¸€ä¸ªServiceï¼Œåœ¨å¼•å…¥å­æ¨¡å—æ—¶ï¼Œé€šè¿‡çˆ¶Builderæ³¨å…¥åˆ°çˆ¶Interactoré‡Œï¼Œæˆ–è€…æ ¹æ®ä¾èµ–å…³ç³»è§£è€¦åœ°å†å½»åº•ä¸€ç‚¹ï¼Œæ³¨å…¥åˆ°çˆ¶Presenteré‡Œï¼Œè®©çˆ¶Presenterå†æŠŠæ¥å£è½¬å‘ç»™çˆ¶Interactorã€‚è¿™æ ·å­æ¨¡å—å’Œçˆ¶æ¨¡å—å°±èƒ½é€šè¿‡Serviceçš„å½¢å¼è¿›è¡Œé€šä¿¡äº†ï¼Œè€Œè¿™æ—¶ï¼Œçˆ¶Interactorä¹Ÿä¸çŸ¥é“è¿™ä¸ªServiceæ˜¯æ¥è‡ªå­æ¨¡å—é‡Œçš„ã€‚</p>
<p>åœ¨è¿™æ ·çš„è®¾è®¡ä¸‹ï¼Œå­æ¨¡å—å’Œçˆ¶æ¨¡å—æ˜¯ä¸çŸ¥é“å½¼æ­¤çš„å­˜åœ¨çš„ï¼Œåªæ˜¯é€šè¿‡æ¥å£è¿›è¡Œäº¤äº’ã€‚å¥½å¤„æ˜¯çˆ¶Viewå¦‚æœæƒ³è¦æ›´æ¢ä¸ºå¦ä¸€ä¸ªç›¸åŒåŠŸèƒ½çš„å­Viewæ§ä»¶ï¼Œå°±åªéœ€è¦åœ¨çˆ¶Viewé‡Œä¿®æ”¹ï¼Œä¸ä¼šå½±å“Presenterå’ŒInteractorã€‚</p>
<h2 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h2><p>è¿™ä¸ªVIPERçš„è®¾è®¡æ˜¯é€šè¿‡æ¥å£å°†å„ä¸ªéƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·çš„ï¼Œä¸€ä¸ªç±»éœ€è¦è®¾ç½®å¾ˆå¤šä¾èµ–ï¼Œä¾‹å¦‚Interactoréœ€è¦ä¾èµ–è®¸å¤šServiceã€‚è¿™å°±æ¶‰åŠåˆ°äº†ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>åœ¨å“ªé‡Œé…ç½®ä¾èµ–</li>
<li>ä¸€ä¸ªç±»æ€ä¹ˆå£°æ˜è‡ªå·±çš„ä¾èµ–</li>
</ul>
<p>åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œç”±Builderå£°æ˜æ•´ä¸ªæ¨¡å—çš„ä¾èµ–ï¼Œç„¶ååœ¨Builderå†…éƒ¨ä¸ºä¸åŒçš„ç±»è®¾ç½®ä¾èµ–ï¼Œå¤–éƒ¨åœ¨æ³¨å…¥ä¾èµ–æ—¶ï¼Œå°±ä¸å¿…çŸ¥é“å†…éƒ¨æ˜¯æ€ä¹ˆä½¿ç”¨è¿™äº›ä¾èµ–å‚æ•°çš„ã€‚ä¸€ä¸ªç±»å¦‚æœæœ‰å¿…éœ€çš„ä¾èµ–å‚æ•°ï¼Œå¯ä»¥ç›´æ¥åœ¨initæ–¹æ³•é‡Œä½“ç°ï¼Œå¯¹äºé‚£äº›éå¿…éœ€çš„ä¾èµ–ï¼Œå¯ä»¥é€šè¿‡æš´éœ²æ¥å£æ¥å£°æ˜ã€‚</p>
<p>å¦‚æœéœ€è¦åŠ¨æ€æ³¨å…¥ï¼Œè€Œä¸æ˜¯åœ¨æ¨¡å—åˆå§‹åŒ–æ—¶å°±é…ç½®æ‰€æœ‰çš„ä¾èµ–ï¼ŒBuilderä¹Ÿå¯ä»¥æä¾›åŠ¨æ€æ³¨å…¥çš„æ¥å£ã€‚</p>
<h2 id="æ˜ å°„åˆ°MVC"><a href="#æ˜ å°„åˆ°MVC" class="headerlink" title="æ˜ å°„åˆ°MVC"></a>æ˜ å°„åˆ°MVC</h2><p>å¦‚æœä½ éœ€è¦æŠŠä¸€ä¸ªæ¨¡å—ä»MVCé‡æ„åˆ°VIPERï¼Œå¯ä»¥å…ˆæŒ‰ç…§è¿™ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>æ•´ç†Controllerä¸­çš„ä»£ç ï¼ŒæŠŠä¸åŒèŒè´£çš„ä»£ç ç”¨pragma markåˆ†éš”å¥½</li>
<li>æ•´ç†å¥½åï¼ŒæŒ‰ç…§å„éƒ¨åˆ†çš„èŒè´£ï¼Œå°†ä»£ç åˆ†æ•£åˆ°VIPERçš„å„ä¸ªè§’è‰²ä¸­ï¼Œæ­¤æ—¶Viewã€Presenterã€Interactorä¹‹é—´å¯ä»¥ç›´æ¥äº’ç›¸å¼•ç”¨</li>
<li>æŠŠViewã€Presenterã€Interactorè¿›è¡Œè§£è€¦ï¼ŒæŠ½å‡ºæ¥å£ï¼Œäº’ç›¸ä¹‹é—´ä¾èµ–æ¥å£è¿›è¡Œäº¤äº’</li>
</ul>
<p>ä¸‹é¢å°±æ˜¯ç¬¬ä¸€æ­¥é‡Œåœ¨Controllerä¸­å¯ä»¥åˆ†éš”å‡ºçš„èŒè´£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">@implementation ViewController</div><div class="line">//------View-------</div><div class="line"></div><div class="line">//Viewçš„ç”Ÿå‘½å‘¨æœŸ</div><div class="line">#pragma mark View life</div><div class="line"></div><div class="line">//Viewçš„é…ç½®ï¼ŒåŒ…æ‹¬å¸ƒå±€è®¾ç½®</div><div class="line">#pragma mark View config</div><div class="line"></div><div class="line">//æ›´æ–°Viewçš„æ¥å£</div><div class="line">#pragma mark Update view</div><div class="line"></div><div class="line">//Viewéœ€è¦ä»modelä¸­è·å–çš„æ•°æ®</div><div class="line">#pragma mark Request view data source</div><div class="line"></div><div class="line">//ç›‘æ§ã€æ¥æ”¶Viewçš„äº‹ä»¶</div><div class="line">#pragma mark Send view event</div><div class="line"></div><div class="line">//------Presenter-------</div><div class="line"></div><div class="line">//å¤„ç†Viewçš„äº‹ä»¶</div><div class="line">#pragma mark Handle view event</div><div class="line"></div><div class="line">//ç•Œé¢è·³è½¬</div><div class="line">#pragma mark Wireframe</div><div class="line"></div><div class="line">//å‘Viewæä¾›é…ç½®ç”¨çš„æ•°æ®</div><div class="line">#pragma mark Provide view data source</div><div class="line"></div><div class="line">//æä¾›ç”Ÿæˆmodeléœ€è¦çš„æ•°æ®</div><div class="line">#pragma mark Provide model data source</div><div class="line"></div><div class="line">//å¤„ç†ä¸šåŠ¡äº‹ä»¶ï¼Œè°ƒç”¨ä¸šåŠ¡ç”¨ä¾‹</div><div class="line">#pragma mark Handle business event</div><div class="line"></div><div class="line">//------Interactor-------</div><div class="line"></div><div class="line">//ç›‘æ§ã€æ¥æ”¶ä¸šåŠ¡äº‹ä»¶</div><div class="line">#pragma mark Send business event</div><div class="line"></div><div class="line">//ä¸šåŠ¡ç”¨ä¾‹</div><div class="line">#pragma mark Business use case</div><div class="line"></div><div class="line">//è·å–ç”Ÿæˆmodeléœ€è¦çš„æ•°æ®</div><div class="line">#pragma mark Request data for model</div><div class="line"></div><div class="line">//ç»´æŠ¤model</div><div class="line">#pragma mark Manage model</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿™é‡Œç¼ºå°‘äº†ViewçŠ¶æ€ç®¡ç†ã€ä¸šåŠ¡çŠ¶æ€ç®¡ç†ç­‰èŒè´£ï¼Œå› ä¸ºè¿™äº›çŠ¶æ€ä¸€èˆ¬éƒ½æ˜¯@propertyï¼Œç”¨pragma markä¸èƒ½åˆ†éš”å®ƒä»¬ï¼Œåªèƒ½åœ¨@interfaceé‡Œå£°æ˜çš„æ—¶å€™è¿›è¡Œéš”ç¦»ã€‚</p>
<h2 id="æ–¹æ¡ˆäºŒï¼šå…è®¸é€‚å½“è€¦åˆ"><a href="#æ–¹æ¡ˆäºŒï¼šå…è®¸é€‚å½“è€¦åˆ" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šå…è®¸é€‚å½“è€¦åˆ"></a>æ–¹æ¡ˆäºŒï¼šå…è®¸é€‚å½“è€¦åˆ</h2><p>ä¸Šé¢çš„æ–¹æ¡ˆæ˜¯ä»¥æœ€å½»åº•çš„è§£è€¦ä¸ºç›®æ ‡è®¾è®¡çš„ï¼Œåœ¨å®è·µä¸­ï¼Œå¦‚æœçœŸçš„å®Œå…¨æŒ‰ç…§è¿™ä¸ªè®¾è®¡ï¼Œä»£ç é‡çš„ç¡®ä¸å°ã€‚å…¶å®ä¸€äº›åœ°æ–¹çš„è€¦åˆå¹¶ä¸ä¼šå¼•èµ·å¤šå¤§é—®é¢˜ï¼Œé™¤éä½ çš„æ¨¡å—éœ€è¦å°è£…æˆé€šç”¨ç»„ä»¶ä¾›å¤šä¸ªappä½¿ç”¨ï¼Œå¦åˆ™å¹¶ä¸éœ€è¦æŒ‰ç…§100%çš„è§£è€¦è¦æ±‚æ¥ç¼–å†™ã€‚å› æ­¤æ¥ä¸‹æ¥æˆ‘å†æ€»ç»“ä¸€ä¸ªç¨å¾®ç®€åŒ–çš„æ–¹æ¡ˆï¼Œæ€»ç»“ä¸€ä¸‹å„éƒ¨åˆ†å¯ä»¥åœ¨å“ªäº›åœ°æ–¹å‡ºç°è€¦åˆï¼Œå“ªäº›è€¦åˆä¸èƒ½å‡ºç°ã€‚</p>
<p>åœ¨è¿™ä¸ªæ–¹æ¡ˆé‡Œï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªä¸­ä»‹è€…æ¥å‡å°‘ä¸€éƒ¨åˆ†ä»£ç ï¼ŒRouterå°±æ˜¯ä¸€ä¸ªå¾ˆé€‚åˆæˆä¸ºä¸­ä»‹è€…çš„è§’è‰²ã€‚</p>
<p>æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-2a5e4eaf6275caba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="final_viper"></p>
<h3 id="View-1"><a href="#View-1" class="headerlink" title="View"></a>View</h3><ul>
<li>Viewå¯ä»¥ç›´æ¥é€šè¿‡Routerå¼•å…¥å¦ä¸€ä¸ªå­Viewï¼Œä¸éœ€è¦é€šè¿‡Presenterçš„è·¯ç”±æ¥å¼•å…¥</li>
<li>Viewä¸­çš„ä¸€äº›delegateå¦‚æœå˜åŒ–çš„å¯èƒ½æ€§ä¸å¤§ï¼Œå¯ä»¥ç›´æ¥è®©Presenterå®ç°ï¼ˆä¾‹å¦‚<code>UITableViewDataSource</code>ï¼‰ï¼Œä¸ç”¨å†å°è£…ä¸€éåäº¤ç»™Presenter</li>
<li>Viewä¸èƒ½å‡ºç°Modelç±»</li>
</ul>
<h3 id="Presenter-1"><a href="#Presenter-1" class="headerlink" title="Presenter"></a>Presenter</h3><ul>
<li>Presenterå¯ä»¥ç›´æ¥è°ƒç”¨Routeræ‰§è¡Œè·¯ç”±ï¼Œä¸ç”¨å†é€šè¿‡Wireframeå°è£…ä¸€é</li>
<li>Presenterçš„æ¥å£å‚æ•°ä¸­å¯ä»¥å‡ºç°Modelç±»ï¼Œä½†æ˜¯ä¸èƒ½å¯¼å…¥Modelç±»çš„å¤´æ–‡ä»¶å¹¶ä¸”ä½¿ç”¨Modelç±»ï¼Œåªèƒ½ç”¨äºå‚æ•°ä¼ é€’</li>
<li>Presenterä¸­ä¸å»ºè®®å¯¼å…¥UIKitï¼Œé™¤éèƒ½ä¿è¯ä¸ä¼šä½¿ç”¨é‚£äº›ä¼šå½±å“æ§ä»¶æ¸²æŸ“çš„æ–¹æ³•</li>
</ul>
<h3 id="Interactor-1"><a href="#Interactor-1" class="headerlink" title="Interactor"></a>Interactor</h3><ul>
<li>ä¸€äº›appä¸­å¸¸ç”¨çš„Serviceå¯ä»¥ç›´æ¥å¼•å…¥ï¼Œä¸éœ€è¦é€šè¿‡å¤–éƒ¨æ³¨å…¥çš„æ–¹å¼æ¥ä½¿ç”¨</li>
<li>Interactorå¯ä»¥ç”¨ä¸€ä¸ªService Routeræ¥åŠ¨æ€è·å–Service</li>
</ul>
<h3 id="è·¯ç”±å’Œä¾èµ–æ³¨å…¥"><a href="#è·¯ç”±å’Œä¾èµ–æ³¨å…¥" class="headerlink" title="è·¯ç”±å’Œä¾èµ–æ³¨å…¥"></a>è·¯ç”±å’Œä¾èµ–æ³¨å…¥</h3><p>æ”¹å˜å¾—æœ€å¤šçš„å°±æ˜¯è·¯ç”±éƒ¨åˆ†ã€‚Viewã€Presenterå’ŒInteractoréƒ½å¯ä»¥ä½¿ç”¨è·¯ç”±æ¥è·å–ä¸€äº›æ¨¡å—ã€‚Viewå¯ä»¥é€šè¿‡è·¯ç”±è·å–å­Viewï¼ŒPresenterå¯ä»¥é€šè¿‡è·¯ç”±è·å–å…¶ä»–Viewæ¨¡å—ï¼ŒInteractorå¯ä»¥é€šè¿‡è·¯ç”±è·å–Serviceã€‚</p>
<p>åœ¨å®ç°æ—¶ï¼Œå¯ä»¥æŠŠWireframeã€Routerã€Builderæ•´åˆåˆ°ä¸€èµ·ï¼Œå…¨éƒ½æ”¾åˆ°Routeré‡Œï¼ŒRouterç”±æ¨¡å—å®ç°å¹¶æä¾›ç»™å¤–éƒ¨ä½¿ç”¨ã€‚ç±»ä¼¼äºBrigadeå›¢é˜Ÿå’ŒRambler&amp;Coå›¢é˜Ÿçš„å®ç°ã€‚ä½†æ˜¯ä»–ä»¬çš„å®ç°éƒ½æ˜¯ç›´æ¥åœ¨Routeré‡Œå¼•å…¥å…¶ä»–æ¨¡å—çš„Routerï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¾èµ–æ··ä¹±ï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯é€šè¿‡ä¸€ä¸ªä¸­é—´äººç»Ÿä¸€æä¾›å…¶ä»–æ¨¡å—çš„æ¥å£ã€‚</p>
<p>æˆ‘åœ¨è¿™é‡Œé€ äº†ä¸ªè½®å­ï¼Œé€šè¿‡protocolæ¥å¯»æ‰¾éœ€è¦çš„æ¨¡å—å¹¶æ‰§è¡Œè·¯ç”±ï¼Œä¸ç”¨ç›´æ¥å¯¼å…¥ç›®çš„æ¨¡å—ä¸­çš„ç±»ï¼Œå¹¶ä¸”æä¾›äº†Adapterçš„æ”¯æŒï¼Œå¯ä»¥è®©å¤šä¸ªprotocolæŒ‡å‘åŒä¸€ä¸ªæ¨¡å—ã€‚è¿™æ ·å°±èƒ½é¿å…æ¨¡å—é—´çš„ç›´æ¥ä¾èµ–ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">///editoræ¨¡å—çš„ä¾èµ–å£°æ˜</div><div class="line">@protocol NoteEditorProtocol &lt;NSObject&gt;</div><div class="line">@property (nonatomic, weak) id&lt;ZIKEditorDelegate&gt; delegate;</div><div class="line">- (void)constructForCreatingNewNote;</div><div class="line">- (void)constructForEditingNote:(ZIKNoteModel *)note;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ZIKNoteListViewPresenter</div><div class="line"></div><div class="line">- (void)handleDidSelectRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">    NSAssert([[self.view routeSource] isKindOfClass:[UIViewController class]], nil);</div><div class="line">    </div><div class="line">    //è·³è½¬åˆ°ç¼–è¾‘å™¨ç•Œé¢ï¼›é€šè¿‡protocolè·å–å¯¹åº”çš„routerç±»ï¼Œå†é€šè¿‡protocolæ³¨å…¥ä¾èµ–</div><div class="line">    //Appå¯ä»¥ç”¨AdapteræŠŠNoteEditorProtocolå’ŒçœŸæ­£çš„protocolè¿›è¡ŒåŒ¹é…å’Œè½¬æ¥</div><div class="line">    [ZIKViewRouterForConfig(@protocol(NoteEditorProtocol))</div><div class="line">	     performWithConfigure:^(ZIKViewRouteConfiguration&lt;NoteEditorProtocol&gt; *config) &#123;</div><div class="line">	         //è·¯ç”±é…ç½®</div><div class="line">	         //è·³è½¬çš„æºç•Œé¢</div><div class="line">	         config.source = [self.view routeSource];</div><div class="line">	         //è®¾ç½®è·³è½¬æ–¹å¼ï¼Œæ”¯æŒæ‰€æœ‰ç•Œé¢è·³è½¬ç±»å‹</div><div class="line">	         config.routeType = ZIKViewRouteTypePush;</div><div class="line">	         //Routerå†…éƒ¨è´Ÿè´£ç”¨è·å–åˆ°çš„å‚æ•°åˆå§‹åŒ–editoræ¨¡å—</div><div class="line">	         config.delegate = self;</div><div class="line">	         [config constructForEditingNote:[self.interactor noteAtIndex:indexPath.row]];</div><div class="line">	         config.prepareForRoute = ^(id destination) &#123;</div><div class="line">	             //è·³è½¬å‰é…ç½®ç›®çš„ç•Œé¢</div><div class="line">	         &#125;;</div><div class="line">	         config.routeCompletion = ^(id destination) &#123;</div><div class="line">	             //è·³è½¬ç»“æŸå¤„ç†</div><div class="line">	         &#125;;</div><div class="line">	         config.performerErrorHandler = ^(SEL routeAction, NSError * error) &#123;</div><div class="line">	             //è·³è½¬å¤±è´¥å¤„ç†</div><div class="line">	         &#125;;</div><div class="line">	     &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸ªæ–¹æ¡ˆä¾èµ–äºä¸€ä¸ªç»Ÿä¸€çš„ä¸­é—´äººï¼Œä¹Ÿå°±æ˜¯è·¯ç”±å·¥å…·ï¼Œåœ¨æˆ‘çš„å®ç°é‡Œå°±æ˜¯<a href="https://github.com/Zuikyo/ZIKRouter" target="_blank" rel="external">ZIKRouter</a>ã€‚Viewã€Presenterã€Interactoréƒ½å¯ä»¥ä½¿ç”¨å¯¹åº”åŠŸèƒ½çš„Routerè·å–å­æ¨¡å—ã€‚è€Œç”±äºZIKRouterä»ç„¶æ˜¯é€šè¿‡protocolçš„æ–¹å¼æ¥å’Œå­æ¨¡å—è¿›è¡Œäº¤äº’ï¼Œå› æ­¤ä»ç„¶å¯ä¿æŒæ¨¡å—é—´è§£è€¦ã€‚å”¯ä¸€çš„è€¦åˆå°±æ˜¯å„éƒ¨åˆ†éƒ½å¼•ç”¨äº†ZIKRouterè¿™ä¸ªå·¥å…·ã€‚å¦‚æœä½ æƒ³æŠŠæ¨¡å—å’ŒZIKRouterçš„è€¦åˆä¹Ÿå»é™¤ï¼Œå¯ä»¥è®©Routerä¹Ÿå˜æˆé¢å‘æ¥å£ï¼Œç”±å¤–éƒ¨æ³¨å…¥ã€‚</p>
<h2 id="Demoå’Œä»£ç æ¨¡æ¿"><a href="#Demoå’Œä»£ç æ¨¡æ¿" class="headerlink" title="Demoå’Œä»£ç æ¨¡æ¿"></a>Demoå’Œä»£ç æ¨¡æ¿</h2><p>é’ˆå¯¹ä¸¤ä¸ªæ–¹æ¡ˆï¼ŒåŒæ—¶å†™äº†ä¸¤ä¸ªç›¸åŒåŠŸèƒ½çš„Demoï¼Œå¯ä»¥æ¯”è¾ƒä¸€ä¸‹ä»£ç ä¸Šçš„åŒºåˆ«ã€‚åœ°å€åœ¨ï¼š<a href="https://github.com/Zuikyo/ZIKViper" target="_blank" rel="external">ZIKViper</a></p>
<p>é¡¹ç›®é‡Œä¹Ÿæä¾›äº†Xcode File Templateç”¨äºå¿«é€Ÿç”ŸæˆVIPERä»£ç æ¨¡æ¿ã€‚æŠŠ<code>.xctemplate</code>åç¼€çš„æ–‡ä»¶å¤¹æ‹·è´åˆ°<code>~/Library/Developer/Xcode/Templates/</code>ç›®å½•ä¸‹ï¼Œå°±å¯ä»¥åœ¨Xcodeçš„<code>New-&gt;File-&gt;Template</code>é‡Œé€‰æ‹©ä»£ç æ¨¡æ¿å¿«é€Ÿç”Ÿæˆä»£ç ã€‚</p>
<h2 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>VIPERæ˜¯æŒ‰ç…§Clean Architectureä¸­ç”±å¤–å‘å†…çš„ä¾èµ–è¿›è¡Œè®¾è®¡çš„ï¼Œå„éƒ¨åˆ†èŒè´£ååˆ†æ˜ç¡®ã€‚å¹¶ä¸”ç”±äºå¼•å…¥äº†è·¯ç”±éƒ¨åˆ†ï¼Œæ›´å®¹æ˜“æ”¯æŒç»„ä»¶åŒ–å¼€å‘ã€‚</p>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« å°†è®¨è®ºåŸºäºæ¥å£çš„è·¯ç”±è®¾è®¡ï¼Œæ€»ç»“UIKitä¸­çš„å„ç§è§†å›¾è½¬åœºï¼Œå¹¶è®²è§£ZIKRouterçš„å®ç°ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="https://mutualmobile.com/posts/meet-viper-fast-agile-non-lethal-ios-architecture-framework" target="_blank" rel="external">MEET VIPER: MUTUAL MOBILEâ€™S APPLICATION OF CLEAN ARCHITECTURE FOR IOS APPS</a></li>
<li><a href="https://www.objc.io/issues/13-architecture/viper/" target="_blank" rel="external">Architecting iOS Apps with VIPER</a></li>
<li><a href="https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html" target="_blank" rel="external">Clean Architecture</a></li>
<li><a href="https://brigade.engineering/brigades-experience-using-an-mvc-alternative-36ef1601a41f" target="_blank" rel="external">Brigadeâ€™s Experience Using an MVC Alternative: VIPER architecture for iOS applications</a></li>
<li><a href="https://swifting.io/blog/2016/03/07/8-viper-to-be-or-not-to-be/" target="_blank" rel="external">VIPER to be or not to be?</a></li>
<li><a href="https://cheesecakelabs.com/blog/best-practices-viper-architecture/" target="_blank" rel="external">VIPER architecture: Our best practices to build an app like a boss</a></li>
<li><a href="https://github.com/strongself/The-Book-of-VIPER" target="_blank" rel="external">The-Book-of-VIPER</a></li>
<li><a href="https://eng.uber.com/new-rider-app/" target="_blank" rel="external">ENGINEERING THE ARCHITECTURE BEHIND UBERâ€™S NEW RIDER APP</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/21/iOS VIPERæ¶æ„å®è·µ(ä¸€)ï¼šä»MVCåˆ°MVVMåˆ°VIPER/" itemprop="url">
                  iOS VIPERæ¶æ„å®è·µ(ä¸€)ï¼šä»MVCåˆ°MVVMåˆ°VIPER
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2017-07-21T20:58:29+08:00" content="2017-07-21">
              2017-07-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ä»£ç æ¶æ„/" itemprop="url" rel="index">
                    <span itemprop="name">ä»£ç æ¶æ„</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/07/21/iOS VIPERæ¶æ„å®è·µ(ä¸€)ï¼šä»MVCåˆ°MVVMåˆ°VIPER/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/07/21/iOS VIPERæ¶æ„å®è·µ(ä¸€)ï¼šä»MVCåˆ°MVVMåˆ°VIPER/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æœ€è¿‘åŠå¹´åœ¨å†™appçš„æ—¶å€™ï¼Œç ”ç©¶äº†ä¸€ä¸‹å„ç§iOSä»£ç æ¶æ„ï¼Œæœ€åé€‰æ‹©äº†VIPERè¿›è¡Œå®è·µï¼Œåœ¨æ­¤å¯¹å®è·µä¸­é‡åˆ°çš„å„ç§è®¾è®¡é—®é¢˜åšä¸€ç•ªæ€»ç»“ï¼Œå¹¶åˆ†äº«é€ å‡ºçš„è½®å­ã€‚</p>
<p>å¯¹ä»£ç é£æ ¼å’Œæ¶æ„æœ‰å…´è¶£çš„åŒå­¦ï¼Œè‚¯å®šéƒ½å·²ç»åœ¨å¾ˆå¤šåœ°æ–¹è§è¿‡å„ç§æ¶æ„çš„ä»‹ç»ã€‚MVCã€MVPã€MVVMã€VIPERï¼Œç»†åˆ†ç¨‹åº¦é€æ¸ä¸Šå‡ã€‚è¿™äº›æ¶æ„è®¾è®¡éƒ½æ˜¯æ¥è‡ªMVCï¼Œåªæ˜¯å„è‡ªç”¨ä¸åŒçš„æ–¹å¼å¯¹MVCè¿›è¡Œäº†ç»†åˆ†ï¼Œåœ¨æ­¤åªå¯¹MVCã€MVPå’ŒMVVMä½œç²¾ç®€ä»‹ç»ï¼Œæƒ³è¦è¯¦ç»†äº†è§£å¯ä»¥å‚è€ƒè¿™äº›æ–‡ç« ï¼š</p>
<p><a href="http://ios.jobbole.com/83727/" target="_blank" rel="external">iOS æ¶æ„æ¨¡å¼â€“è§£å¯† MVCï¼ŒMVPï¼ŒMVVMä»¥åŠVIPERæ¶æ„</a>,</p>
<p><a href="http://draveness.me/mvx.html" target="_blank" rel="external">æµ…è°ˆ MVCã€MVP å’Œ MVVM æ¶æ„æ¨¡å¼</a>ã€‚</p>
<h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><p><code>Model-View-Controller</code>ã€‚MVCç®€å•åœ°å°†ä¸€ä¸ªæ¨¡å—åˆ†ä¸º3éƒ¨åˆ†ï¼š</p>
<ul>
<li>Viewæ˜¯å±•ç¤ºç»™å¤–éƒ¨çš„ç•Œé¢</li>
<li>Modelæ˜¯Controllerå†…éƒ¨ç®¡ç†çš„æ•°æ®æ¨¡å‹</li>
<li>Controllerè´Ÿè´£å°†Modelçš„å˜åŒ–æ›´æ–°åˆ°View</li>
<li>Controllerè´Ÿè´£å¤„ç†æ¥è‡ªViewçš„äº‹ä»¶</li>
</ul>
<p>MVCçš„åˆ’åˆ†ç²’åº¦å¾ˆç²—ï¼Œå› æ­¤æœ‰å¾ˆå¤šç§å…·ä½“å®ç°ï¼Œå„ä¸ªå®ç°æœ‰å·®å¼‚ï¼Œå› æ­¤å¹¶æ²¡æœ‰ä¸€ä¸ªååˆ†æ˜ç¡®çš„æ ‡å‡†å®šä¹‰ã€‚</p>
<h2 id="è‹¹æœçš„MVC"><a href="#è‹¹æœçš„MVC" class="headerlink" title="è‹¹æœçš„MVC"></a>è‹¹æœçš„MVC</h2><p>è‹¹æœçš„Cocoa Touchå°±éµç…§äº†MVCçš„è®¾è®¡ï¼Œä¸€ä¸ªç•Œé¢åˆ†ä¸ºUIViewå’ŒUIViewControllerï¼ŒUIViewè´Ÿè´£æ¸²æŸ“å’Œæ¥æ”¶è§¦æ‘¸äº‹ä»¶ï¼ŒUIViewControllerè´Ÿè´£å­viewä¹‹é—´çš„å¸ƒå±€ã€ç»„åˆã€æ›´æ–°ä»¥åŠäº‹ä»¶å¤„ç†ã€‚</p>
<p>å°½ç®¡è‹¹æœå·²ç»ç»™æˆ‘ä»¬æä¾›äº†ç®€å•çš„MVCæ”¯æŒï¼Œä½†æ˜¯åœ¨å®è·µä¸­æˆ‘ä»¬å´å¸¸å¸¸æ²¡æœ‰éµå®ˆMVCã€‚åŸå› åœ¨äºCocoa Touchä¸­çš„Modeléƒ¨åˆ†æ˜¯ç”±æˆ‘ä»¬è‡ªå·±è´Ÿè´£ç®¡ç†çš„ï¼Œå¹¶æ²¡æœ‰æä¾›åŸç”Ÿçš„è®¾è®¡æ”¯æŒã€‚æ‰€ä»¥æœ‰æ—¶å€™ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šä¸€ä¸ªUIViewä¸ºäº†æ–¹ä¾¿ï¼Œæä¾›äº†ä¸€ä¸ªä»æŸä¸ªmodelè¿›è¡Œé…ç½®çš„æ–¹æ³•ã€‚ä¹ä¸€çœ‹ååˆ†åˆç†ï¼Œä½†æ˜¯ä»”ç»†æƒ³æƒ³å°±ä¼šå‘ç°ï¼Œè¿™ä¹ˆåšå·²ç»å°†Viewå’ŒModelè€¦åˆï¼Œå¾ˆå®¹æ˜“å°±ç ´åäº†MVCã€‚</p>
<p>å¦å¤–ï¼ŒUIViewControllerå­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œå¯¼è‡´äº†å®ƒå¾ˆå®¹æ˜“å˜å¾—è‡ƒè‚¿å’Œè€¦åˆã€‚</p>
<p>é¦–å…ˆï¼ŒUIViewControllerå’ŒUIViewè€¦åˆå¾—ååˆ†ç´§å¯†ï¼Œå¯¼è‡´UIViewControllerç»å¸¸å’ŒæŸäº›å…·ä½“çš„UIViewè€¦åˆï¼Œå‡ ä¹æ— æ³•é‡ç”¨ã€‚è€Œä¸”åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œå¾ˆéš¾åšåˆ°å•ç‹¬æµ‹è¯•æ²¡æœ‰Viewçš„é‚£éƒ¨åˆ†ä»£ç ï¼Œå› ä¸ºåœ¨å†™çš„æ—¶å€™å°±å¾ˆå®¹æ˜“å°†Viewçš„é€»è¾‘å…¥ä¾µåˆ°å„å¤„ï¼ŒControllerä¼šå—åˆ°Viewçš„çŠ¶æ€çš„å½±å“ï¼Œæ— æ³•ç¨³å®šæµ‹è¯•ã€‚å› æ­¤ï¼Œåº”è¯¥å°½é‡æŠŠå’ŒViewæ— å…³çš„ä»£ç æ”¾åˆ°UIViewControllerä¹‹å¤–ã€‚</p>
<p>ç¬¬äºŒï¼ŒUIViewControllerè´Ÿè´£äº†ç•Œé¢è·³è½¬çš„æ“ä½œï¼Œç•Œé¢è·³è½¬çš„ç›¸å…³é…ç½®æ˜¯ç›´æ¥åœ¨å¯¹åº”çš„UIViewControllerå®ä¾‹ä¸Šè®¾ç½®çš„ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“æŠŠæºç•Œé¢å’Œç›®çš„ç•Œé¢è€¦åˆèµ·æ¥ï¼Œç®€å•åœ°æŠŠç•Œé¢è·³è½¬çš„éƒ¨åˆ†å•ç‹¬æŠ½ç¦»ä¸ºä¸€ä¸ªå°è£…å¥½çš„è·³è½¬æ–¹æ³•å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘è¿™éƒ¨åˆ†è€¦åˆï¼Œä½†ä¹Ÿä¸å¯é¿å…åœ°ä¼šå¤šå†™è®¸å¤šä»£ç ã€‚</p>
<p>å› æ­¤ï¼Œè‹¹æœçš„MVCï¼Œå®é™…ä¸Šæ˜¯<code>Model-View-ViewController</code>ã€‚å®ƒæ˜¯ä¸€ä¸ªè§†å›¾é©±åŠ¨çš„è®¾è®¡ï¼ŒControlleråªæ˜¯ä¸ºäº†ç®¡ç†Viewè€Œå­˜åœ¨çš„ã€‚è‹¹æœæŠŠUIViewControllerå’ŒModelçš„å…³ç³»è®¾è®¡äº¤ç»™äº†æˆ‘ä»¬è‡ªå·±ã€‚æ‰€ä»¥ï¼Œå¦‚ä½•æŠŠä¸€ä¸ªUIViewControllerè¿›è¡Œæ›´æ˜ç¡®çš„åˆ†å·¥ï¼Œå°±æ˜¯è¿™äº›æ¶æ„è¦åšçš„äº‹ã€‚</p>
<h2 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h2><p><code>Model-View-Presenter</code>ç”¨ä¸€ä¸ªPresenterï¼ŒæŠŠControllerä¸­Viewçš„éƒ¨åˆ†å‰”é™¤ï¼Œå®ç°äº†Viewå’ŒModelçš„éš”ç»ã€‚å„éƒ¨åˆ†åˆ†å·¥å¦‚ä¸‹ï¼š</p>
<ul>
<li>Viewè´Ÿè´£ç•Œé¢å±•ç¤ºå’Œå¸ƒå±€ç®¡ç†ï¼Œå‘Presenteræš´éœ²è§†å›¾æ›´æ–°å’Œæ•°æ®è·å–çš„æ¥å£</li>
<li>Presenterè´Ÿè´£æ¥æ”¶æ¥è‡ªViewçš„äº‹ä»¶ï¼Œé€šè¿‡Viewæä¾›çš„æ¥å£æ›´æ–°è§†å›¾ï¼Œå¹¶ç®¡ç†Model</li>
<li>Modelå’ŒMVCä¸­çš„ä¸€æ ·ï¼Œæä¾›æ•°æ®æ¨¡å‹</li>
</ul>
<p>åœ¨iOSé‡Œï¼ŒUIViewå’ŒUIViewControllerå…±åŒç»„åˆæˆäº†MVPä¸­çš„Viewã€‚UIViewè´Ÿè´£å…ƒç´ çš„å±•ç¤ºï¼ŒUIViewControllerè´Ÿè´£ç•Œé¢å¸ƒå±€å’Œç»„åˆï¼Œå¹¶æŠŠäº‹ä»¶è½¬å‘ç»™Presenterã€‚<br>å› æ­¤åœ¨MVPé‡Œï¼Œä¸šåŠ¡é€»è¾‘è¢«æ”¾åˆ°äº†Presenterä¸­ï¼Œç”±å®ƒè´Ÿè´£åè°ƒViewå’ŒModelã€‚è€Œç”±äºViewçš„æŠ½ç¦»ï¼ŒPresenterçš„çŠ¶æ€æ˜¯å¯æ§çš„ï¼Œåœ¨æµ‹è¯•æ—¶æ›´ä¸å®¹æ˜“å—å¤–éƒ¨å½±å“ã€‚</p>
<p>åœ¨iOSä¸­ä½¿ç”¨MVPå¾ˆç®€å•ï¼Œåœ¨Viewå’ŒPresenterä¹‹é—´ç”¨protocolåšå¥½äº‹ä»¶ä¼ é€’å°±å¯ä»¥ã€‚ç¼ºç‚¹å°±æ˜¯å¤šäº†ä¸€å±‚ç”¨äºéš”ç¦»çš„æ¥å£ï¼Œä¼šå¯¼è‡´ä»£ç æ•°é‡å¢å¤§ã€‚</p>
<p>ä½†æ˜¯éšç€ç•Œé¢è¶Šæ¥è¶Šå¤æ‚ï¼ŒPresenterä¸­çš„ä¸šåŠ¡ä»£ç ä¹Ÿä¼šè¶Šæ¥è¶Šåºå¤§ï¼Œæ€»æœ‰ä¸€å¤©ä¼šé‡åˆ°ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šå¦‚ä½•å†ç»†åˆ†Presenterã€‚</p>
<h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p><code>Model-View-ViewModel-Controller</code>æ¨¡å¼ï¼Œå®ƒä¹Ÿå’ŒMVPä¸€æ ·ï¼Œç›®çš„æ˜¯è§£å†³Viewå’ŒModelçš„è€¦åˆã€‚å„éƒ¨åˆ†åˆ†å·¥å¦‚ä¸‹ï¼š</p>
<ul>
<li>Modelæä¾›æ•°æ®æ¨¡å‹</li>
<li>Viewè´Ÿè´£è§†å›¾å±•ç¤º</li>
<li>ViewModelç”¨äºæè¿°Viewçš„çŠ¶æ€ï¼Œä¾‹å¦‚Viewçš„é¢œè‰²ã€æ˜¾ç¤ºçš„æ–‡å­—ç­‰å±æ€§ç±»çš„ä¿¡æ¯ï¼Œå°†ViewæŠ½è±¡æˆäº†ä¸€ä¸ªç‰¹æ®Šçš„æ¨¡å‹</li>
<li>Controller(Presenter)é€šè¿‡ä¿®æ”¹ViewModelæ¥æ›´æ–°Viewï¼Œå¹¶ä¸”è´Ÿè´£äº‹ä»¶å¤„ç†ï¼Œç»´æŠ¤Model</li>
</ul>
<p>åœ¨MVPä¸­ï¼ŒViewé€šè¿‡æ¥å£çš„æ–¹å¼æ¥æè¿°è‡ªå·±ï¼Œåœ¨MVVMä¸­ï¼Œåˆ™é€šè¿‡ViewModelæ¥æè¿°è‡ªå·±çš„ç‰¹å¾ã€‚é‚£ä¹ˆViewModelå¦‚ä½•å°†è‡ªå·±çš„å˜åŒ–æ›´æ–°åˆ°Viewä¸Šå‘¢ï¼ŸMVVMç»å¸¸å’Œæ•°æ®ç»‘å®šä¸€èµ·å‡ºç°ï¼Œåœ¨Controllerä¸­ï¼Œå°†Viewå’ŒViewModelçš„å±æ€§ç”¨ç±»ä¼¼KVOçš„æ–¹å¼è¿›è¡Œç»‘å®šï¼Œè¿™æ ·ViewModelçš„å˜åŒ–å°±èƒ½ç«‹å³ä¼ è¾“åˆ°Viewä¸Šã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„Controllerä¸æ˜¯UIViewControllerï¼Œè€Œæ˜¯è´Ÿè´£æ¨¡å—ä¸šåŠ¡é€»è¾‘çš„ä¸€ä¸ªè§’è‰²ï¼Œç±»ä¼¼äºPresenterã€‚</p>
<p>ä½†æ˜¯æ•°æ®ç»‘å®šçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šè°ƒè¯•å›°éš¾ï¼Œæ•°æ®æ¥æºéš¾ä»¥å›æº¯ï¼Œåœ¨çº¿ä¸Šå‡ºbugçš„æ—¶å€™å°±å¾ˆéš¾è¿½è¸ªäº†ã€‚</p>
<p>å…¶å®æ•°æ®ç»‘å®šåªæ˜¯ä¸€ç§ä¸ºäº†å‡å°‘èƒ¶æ°´ä»£ç çš„æŠ€æœ¯å®ç°æ–¹å¼ï¼ŒMVVMçš„è®¾è®¡å¹¶æ²¡æœ‰è¦æ±‚å¿…é¡»è¦ä½¿ç”¨æ•°æ®ç»‘å®šï¼Œä½ ä¹Ÿå®Œå…¨å¯ä»¥ä½¿ç”¨protocolçš„æ–¹å¼æ¥å°†ViewModelçš„å˜åŒ–ä¼ é€’ç»™Viewï¼Œè®©æ•°æ®æµå‘æ›´æ¸…æ™°ã€‚MVVMçš„å…³é”®æ˜¯å°†Viewè¿›è¡Œäº†æŠ½è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªæŠ½è±¡å¾ˆå®¹æ˜“åœ¨å…¶ä»–Controllerä¸­å¤ç”¨ã€‚</p>
<p>Controlleråœ¨ç»‘å®šå®ŒViewå’ŒViewModelä¹‹åï¼Œå°±ä¸åº”è¯¥åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨Viewäº†ã€‚ä½ ä¹Ÿå¯ä»¥å•ç‹¬ç”¨ä¸€ä¸ªViewModelManageræ¥è´Ÿè´£è®¾ç½®ViewModelå’ŒViewä¹‹é—´çš„æ•°æ®ä¼ é€’ã€‚è€Œå…¶ä»–çš„ä¸šåŠ¡ä»£ç ï¼Œè¿˜æ˜¯æ”¾åœ¨Controllerä¸­ï¼ŒViewModelåº”è¯¥åªè´Ÿè´£ç®¡ç†Viewç›¸å…³çš„çŠ¶æ€ã€ä¼ é€’Viewçš„äº‹ä»¶ï¼Œä¸åº”è¯¥å­˜åœ¨æœ¬å±äºControllerä¸­çš„å…¶ä»–ä¸šåŠ¡ã€‚å½“ç„¶å¦‚æœä½ ä¸æ‰“ç®—é‡ç”¨è¿™ä¸ªViewModelçš„è¯ï¼Œä¹Ÿå¯ä»¥åœ¨ViewModelé‡ŒåŠ å…¥ä¸€äº›å’ŒModelç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œç»´æŠ¤Modelï¼Œåªä¸è¿‡åŸºäºå•ä¸€èŒè´£åŸåˆ™ï¼Œè¿™ä¹ˆåšæ˜¯ä¸å¥½çš„ã€‚</p>
<p>å’ŒMVPç›¸æ¯”ï¼ŒMVVMç”¨äº†ä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼æ¥æŠ½è±¡Viewã€‚ä½†å®ƒå’ŒMVPå…¶å®æ˜¯ç±»ä¼¼çš„ï¼Œä»ç„¶æ²¡æœ‰å¯¹Controllerè¿›è¡Œè¿›ä¸€æ­¥çš„ç»†åˆ†ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•å¯¹Controllerè¿›è¡Œè¿›ä¸€æ­¥çš„èŒè´£ç»†åˆ†å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯VIPERã€‚</p>
<h2 id="VIPER"><a href="#VIPER" class="headerlink" title="VIPER"></a>VIPER</h2><p>VIPERçš„å…¨ç§°æ˜¯<code>View-Interactor-Presenter-Entity-Router</code>ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-580872920986b640.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="VIPER"></p>
<p>ç›¸æ¯”ä¹‹å‰çš„MVXæ¶æ„ï¼ŒVIPERå¤šå‡ºäº†ä¸¤ä¸ªä¸œè¥¿ï¼šInteractorï¼ˆäº¤äº’å™¨ï¼‰å’ŒRouterï¼ˆè·¯ç”±ï¼‰ã€‚</p>
<p>å„éƒ¨åˆ†èŒè´£å¦‚ä¸‹ï¼š</p>
<h3 id="View"><a href="#View" class="headerlink" title="View"></a>View</h3><ul>
<li>æä¾›å®Œæ•´çš„è§†å›¾ï¼Œè´Ÿè´£è§†å›¾çš„ç»„åˆã€å¸ƒå±€ã€æ›´æ–°</li>
<li>å‘Presenteræä¾›æ›´æ–°è§†å›¾çš„æ¥å£</li>
<li>å°†Viewç›¸å…³çš„äº‹ä»¶å‘é€ç»™Presenter</li>
</ul>
<h3 id="Presenter"><a href="#Presenter" class="headerlink" title="Presenter"></a>Presenter</h3><ul>
<li>æ¥æ”¶å¹¶å¤„ç†æ¥è‡ªViewçš„äº‹ä»¶</li>
<li>å‘Interactorè¯·æ±‚è°ƒç”¨ä¸šåŠ¡é€»è¾‘</li>
<li>å‘Interactoræä¾›Viewä¸­çš„æ•°æ®</li>
<li>æ¥æ”¶å¹¶å¤„ç†æ¥è‡ªInteractorçš„æ•°æ®å›è°ƒäº‹ä»¶</li>
<li>é€šçŸ¥Viewè¿›è¡Œæ›´æ–°æ“ä½œ</li>
<li>é€šè¿‡Routerè·³è½¬åˆ°å…¶ä»–View</li>
</ul>
<h3 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h3><ul>
<li>æä¾›Viewä¹‹é—´çš„è·³è½¬åŠŸèƒ½ï¼Œå‡å°‘äº†æ¨¡å—é—´çš„è€¦åˆ</li>
<li>åˆå§‹åŒ–VIPERçš„å„ä¸ªæ¨¡å—</li>
</ul>
<h3 id="Interactor"><a href="#Interactor" class="headerlink" title="Interactor"></a>Interactor</h3><ul>
<li>ç»´æŠ¤ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘åŠŸèƒ½ï¼Œå‘Presenteræä¾›ç°æœ‰çš„ä¸šåŠ¡ç”¨ä¾‹</li>
<li>ç»´æŠ¤ã€è·å–ã€æ›´æ–°Entity</li>
<li>å½“æœ‰ä¸šåŠ¡ç›¸å…³çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¤„ç†äº‹ä»¶ï¼Œå¹¶é€šçŸ¥Presenter</li>
</ul>
<h3 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h3><ul>
<li>å’ŒModelä¸€æ ·çš„æ•°æ®æ¨¡å‹</li>
</ul>
<h3 id="å’ŒMVXçš„åŒºåˆ«"><a href="#å’ŒMVXçš„åŒºåˆ«" class="headerlink" title="å’ŒMVXçš„åŒºåˆ«"></a>å’ŒMVXçš„åŒºåˆ«</h3><p>VIPERæŠŠMVCä¸­çš„Controllerè¿›ä¸€æ­¥æ‹†åˆ†æˆäº†Presenterã€Routerå’ŒInteractorã€‚å’ŒMVPä¸­è´Ÿè´£ä¸šåŠ¡é€»è¾‘çš„Presenterä¸åŒï¼ŒVIPERçš„Presenterçš„ä¸»è¦å·¥ä½œæ˜¯åœ¨Viewå’ŒInteractorä¹‹é—´ä¼ é€’äº‹ä»¶ï¼Œå¹¶ç®¡ç†ä¸€äº›Viewçš„å±•ç¤ºé€»è¾‘ï¼Œä¸»è¦çš„ä¸šåŠ¡é€»è¾‘å®ç°ä»£ç éƒ½æ”¾åœ¨äº†Interactoré‡Œã€‚Interactorçš„è®¾è®¡é‡Œæå‡ºäº†â€ç”¨ä¾‹â€çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯æŠŠæ¯ä¸€ä¸ªä¼šå‡ºç°çš„ä¸šåŠ¡æµç¨‹å°è£…å¥½ï¼Œè¿™æ ·å¯æµ‹è¯•æ€§ä¼šå¤§å¤§æé«˜ã€‚è€ŒRouteråˆ™è¿›ä¸€æ­¥è§£å†³äº†ä¸åŒæ¨¡å—ä¹‹é—´çš„è€¦åˆã€‚æ‰€ä»¥ï¼ŒVIPERå’Œä¸Šé¢å‡ ä¸ªMVXç›¸æ¯”ï¼Œå¤šæ€»ç»“å‡ºäº†å‡ ä¸ªéœ€è¦ç»´æŠ¤çš„ä¸œè¥¿ï¼š</p>
<ul>
<li>Viewäº‹ä»¶ç®¡ç†</li>
<li>æ•°æ®äº‹ä»¶ç®¡ç†</li>
<li>äº‹ä»¶å’Œä¸šåŠ¡çš„è½¬åŒ–</li>
<li>æ€»ç»“æ¯ä¸ªä¸šåŠ¡ç”¨ä¾‹</li>
<li>æ¨¡å—å†…åˆ†å±‚éš”ç¦»</li>
<li>æ¨¡å—é—´é€šä¿¡</li>
</ul>
<p>è€Œè¿™é‡Œé¢ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸€äº›èŒè´£ã€‚VIPERå®é™…ä¸Šå·²ç»æŠŠControllerçš„æ¦‚å¿µæ·¡åŒ–äº†ï¼Œè¿™æ‹†åˆ†å‡ºæ¥çš„å‡ ä¸ªéƒ¨åˆ†ï¼Œéƒ½æœ‰å¾ˆæ˜ç¡®çš„å•ä¸€èŒè´£ï¼Œæœ‰äº›éƒ¨åˆ†ä¹‹é—´æ˜¯å®Œå…¨éš”ç»çš„ï¼Œåœ¨å¼€å‘æ—¶å°±åº”è¯¥æ¸…æ™°åœ°åŒºåˆ†å®ƒä»¬å„è‡ªçš„èŒè´£ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬è§†ä¸ºä¸€ä¸ªControllerã€‚</p>
<h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p>VIPERçš„ç‰¹è‰²å°±æ˜¯èŒè´£æ˜ç¡®ï¼Œç²’åº¦ç»†ï¼Œéš”ç¦»å…³ç³»æ˜ç¡®ï¼Œè¿™æ ·èƒ½å¸¦æ¥å¾ˆå¤šä¼˜ç‚¹ï¼š</p>
<ul>
<li>å¯æµ‹è¯•æ€§å¥½ã€‚UIæµ‹è¯•å’Œä¸šåŠ¡é€»è¾‘æµ‹è¯•å¯ä»¥å„è‡ªå•ç‹¬è¿›è¡Œã€‚</li>
<li>æ˜“äºè¿­ä»£ã€‚å„éƒ¨åˆ†éµå¾ªå•ä¸€èŒè´£ï¼Œå¯ä»¥å¾ˆæ˜ç¡®åœ°çŸ¥é“æ–°çš„ä»£ç åº”è¯¥æ”¾åœ¨å“ªé‡Œã€‚</li>
<li>éš”ç¦»ç¨‹åº¦é«˜ï¼Œè€¦åˆç¨‹åº¦ä½ã€‚ä¸€ä¸ªæ¨¡å—çš„ä»£ç ä¸å®¹æ˜“å½±å“åˆ°å¦ä¸€ä¸ªæ¨¡å—ã€‚</li>
<li>æ˜“äºå›¢é˜Ÿåˆä½œã€‚å„éƒ¨åˆ†åˆ†å·¥æ˜ç¡®ï¼Œå›¢é˜Ÿåˆä½œæ—¶æ˜“äºç»Ÿä¸€ä»£ç é£æ ¼ï¼Œå¯ä»¥å¿«é€Ÿæ¥æ‰‹åˆ«äººçš„ä»£ç ã€‚</li>
</ul>
<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3><ul>
<li>ä¸€ä¸ªæ¨¡å—å†…çš„ç±»æ•°é‡å¢å¤§ï¼Œä»£ç é‡å¢å¤§ï¼Œåœ¨å±‚ä¸å±‚ä¹‹é—´éœ€è¦èŠ±æ›´å¤šæ—¶é—´è®¾è®¡æ¥å£ã€‚</li>
</ul>
<p>ä½¿ç”¨ä»£ç æ¨¡æ¿æ¥è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶å’Œæ¨¡æ¿ä»£ç å¯ä»¥å‡å°‘å¾ˆå¤šé‡å¤åŠ³åŠ¨ï¼Œè€ŒèŠ±è´¹æ—¶é—´è®¾è®¡å’Œç¼–å†™æ¥å£æ˜¯å‡å°‘è€¦åˆçš„è·¯ä¸Šä¸å¯é¿å…çš„ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°æ®ç»‘å®šè¿™æ ·çš„æŠ€æœ¯æ¥å‡å°‘ä¸€äº›ä¼ é€’çš„å±‚æ¬¡ã€‚</p>
<ul>
<li>æ¨¡å—çš„åˆå§‹åŒ–è¾ƒä¸ºå¤æ‚ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„ç•Œé¢éœ€è¦ç”ŸæˆViewã€Presenterã€Interactorï¼Œå¹¶ä¸”è®¾ç½®äº’ç›¸ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚è€ŒiOSä¸­ç¼ºå°‘è¿™ç§è®¾ç½®å¤æ‚åˆå§‹åŒ–çš„åŸç”Ÿæ–¹å¼ã€‚</li>
</ul>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯Cocoaæ¡†æ¶ç¼ºå°‘ä¸€ä¸ªå¼ºå¤§çš„è‡ªå®šä¹‰ä¾èµ–æ³¨å…¥å·¥å…·ã€‚è¿™ä¸ªé—®é¢˜å½±å“ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œå¯ä»¥é€‰ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥åœ¨Routerçš„ç•Œé¢è·³è½¬æ–¹æ³•é‡Œï¼Œå¯¹æ¨¡å—è¿›è¡Œåˆå§‹åŒ–ï¼Œåªä¸è¿‡æ€»æ˜¯ä¸å¤Ÿå®Œç¾ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å®ç°äº†ä¸€ä¸ªåŸºäºprotocolå£°æ˜ä¾èµ–çš„ç•Œé¢è·³è½¬Routerï¼Œå°†ä¼šåœ¨ä¹‹åçš„æ–‡ç« ä¸­è¿›è¡Œè¯¦è§£ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æœ‰äººå¯èƒ½ä¼šè§‰å¾—ï¼Œä¸€ä¸ªç•Œé¢æ¨¡å—çœŸçš„æœ‰å¿…è¦ä½¿ç”¨è¿™ä¹ˆå¤æ‚çš„æ¶æ„å—ï¼Ÿè¿™æ ·æ˜¯ä¸æ˜¯è¿‡åº¦è®¾è®¡ï¼Ÿ</p>
<p>æˆ‘åå¯¹è¿™ç§è§‚ç‚¹ã€‚ä¸è¦è¢«VIPERçš„ç»„ç»‡å›¾å“åˆ°ï¼ŒVIPERå¹¶ä¸å¤æ‚ï¼Œå®ƒæ˜¯å°†åŸæ¥MVCä¸­çš„Controllerä¸­çš„å„ç§ä»»åŠ¡è¿›è¡Œäº†æ¸…æ™°çš„åˆ†è§£ï¼Œåœ¨å†™ä»£ç æ—¶ï¼Œä½ ä¼šå¾ˆæ¸…æ¥šä½ æ­£åœ¨åšä»€ä¹ˆã€‚äº‹å®ä¸Šï¼Œå®ƒæ¯”ä½¿ç”¨äº†æ•°æ®ç»‘å®šæŠ€æœ¯çš„MVVMæ›´åŠ ç®€å•ï¼Œå°±æ˜¯å› ä¸ºå®ƒèŒè´£æ˜ç¡®ã€‚ä»MVCè½¬åˆ°VIPERçš„è¿‡ç¨‹åŒæ ·æ˜¯å¾ˆæ¸…æ™°çš„ï¼Œå®ƒç”šè‡³æŠŠé‡æ„çš„æ€è·¯éƒ½ä½“ç°å‡ºæ¥äº†ã€‚è€ŒMVVMåˆ™ç•™ä¸‹äº†è®¸å¤šå°šæœªæ˜ç¡®çš„è´£ä»»ï¼Œå¯¼è‡´ä¸åŒçš„äººä¼šåœ¨æŸäº›åœ°æ–¹æœ‰ä¸åŒçš„å®ç°ã€‚å³ä¾¿ä½ è¿˜åœ¨ä½¿ç”¨MVCï¼Œä½ ä¹Ÿåº”è¯¥åœ¨Controllerä¸­åˆ†ç¦»å‡ºVIPERæ€»ç»“å‡ºçš„é‚£äº›ä¸“é¡¹èŒè´£ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œä¸ºä½•ä¸å½»åº•åœ°æ˜ç¡®è¿™äº›èŒè´£ï¼ŒæŠŠå®ƒä»¬åˆ†æ•£åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­å‘¢ï¼Ÿä¸€æ—¦å¼€å§‹è¿™æ ·çš„å·¥ä½œï¼Œä½ å°±å·²ç»å‘VIPERé æ‹¢äº†ã€‚</p>
<p>æœ‰äººå¯èƒ½ä¼šè§‰å¾—ï¼ŒVIPERé€‚åˆå¤§å‹appï¼Œä¸­å°å‹appæ²¡å¿…è¦è¿‡æ—©ä½¿ç”¨ã€‚</p>
<p>æˆ‘åå¯¹è¿™ç§è§‚ç‚¹ã€‚VIPERæ˜¯å•ä¸ªç•Œé¢æ¨¡å—å†…çš„æ¶æ„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯æ•´ä¸ªappæ¶æ„å±‚é¢çš„è®¾è®¡ï¼Œå’Œappçš„æ•´ä½“æ¶æ„æ²¡æœ‰å¤šå¤§çš„å…³ç³»ï¼Œä¹Ÿä¸å­˜åœ¨è¿‡æ—©ä½¿ç”¨VIPERçš„æƒ…å†µã€‚ä½ æ˜¯æ„¿æ„1å¤©å¼€å‘ï¼Œ3å¤©ä¿®bugï¼Œè¿˜æ˜¯æ›´æ„¿æ„1.5å¤©å¼€å‘ï¼Œ1å¤©ä¿®bugå‘¢ï¼Ÿ</p>
<p>è‡³æ­¤ï¼Œæˆ‘çš„ç»“è®ºå°±æ˜¯ï¼Œå¿«ç‚¹æ‹¥æŠ±VIPERçš„æ€€æŠ±å§ã€‚</p>
<h3 id="å¼€å§‹å®è·µ"><a href="#å¼€å§‹å®è·µ" class="headerlink" title="å¼€å§‹å®è·µ"></a>å¼€å§‹å®è·µ</h3><p>VIPERæ˜¯2013å¹´é¦–æ¬¡åœ¨iOSå¹³å°ä¸Šæå‡ºçš„è®¾è®¡ï¼Œååˆ†å¹´è½»ï¼Œå› æ­¤ç¼ºå°‘å¤§é‡å‚ä¸è€…ï¼Œä»¥æ€»ç»“å‡ºæ›´å¤šæœ€ä½³å®è·µã€‚ä¸‹ä¸€ç¯‡æ–‡ç« å°†ä¼šä»VIPERçš„æºå¤´å¼€å§‹ï¼Œæ¯”è¾ƒç°æœ‰çš„å„ç§VIPERå®ç°ï¼Œæ€»ç»“å‡ºä¸€ä¸ªæˆ‘è®¤ä¸ºè¾ƒå¥½çš„å®æ–½æ–¹æ¡ˆã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul>
<li><a href="http://ios.jobbole.com/83727/" target="_blank" rel="external">iOS æ¶æ„æ¨¡å¼â€“è§£å¯† MVCï¼ŒMVPï¼ŒMVVMä»¥åŠVIPERæ¶æ„</a></li>
<li><a href="http://draveness.me/mvx.html" target="_blank" rel="external">æµ…è°ˆ MVCã€MVP å’Œ MVVM æ¶æ„æ¨¡å¼</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/22/CFRunloopçš„å¤šçº¿ç¨‹éšæ‚£/" itemprop="url">
                  CFRunloopçš„å¤šçº¿ç¨‹éšæ‚£
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2017-05-22T16:29:29+08:00" content="2017-05-22">
              2017-05-22
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/22/CFRunloopçš„å¤šçº¿ç¨‹éšæ‚£/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/05/22/CFRunloopçš„å¤šçº¿ç¨‹éšæ‚£/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¦‚æœä½ è¿˜ä¸äº†è§£ä»€ä¹ˆæ˜¯runloopï¼Œå¯ä»¥çœ‹è¿™é‡Œçš„è¯¦è§£<a href="http://blog.ibireme.com/2015/05/18/runloop/" target="_blank" rel="external">æ·±å…¥ç†è§£RunLoop</a>ã€‚</p>
<p>è‹¹æœ<a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW26" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ä¸­ï¼Œå£°æ˜äº†CFRunloopæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼š</p>
<blockquote>
<p>Thread safety varies depending on which API you are using to manipulate your run loop. The functions in Core Foundation are <strong><em>generally</em></strong> thread-safe and can be called from any thread. If you are performing operations that alter the configuration of the run loop, however, it is still good practice to do so from the thread that owns the run loop whenever possible.</p>
</blockquote>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç‹¡çŒ¾çš„è‹¹æœä½¿ç”¨äº†<code>generally</code>è¿™ä¸ªæ¨¡ç³Šçš„è¯ã€‚</p>
<p>ä»å®è·µä¸­æ¥çœ‹ï¼ŒCFRunloopåœ¨åœæ­¢runloopçš„é˜¶æ®µçš„æŸäº›æ“ä½œæ˜¯å­˜åœ¨å¤šçº¿ç¨‹éšæ‚£çš„ã€‚</p>
<h2 id="ä¸å®‰å…¨çš„CFRunloopSource"><a href="#ä¸å®‰å…¨çš„CFRunloopSource" class="headerlink" title="ä¸å®‰å…¨çš„CFRunloopSource"></a>ä¸å®‰å…¨çš„CFRunloopSource</h2><p>CFRunloopæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯åŠ ä¸ŠCFRunloopSourceå°±ä¸ä¸€å®šäº†ã€‚æ¯”å¦‚CFSocketã€‚</p>
<h3 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h3><p>çœ‹è¿™æ ·ä¸€æ®µè‡ªå®šä¹‰çº¿ç¨‹çš„ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">@interface MyThread()</div><div class="line">@property (nonatomic, strong) NSThread *currentThread;</div><div class="line">@property (nonatomic, assign) CFRunLoopSourceRef socketSource;</div><div class="line">@property (nonatomic, assign) CFSocketRef socket;</div><div class="line">@property (nonatomic, assign) CFRunLoopRef currentRunloop;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation MyThread</div><div class="line"></div><div class="line">//åˆå§‹åŒ–çº¿ç¨‹</div><div class="line">- (instancetype)init &#123;</div><div class="line">    if (self = [super init]) &#123;</div><div class="line">        _currentThread = [[NSThread alloc] initWithTarget:self selector:@selector(runThread) object:nil];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//å¼€å¯çº¿ç¨‹ï¼›æ­¤æ–¹æ³•åœ¨ä½¿ç”¨æ—¶æ²¡æœ‰å¤šçº¿ç¨‹è°ƒç”¨</div><div class="line">- (void)startThread &#123;</div><div class="line">    [self.currentThread start];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//çº¿ç¨‹å…¥å£</div><div class="line">- (void)runThread &#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">    //è¿”å›runloopï¼Œå¯ä»¥è®©å…¶ä»–çº¿ç¨‹åœæ­¢æ­¤çº¿ç¨‹</div><div class="line">        self.currentRunloop = CFRunLoopGetCurrent();</div><div class="line">        [self addSocketSource];</div><div class="line">        </div><div class="line">        CFRunLoopRun();</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;çº¿ç¨‹é€€å‡º&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//æ­¤æ–¹æ³•åœ¨ä½¿ç”¨æ—¶æ²¡æœ‰å¤šçº¿ç¨‹è°ƒç”¨</div><div class="line">- (void)stopThread &#123;</div><div class="line">	 [self removeSocketSource];</div><div class="line">	 @synchronized (_currentRunloop) &#123;</div><div class="line">        if (_currentRunloop) &#123;</div><div class="line">	        CFRunLoopStop(_currentRunloop);</div><div class="line">	        self.currentRunloop = NULL;</div><div class="line">	    &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//æ­¤æ–¹æ³•åœ¨ä½¿ç”¨æ—¶æ²¡æœ‰å¤šçº¿ç¨‹è°ƒç”¨</div><div class="line">- (void)addSocketSource &#123;</div><div class="line">    int sock;</div><div class="line">    sock = socket(AF_INET6, SOCK_STREAM, 0);</div><div class="line">    CFSocketContext context = &#123;0, (__bridge void *)(self), NULL, NULL, NULL&#125;;</div><div class="line">    self.socket = CFSocketCreateWithNative(NULL, sock, kCFSocketReadCallBack, socketCallBack, &amp;context);</div><div class="line">    self.socketSource = CFSocketCreateRunLoopSource(NULL, self.socket, 0);</div><div class="line">    CFRunLoopAddSource(_currentRunloop, _socketSource, kCFRunLoopDefaultMode);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)removeSocketSource &#123;</div><div class="line">	@synchronized (_socket) &#123;</div><div class="line">		if (_socket) &#123;</div><div class="line">			//CFSocketInvalidateå¯èƒ½è¢«æŠ›åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œï¼Œå› æ­¤ CFSocketInvalidate å’Œ CFRunLoopStopå¯èƒ½æœ‰å¤šçº¿ç¨‹åŒæ—¶è°ƒç”¨çš„æƒ…å†µ       </div><div class="line">	        CFSocketInvalidate(_socket);</div><div class="line">	        CFRelease(_socket);</div><div class="line">	        self.socket = NULL;</div><div class="line">	    &#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åœ¨å®è·µä¸­ï¼ŒCFSocketæ˜¯è¢«å¦ä¸€ä¸ªsocketç±»ç®¡ç†çš„ï¼Œæ‰€ä»¥<code>addSocketSource</code>å’Œ<code>removeSocketSource</code>éƒ½æ˜¯åœ¨å¦ä¸€ä¸ªç±»ä¸­çš„ï¼Œä¹Ÿå°±æœ‰å¯èƒ½å‡ºç°<code>CFSocketInvalidate</code>å’Œ <code>CFRunLoopStop</code>å¤šçº¿ç¨‹åŒæ—¶è°ƒç”¨çš„æƒ…å†µã€‚</p>
<h3 id="crashå®ä¾‹åˆ†æ"><a href="#crashå®ä¾‹åˆ†æ" class="headerlink" title="crashå®ä¾‹åˆ†æ"></a>crashå®ä¾‹åˆ†æ</h3><p>çœ‹ä¸Šå»å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¯¥åŠ é”çš„åœ°æ–¹éƒ½åŠ é”äº†ï¼Œè€Œä¸”CFå¼€å¤´çš„é‚£å‡ ä¸ªæ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯è¿™æ—¶å€™ï¼Œå¦‚æœå‡ºç°<code>CFSocketInvalidate</code>å’Œ <code>CFRunLoopStop</code>å¤šçº¿ç¨‹åŒæ—¶è°ƒç”¨çš„æƒ…å†µï¼Œå°±æœ‰crashçš„å¯èƒ½ã€‚ä¾‹å¦‚æˆ‘ä»¬é¡¹ç›®é‡Œæ”¶åˆ°çš„æŸä¸ªcrashï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">Thread 0 name:  Dispatch queue: com.apple.main-thread</div><div class="line">Thread 0 Crashed:</div><div class="line">0   CoreFoundation                  0x000000018e6a9144 CFRunLoopWakeUp + 92</div><div class="line">1   CoreFoundation                  0x000000018e6a9140 CFRunLoopWakeUp + 88</div><div class="line">2   CoreFoundation                  0x000000018e6d71e8 CFSocketInvalidate + 712</div><div class="line">3   MyApp                           0x00000001000fe424 (-[MySocket stop] + 136)</div><div class="line">4   MyApp                           0x00000001000fcd50 (-[MySocket dealloc] + 56)</div><div class="line">5   libsystem_blocks.dylib          0x000000018d6afa28 _Block_release + 144</div><div class="line">6   libdispatch.dylib               0x000000018d65a1bc _dispatch_client_callout + 16</div><div class="line">7   libdispatch.dylib               0x000000018d65ed68 _dispatch_main_queue_callback_4CF + 1000</div><div class="line">8   CoreFoundation                  0x000000018e77e810 __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__ + 12</div><div class="line">9   CoreFoundation                  0x000000018e77c3fc __CFRunLoopRun + 1660</div><div class="line">10  CoreFoundation                  0x000000018e6aa2b8 CFRunLoopRunSpecific + 444</div><div class="line">11  GraphicsServices                0x000000019015e198 GSEventRunModal + 180</div><div class="line">12  UIKit                           0x00000001946f17fc -[UIApplication _run] + 684</div><div class="line">13  UIKit                           0x00000001946ec534 UIApplicationMain + 208</div><div class="line">14  DuoYiIM                         0x000000010003ca58 0x100024000 + 100952 (main + 132)</div><div class="line">15  libdyld.dylib                   0x000000018d68d5b8 start + 4</div><div class="line"></div><div class="line">Thread 0 crashed with ARM-64 Thread State:</div><div class="line">  cpsr: 0x0000000020000000     fp: 0x000000016fddab30     lr: 0x000000018e6a9140     pc: 0x000000018e6a9144 </div><div class="line">    sp: 0x000000016fddaa00     x0: 0x0000000000000000     x1: 0x0000000000000000    x10: 0x0000000000000000 </div><div class="line">   x11: 0x0000000000000000    x12: 0x0000000000000000    x13: 0x0000000000000000    x14: 0x0000000000000000 </div><div class="line">   x15: 0x0000000000001203    x16: 0x000000000000012d    x17: 0x000000018f1eef74    x18: 0x0000000000000000 </div><div class="line">   x19: 0x000000017056cb50     x2: 0x0000000000001000    x20: 0x000000017056cb40    x21: 0x96e73914144e0055 </div><div class="line">   x22: 0x0000000174452990    x23: 0x000000017048bae0    x24: 0x0000000000000000    x25: 0x00000000ffffffff </div><div class="line">   x26: 0xffffffffffffffff    x27: 0x000000017426f1c0    x28: 0x0000000002ffffff    x29: 0x000000016fddab30 </div><div class="line">    x3: 0x000000000017e4a6     x4: 0x0000000000012068     x5: 0x0000000000000000     x6: 0x0000000000000036 </div><div class="line">    x7: 0xffffffffffffffec     x8: 0x8c8c8c8c8c8c8c8c     x9: 0x000000000000000c</div></pre></td></tr></table></figure>
<p><code>CFSocketInvalidate</code>åœ¨ä¸»çº¿ç¨‹è¢«è°ƒç”¨äº†ã€‚çœ‹å †æ ˆï¼Œåœ¨<code>CFSocketInvalidate</code>å†…éƒ¨è°ƒç”¨<code>CFRunLoopWakeUp</code>æ—¶ï¼Œå‡ºç°äº†crashã€‚</p>
<p>çœ‹ä¸å‡ºå…·ä½“æ˜¯ä»€ä¹ˆåŸå› crashï¼Œæ‰€ä»¥éœ€è¦çœ‹çœ‹æ˜¯åœ¨<code>CFRunLoopWakeUp</code>çš„å“ªé‡ŒæŒ‚çš„ã€‚æŸ¥çœ‹å¯¹åº”ç‰ˆæœ¬çš„<code>CoreFoundation</code>çš„æ±‡ç¼–ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">_CFRunLoopWakeUp:</div><div class="line">0x0000000181521b9c FF0305D1               sub        sp, sp, #0x140             ; CODE XREF=_CFRunLoopAddTimer+696, _CFRunLoopTimerSetNextFireDate+592, _CFSocketInvalidate+708, __wakeUpRunLoop+276, __CFXRegistrationPost+344, -[CFPrefsSearchListSource asynchronouslyNotifyOfChangesFromDictionary:toDictionary:]+172, ___CFSocketPerformV0+1408, ___CFSocketManager+2004, ___CFSocketManager+4248, _boundPairRead+604, _boundPairReadClose+124, â€¦</div><div class="line">0x0000000181521ba0 FC6F11A9               stp        x28, x27, [sp, #0x110]</div><div class="line">0x0000000181521ba4 F44F12A9               stp        x20, x19, [sp, #0x120]</div><div class="line">0x0000000181521ba8 FD7B13A9               stp        x29, x30, [sp, #0x130]</div><div class="line">0x0000000181521bac FDC30491               add        x29, sp, #0x130</div><div class="line">0x0000000181521bb0 F40300AA               mov        x20, x0</div><div class="line">0x0000000181521bb4 C80C10F0               adrp       x8, #0x1a16bc000</div><div class="line">0x0000000181521bb8 084140F9               ldr        x8, [x8, #0x80]            ; -[_CFXPreferences init]_1a16bc080</div><div class="line">0x0000000181521bbc 080140F9               ldr        x8, [x8]</div><div class="line">0x0000000181521bc0 292013F0               adrp       x9, #0x1a7928000</div><div class="line">0x0000000181521bc4 29E90791               add        x9, x9, #0x1fa             ; ___CF120290</div><div class="line">0x0000000181521bc8 A8831DF8               stur       x8, [x29, #-0x28]</div><div class="line">0x0000000181521bcc E8030032               orr        w8, wzr, #0x1</div><div class="line">0x0000000181521bd0 28010039               strb       w8, [x9]                   ; ___CF120290</div><div class="line">0x0000000181521bd4 E8731290               adrp       x8, #0x1a639d000</div><div class="line">0x0000000181521bd8 08F13F91               add        x8, x8, #0xffc             ; ___CF120293</div><div class="line">0x0000000181521bdc 08014039               ldrb       w8, [x8]                   ; ___CF120293</div><div class="line">0x0000000181521be0 48000034               cbz        w8, loc_181521be8</div><div class="line"></div><div class="line">0x0000000181521be4 E3560394               bl         ___THE_PROCESS_HAS_FORKED_AND_YOU_CANNOT_USE_THIS_COREFOUNDATION_FUNCTIONALITY___YOU_MUST_EXEC__</div><div class="line"></div><div class="line">                                      loc_181521be8:</div><div class="line">0x0000000181521be8 93420091               add        x19, x20, #0x10            ; CODE XREF=_CFRunLoopWakeUp+68</div><div class="line">0x0000000181521bec E00313AA               mov        x0, x19</div><div class="line">0x0000000181521bf0 70300694               bl         imp___stubs_-[NSOrderedSet sortedArrayFromRange:options:usingComparator:]//çœŸæœºçš„ç³»ç»Ÿåº“åšäº†æ··æ·†ï¼Œè¿™é‡Œå…¶å®æ˜¯__CFRunLoopLock</div><div class="line">0x0000000181521bf4 882E40F9               ldr        x8, [x20, #0x58]</div><div class="line">0x0000000181521bf8 080D40B9               ldr        w8, [x8, #0xc]</div><div class="line">0x0000000181521bfc A8010034               cbz        w8, loc_181521c30</div></pre></td></tr></table></figure>
<p>crashæ—¥å¿—ä¸­ï¼Œå´©æºƒåœ¨<code>CFRunLoopWakeUp + 92</code>ï¼Œå¯¹åº”æ±‡ç¼–åœ°å€ä¸º<code>0x0000000181521b9c + 92</code>=<code>0x0000000181521bf8</code>ï¼Œåœ¨<code>ldr        w8, [x8, #0xc]</code>çš„æ—¶å€™æŒ‚äº†ã€‚æŸ¥çœ‹crashæ—¶å¯„å­˜å™¨çš„å€¼ï¼Œ<code>x8: 0x8c8c8c8c8c8c8c8c</code>ï¼Œå¾ˆæ˜æ˜¾<code>x8</code>æŒ‡å‘çš„å†…å­˜å·²ç»è¢«é‡Šæ”¾äº†ã€‚<code>x8</code>æ˜¯ä»<code>ldr        x8, [x20, #0x58]</code>å¾—æ¥çš„ï¼ˆä¹Ÿå°±æ˜¯<code>x20</code>çš„åœ°å€åç§»<code>0x58</code>åçš„å€¼ï¼‰ï¼Œè€Œ<code>x20</code>åˆ™æ˜¯ä»<code>mov        x20, x0</code>å¾—æ¥çš„ï¼Œ<code>x0</code>å°±æ˜¯<code>CFRunloopWakeUp</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<code>CFRunLoopRef</code>ç»“æ„ä½“ï¼Œæ‰€ä»¥<code>x8</code>å°±æ˜¯<code>CFRunLoopRef</code>åç§»<code>0x58</code>åçš„å€¼ã€‚</p>
<p><code>CoreFoundation</code>çš„ä»£ç æ˜¯å¼€æºçš„ï¼Œå¯ä»¥åœ¨è¿™é‡Œä¸‹è½½ï¼š<a href="https://opensource.apple.com/tarballs/CF/CF-1153.18.tar.gz" target="_blank" rel="external">CF-1153.18</a>ã€‚</p>
<p>å¯¹åº”<code>CFRunloopWakeUp</code>æºç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">void CFRunLoopWakeUp(CFRunLoopRef rl) &#123;</div><div class="line">    CHECK_FOR_FORK();</div><div class="line">    __CFRunLoopLock(rl);</div><div class="line">    if (__CFRunLoopIsIgnoringWakeUps(rl)) &#123;</div><div class="line">        __CFRunLoopUnlock(rl);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    kern_return_t ret;</div><div class="line">    ret = __CFSendTrivialMachMessage(rl-&gt;_wakeUpPort, 0, MACH_SEND_TIMEOUT, 0);</div><div class="line">    if (ret != MACH_MSG_SUCCESS &amp;&amp; ret != MACH_SEND_TIMED_OUT) CRASH(&quot;*** Unable to send message to wake up port. (%d) ***&quot;, ret);</div><div class="line">    __CFRunLoopUnlock(rl);</div><div class="line">&#125;</div><div class="line"></div><div class="line">CF_INLINE Boolean __CFRunLoopIsIgnoringWakeUps(CFRunLoopRef rl) &#123;</div><div class="line">    return (rl-&gt;_perRunData-&gt;ignoreWakeUps) ? true : false;    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>CFRunloopç»“æ„ä½“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">struct __CFRunLoop &#123;</div><div class="line">    CFRuntimeBase _base;	//16 byte</div><div class="line">    pthread_mutex_t _lock;	//64 byte</div><div class="line">    __CFPort _wakeUpPort; //mach_port_t (unsign int), 4 byte</div><div class="line">    Boolean _unused;	//boolå˜é‡å ç”¨1 byteï¼Œä½†æ˜¯éœ€è¦å’Œ4å­—èŠ‚å¯¹é½ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯4 byte</div><div class="line">    volatile _per_run_data *_perRunData;</div><div class="line">    pthread_t _pthread;</div><div class="line">    uint32_t _winthread;</div><div class="line">    CFMutableSetRef _commonModes;</div><div class="line">    CFMutableSetRef _commonModeItems;</div><div class="line">    CFRunLoopModeRef _currentMode;</div><div class="line">    CFMutableSetRef _modes;</div><div class="line">    struct _block_item *_blocks_head;</div><div class="line">    struct _block_item *_blocks_tail;</div><div class="line">    CFAbsoluteTime _runTime;</div><div class="line">    CFAbsoluteTime _sleepTime;</div><div class="line">    CFTypeRef _counterpart;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">typedef struct __CFRuntimeBase &#123;</div><div class="line">    uintptr_t _cfisa;	//unsigned long 8 byte</div><div class="line">    uint8_t _cfinfo[4];	//unsigned char 4 byte</div><div class="line">#if __LP64__</div><div class="line">    uint32_t _rc;	//unsigned int 4 byte</div><div class="line">#endif</div><div class="line">&#125; CFRuntimeBase;</div><div class="line"></div><div class="line">struct pthread_mutex_t &#123;</div><div class="line">	long __sig;	//8 byte</div><div class="line">	char __opaque[56]; //56 byte</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>è®¡ç®—ç»“æ„ä½“sizeåï¼Œå¾—å‡º<code>ldr        x8, [x20, #0x58]</code>å°±æ˜¯<code>runloop-&gt; _perRunData</code>ã€‚ä¹Ÿå°±æ˜¯åœ¨è°ƒç”¨<code>__CFRunLoopIsIgnoringWakeUps</code>çš„æ—¶å€™ï¼Œ<code>CFRunLoopRef</code>å·²ç»è¢«é‡Šæ”¾äº†ã€‚</p>
<h3 id="åˆ†æCFSocketæºç "><a href="#åˆ†æCFSocketæºç " class="headerlink" title="åˆ†æCFSocketæºç "></a>åˆ†æ<code>CFSocket</code>æºç </h3><p>æŸ¥çœ‹<code>CFSocketInvalidate</code>æºç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">void CFSocketInvalidate(CFSocketRef s) &#123;</div><div class="line">    CHECK_FOR_FORK();</div><div class="line">    CFRetain(s);</div><div class="line">    __CFLock(&amp;__CFAllSocketsLock);</div><div class="line">    __CFSocketLock(s);</div><div class="line">    if (__CFSocketIsValid(s)) &#123;</div><div class="line">    </div><div class="line">        //çœç•¥éƒ¨åˆ†ä»£ç ...</div><div class="line"></div><div class="line">		 //å–å‡ºsocketä¸­çš„runloopæ•°ç»„</div><div class="line">        CFArrayRef runLoops = (CFArrayRef)CFRetain(s-&gt;_runLoops);</div><div class="line">       //CFRunloopé‡Šæ”¾æ“ä½œ1       </div><div class="line">        CFRelease(s-&gt;_runLoops);</div><div class="line">        </div><div class="line">        s-&gt;_runLoops = NULL;</div><div class="line">        </div><div class="line">        //çœç•¥éƒ¨åˆ†ä»£ç ...</div><div class="line">        </div><div class="line">        __CFSocketUnlock(s);</div><div class="line">        </div><div class="line">        // Do this after the socket unlock to avoid deadlock (10462525)</div><div class="line">        for (idx = CFArrayGetCount(runLoops); idx--;) &#123;</div><div class="line">            CFRunLoopWakeUp((CFRunLoopRef)CFArrayGetValueAtIndex(runLoops, idx));</div><div class="line">        &#125;</div><div class="line">        //CFRunloopé‡Šæ”¾æ“ä½œ3</div><div class="line">        CFRelease(runLoops);</div><div class="line"></div><div class="line">        //çœç•¥éƒ¨åˆ†ä»£ç ...</div><div class="line">    &#125; else &#123;</div><div class="line">        __CFSocketUnlock(s);</div><div class="line">    &#125;</div><div class="line">    __CFUnlock(&amp;__CFAllSocketsLock);</div><div class="line">    CFRelease(s);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>CFSocketInvalidate</code>ä¸­å”¯ä¸€ä½¿ç”¨åˆ°<code>CFRunLoopWakeUp</code>çš„åœ°æ–¹ï¼Œå°±æ˜¯æœ€åéå†runloopsçš„æ“ä½œã€‚<br>ä½†æ˜¯æ­¤æ—¶<code>CFRunLoopRef</code>è¿˜åœ¨æ•°ç»„é‡Œï¼Œæ­£åœ¨è¢«æ•°ç»„å¼ºå¼•ç”¨ï¼Œåˆ°äº†<code>CFRunLoopWakeUp</code>é‡Œæ€ä¹ˆå°±è¢«é‡Šæ”¾äº†å‘¢ï¼Ÿ</p>
<p>æ³¨æ„ï¼Œ<code>CFSocketInvalidate</code>é‡Œéå†runloopsçš„æ“ä½œæ˜¯åœ¨é”å¤–é¢è¿›è¡Œçš„ï¼Œè¯´æ˜CFSocketå¾ˆæœ‰å¯èƒ½æ²¡æœ‰ç®¡ç†å¥½å®ƒçš„runloopsæ•°ç»„ï¼Œå¯¼è‡´æ•°ç»„åœ¨éå†æ—¶è¢«é‡Šæ”¾äº†ã€‚ä»<code>Do this after the socket unlock to avoid deadlock (10462525)</code>è¿™ä¸€è¡Œæ³¨é‡ŠçŒœæµ‹ï¼Œè¿™éƒ¨åˆ†éå†æ“ä½œä¹‹å‰åº”è¯¥ä¹Ÿæ˜¯åœ¨é”å†…çš„ï¼Œä½†æ˜¯ä¼šå‡ºç°æ­»é”ï¼Œæ‰€ä»¥æ”¾åˆ°äº†é”å¤–ã€‚è‹¹æœçš„bug reportæ˜¯ä¸å¯¹å¤–å…¬å¼€çš„ï¼Œåªåœ¨è¿™é‡Œæ‰¾åˆ°äº†å¯èƒ½ç›¸å…³çš„è®¨è®ºï¼š<a href="https://bugreports.qt.io/browse/QTBUG-22789" target="_blank" rel="external">bug #10462525</a>ã€‚</p>
<p>æœ€å¤§çš„å¯èƒ½æ˜¯å‡ºç°åœ¨<code>__CFSocketCancel</code>é‡Œã€‚åœ¨runloopåœæ­¢çš„æ—¶å€™ï¼Œä¹Ÿä¼šæ‰§è¡Œremove sourceæ“ä½œï¼Œåœ¨<code>CFRunLoopRemoveSource</code>é‡Œï¼Œä¼šæ‰§è¡Œsource0çš„cancelå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯<code>__CFSocketCancel</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">void CFRunLoopRemoveSource(CFRunLoopRef rl, CFRunLoopSourceRef rls, CFStringRef modeName) \</div><div class="line">    CHECK_FOR_FORK();</div><div class="line">    Boolean doVer0Callout = false, doRLSRelease = false;</div><div class="line">    __CFRunLoopLock(rl);</div><div class="line">    if (modeName == kCFRunLoopCommonModes) &#123;</div><div class="line">	//çœç•¥ä»£ç ...</div><div class="line">    &#125; else &#123;</div><div class="line">	CFRunLoopModeRef rlm = __CFRunLoopFindMode(rl, modeName, false);</div><div class="line">	if (NULL != rlm &amp;&amp; ((NULL != rlm-&gt;_sources0 &amp;&amp; CFSetContainsValue(rlm-&gt;_sources0, rls)) || (NULL != rlm-&gt;_sources1 &amp;&amp; CFSetContainsValue(rlm-&gt;_sources1, rls)))) &#123;</div><div class="line">	    CFRetain(rls);</div><div class="line">	    //çœç•¥ä»£ç ...</div><div class="line">	    if (0 == rls-&gt;_context.version0.version) &#123;</div><div class="line">	        if (NULL != rls-&gt;_context.version0.cancel) &#123;</div><div class="line">	            doVer0Callout = true;</div><div class="line">	        &#125;</div><div class="line">	    &#125;</div><div class="line">	    doRLSRelease = true;</div><div class="line">	&#125;</div><div class="line">        //çœç•¥ä»£ç ...</div><div class="line">	&#125;</div><div class="line">    &#125;</div><div class="line">    __CFRunLoopUnlock(rl);</div><div class="line">    if (doVer0Callout) &#123;</div><div class="line">        // although it looses some protection for the source, we have no choice but</div><div class="line">        // to do this after unlocking the run loop and mode locks, to avoid deadlocks</div><div class="line">        // where the source wants to take a lock which is already held in another</div><div class="line">        // thread which is itself waiting for a run loop/mode lock</div><div class="line">        rls-&gt;_context.version0.cancel(rls-&gt;_context.version0.info, rl, modeName);	/* CALLOUT */</div><div class="line">    &#125;</div><div class="line">    if (doRLSRelease) CFRelease(rls);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>__CFSocketCancel</code>æºç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">static void __CFSocketCancel(void *info, CFRunLoopRef rl, CFStringRef mode) &#123;</div><div class="line">    CFSocketRef s = (CFSocketRef)info;</div><div class="line">    __CFSocketLock(s);</div><div class="line">    if (0 == s-&gt;_socketSetCount) &#123;</div><div class="line">        //çœç•¥ä»£ç ...</div><div class="line">    if (NULL != s-&gt;_runLoops) &#123;</div><div class="line">    //ä»runloopsæ•°ç»„ä¸­ç§»é™¤æ­¤runloopï¼›å¯¹åŸæ•°ç»„æ‰§è¡Œæ‹·è´åï¼Œé‡Šæ”¾åŸæ•°ç»„</div><div class="line">        CFMutableArrayRef runLoopsOrig = s-&gt;_runLoops;</div><div class="line">        CFMutableArrayRef runLoopsCopy = CFArrayCreateMutableCopy(kCFAllocatorSystemDefault, 0, s-&gt;_runLoops);</div><div class="line">        idx = CFArrayGetFirstIndexOfValue(runLoopsCopy, CFRangeMake(0, CFArrayGetCount(runLoopsCopy)), rl);</div><div class="line">        if (0 &lt;= idx) CFArrayRemoveValueAtIndex(runLoopsCopy, idx);</div><div class="line">        s-&gt;_runLoops = runLoopsCopy;</div><div class="line">        //CFRunloopé‡Šæ”¾æ“ä½œ2</div><div class="line">        CFRelease(runLoopsOrig);</div><div class="line">    &#125;</div><div class="line">    __CFSocketUnlock(s);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>__CFSocketCancel</code>ä¹Ÿæœ‰ä¸€æ¬¡å¯¹<code>CFRunloopRef</code>çš„é‡Šæ”¾æ“ä½œï¼ŒåŠ ä¸Š<code>CFSocketInvalidate</code>é‡Œçš„2ä¸ªï¼Œæ€»å…±æœ‰3ä¸ªé‡Šæ”¾æ“ä½œã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœ<code>__CFSocketCancel</code>å’Œ<code>CFSocketInvalidate</code>åœ¨å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œå°±æœ‰å¯èƒ½å‡ºç°å¯¹CFSocketä¸­çš„runloopsæ•°ç»„è¿‡åº¦é‡Šæ”¾ï¼Œå› æ­¤åœ¨éå†runloopsçš„æ—¶å€™å°±ä¼šå‡ºç°<code>CFRunLoopRef</code>è¢«é‡Šæ”¾çš„æƒ…å†µã€‚è™½ç„¶è¿™ä¸ªcrashå‡ºç°çš„æ¦‚ç‡æ¯”è¾ƒä½ï¼Œä½†æ˜¯åœ¨é¡¹ç›®é‡Œéš”ä¸€æ®µæ—¶é—´å°±ä¼šç¨³å®šå‡ºç°ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸æ˜¯åŠ äº†é”å°±ä¸‡äº‹å¤§å‰äº†ï¼Œ<code>CFSocketInvalidate</code>é‡Œåœ¨éå†æ•°ç»„å‰åº”è¯¥å†åŠ ä¸€ä¸ªretainæ‰èƒ½ä¿è¯å®‰å…¨ã€‚</p>
<h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><ul>
<li>æ—¢ç„¶æ˜¯CFSocketé‡Œçš„bugï¼Œé‚£å°±åªèƒ½é¿å…ä¸è¦å‡ºç°<code>CFSocketInvalidate</code>å’Œ<code>CFRunloopStop</code>å¤šçº¿ç¨‹æ‰§è¡Œçš„ä»£ç ã€‚</li>
<li>å¦‚æœä½ çš„socketåªåœ¨è¿™ä¸ªçº¿ç¨‹é‡Œè¿è¡Œï¼Œé‚£ç›´æ¥è°ƒç”¨<code>CFRunloopStop</code>å³å¯ï¼Œrunloopä¼šè‡ªåŠ¨æ¸…ç†æ‰€æœ‰sourceã€‚</li>
<li>å¦‚æœè¿™ä¸ªçº¿ç¨‹éœ€è¦é‡ç”¨ï¼Œé‚£å°±ä¸éœ€è¦stopï¼Œè€Œæ˜¯åœæ­¢socketåï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œæ–°å»ºsocketã€‚</li>
</ul>
<h2 id="è‡ªåŠ¨åœæ­¢çš„Runloop"><a href="#è‡ªåŠ¨åœæ­¢çš„Runloop" class="headerlink" title="è‡ªåŠ¨åœæ­¢çš„Runloop"></a>è‡ªåŠ¨åœæ­¢çš„Runloop</h2><p>é‚£ä¹ˆï¼Œå¦‚æœæŠŠstopä»£ç æ”¹æˆè¿™æ ·ï¼Œåº”è¯¥å°±æ²¡é—®é¢˜äº†å§ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (void)runThread &#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        self.currentRunloop = CFRunLoopGetCurrent();</div><div class="line">        [self addRunloopSource];</div><div class="line">        [self addSocketSource];</div><div class="line">        </div><div class="line">        CFRunLoopRun();</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;çº¿ç¨‹é€€å‡º&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)stopThread &#123;</div><div class="line">    if (_currentRunloop) &#123;</div><div class="line">	    //ä¿è¯removeSocketSourceçš„æ“ä½œåªä¼šåœ¨è¿™é‡Œæ‰§è¡Œï¼Œæ²¡æœ‰å¤šçº¿ç¨‹çš„æƒ…å†µ</div><div class="line">        [self removeSocketSource];</div><div class="line">        CFRunLoopStop(_currentRunloop);</div><div class="line">        self.currentRunloop = NULL;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¾ˆé—æ†¾ï¼Œè¿™æ ·å†™è¿˜æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p>åŸå› åœ¨äº<code>removeSocketSource</code>ä¹‹åï¼Œrunloopé‡Œsourceå°±å…¨éƒ¨ä¸ºç©ºäº†ï¼Œrunloopå¦‚æœæ£€æµ‹åˆ°äº†sourceä¸ºç©ºï¼Œå°±ä¼šè‡ªåŠ¨åœæ­¢runloopå¾ªç¯ï¼Œé”€æ¯çº¿ç¨‹ã€‚</p>
<p>å› æ­¤å¦‚æœä½ åœ¨å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨<code>stopThread</code>ï¼Œåœ¨<code>removeSocketSource</code>ä¹‹åçº¿ç¨‹å°±ä¼šéšæ—¶åœæ­¢ï¼Œrunloopåœ¨è°ƒç”¨<code>CFRunLoopStop</code>æ—¶å¯èƒ½å·²ç»è¢«é‡Šæ”¾äº†ã€‚</p>
<p>ä¸Šé¢çš„å†™æ³•å‡ºç°crashçš„æ¦‚ç‡å¤ªä½ï¼Œä½†æ˜¯ç¨å¾®æ”¹ä¸€ä¸‹å°±èƒ½å¿…ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)stopThread &#123;</div><div class="line">    if (_currentRunloop) &#123;</div><div class="line">        [self removeSocketSource];</div><div class="line">        </div><div class="line">        //æ’å…¥ä¸€ä¸ªè€—æ—¶æ“ä½œ</div><div class="line">        sleep(2);</div><div class="line">        //å¿…å®šcrash</div><div class="line">        CFRunLoopStop(_currentRunloop);</div><div class="line">        self.currentRunloop = NULL;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™ç§æƒ…å†µä¸‹crashçš„åŸå› å…¶å®æ˜¯æ²¡åšå¥½å†…å­˜ç®¡ç†ï¼Œåªè¦å¯¹runloopå¢åŠ ä¸€æ¬¡retainæ“ä½œå°±æ²¡é—®é¢˜äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">- (void)runThread &#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">	    //åšä¸€æ¬¡retainæ“ä½œ</div><div class="line">        self.currentRunloop = CFRetain(CFRunLoopGetCurrent());</div><div class="line">        [self addRunloopSource];</div><div class="line">        [self addSocketSource];</div><div class="line">        </div><div class="line">        CFRunLoopRun();</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;çº¿ç¨‹é€€å‡º&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)stopThread &#123;</div><div class="line">    if (_currentRunloop) &#123;</div><div class="line">        [self removeSocketSource];</div><div class="line">        CFRunLoopStop(_currentRunloop);</div><div class="line">        CFRelease(_currentRunloop);</div><div class="line">        self.currentRunloop = NULL;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>åœ¨ä½¿ç”¨runloop sourceçš„æ—¶å€™è¦è°¨æ…ï¼Œå°¤å…¶åœ¨å¤„ç†stopçš„é˜¶æ®µã€‚å…¶ä»–sourceå¯èƒ½ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ã€‚</p>
<p>ä¸€ä¸ªå˜é‡æœ‰å¤šçº¿ç¨‹æ“ä½œçš„æ—¶å€™ï¼Œåœ¨é”å¤–çš„æ“ä½œå³ä½¿æ˜¯åªè¯»ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼Œåœ¨è¯»å–ä¹‹å‰æœ€å¥½å†åšä¸€æ¬¡retainæ“ä½œï¼Œé˜²æ­¢åœ¨è¯»å–çš„è¿‡ç¨‹ä¸­è¢«é‡Šæ”¾ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/04/iOSé€†å‘ï¼šåœ¨ä»»æ„appä¸Šå¼€å¯malloc stackè¿½è¸ªå†…å­˜æ¥æº/" itemprop="url">
                  iOSé€†å‘ï¼šåœ¨ä»»æ„appä¸Šå¼€å¯malloc stackè¿½è¸ªå†…å­˜æ¥æº
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2017-05-04T20:49:00+08:00" content="2017-05-04">
              2017-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/é€†å‘å·¥ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">é€†å‘å·¥ç¨‹</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/04/iOSé€†å‘ï¼šåœ¨ä»»æ„appä¸Šå¼€å¯malloc stackè¿½è¸ªå†…å­˜æ¥æº/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/05/04/iOSé€†å‘ï¼šåœ¨ä»»æ„appä¸Šå¼€å¯malloc stackè¿½è¸ªå†…å­˜æ¥æº/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>lldbæœ‰ä¸€ä¸ªå†…å­˜è°ƒè¯•å·¥å…·malloc stackï¼Œå¼€å¯ä»¥åå°±å¯ä»¥æŸ¥çœ‹æŸä¸ªå†…å­˜åœ°å€çš„mallocå’Œfreeè®°å½•ï¼Œè¿½è¸ªå¯¹è±¡æ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ã€‚</p>
<p>è¿™ä¸ªå·¥å…·å¯ä»¥æ‰“å°å‡ºå¯¹è±¡åˆ›å»ºçš„å †æ ˆï¼Œè€Œåœ¨é€†å‘æ—¶ï¼Œä¹Ÿç»å¸¸éœ€è¦è¿½è¸ªæŸäº›æ–¹æ³•çš„è°ƒç”¨æ ˆï¼Œå¦‚æœå¯ä»¥éšæ—¶æ‰“å°å‡ºæŸä¸ªå¯¹è±¡çš„åˆ›å»ºè®°å½•ï¼Œä¹Ÿå°±èƒ½ç›´æ¥æ‰¾åˆ°å…¶æ‰€åœ¨çš„ç±»å’Œæ–¹æ³•ï¼Œä¸ç”¨å†èŠ±è´¹å¤§é‡çš„æ—¶é—´å»æ‰“logå’ŒåŠ¨æ€è°ƒè¯•è¿½è¸ªäº†ã€‚</p>
<h2 id="malloc-stack"><a href="#malloc-stack" class="headerlink" title="malloc stack"></a>malloc stack</h2><p>åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œè¦å¼€å¯malloc stackï¼Œéœ€è¦åœ¨<code>Product-&gt;Scheme-&gt;Edit Scheme-&gt;Diagnistic</code>é‡Œå‹¾é€‰<code>Malloc Stack</code>é€‰é¡¹ã€‚</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (IBAction)create:(id)sender &#123;</div><div class="line">    NSString *testString = [NSString stringWithFormat:@&quot;string created by %@&quot;,self];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ–­ç‚¹ååœ¨lldbä¸­ä½¿ç”¨<code>lldb.macosx.heap</code>é‡Œçš„<code>malloc_info</code>å‘½ä»¤ï¼Œè™½ç„¶å®˜ç½‘ä¸Šè¯´æ˜¯Mac appæ‰èƒ½ç”¨çš„å‘½ä»¤ï¼Œä½†æ˜¯ç»æµ‹è¯•ç°åœ¨åœ¨iOSä¸Šä¹Ÿèƒ½ç”¨äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">(lldb) p/x testString</div><div class="line">(__NSCFString *) $3 = 0x16eac000 @&quot;string created by &lt;ViewController: 0x16e9d7c0&gt;&quot;</div><div class="line">(lldb) command script import lldb.macosx.heap</div><div class="line">&quot;malloc_info&quot;, &quot;ptr_refs&quot;, &quot;cstr_refs&quot;, &quot;find_variable&quot;, and &quot;objc_refs&quot; commands have been installed, use the &quot;--help&quot; options on these commands for detailed help.</div><div class="line">(lldb) malloc_info -s 0x16eac000</div><div class="line">0x0000000016eac000: malloc(    64) -&gt; 0x16eac000 __NSCFString.NSMutableString.NSString.NSObject.isa</div><div class="line">stack[0]: addr = 0x16eac000, type=malloc, frames:</div><div class="line">     [0] 0x00000000242948ab libsystem_malloc.dylib`malloc_zone_malloc + 123</div><div class="line">     [1] 0x00000000244e3bc1 CoreFoundation`_CFRuntimeCreateInstance + 237</div><div class="line">     [2] 0x00000000245a6ffd CoreFoundation`__CFStringCreateImmutableFunnel3 + 1657</div><div class="line">     [3] 0x00000000244ee0f7 CoreFoundation`CFStringCreateCopy + 359</div><div class="line">     [4] 0x00000000245a725d CoreFoundation`_CFStringCreateWithFormatAndArgumentsAux2 + 89</div><div class="line">     [5] 0x0000000024d17dd3 Foundation`-[NSPlaceholderString initWithFormat:locale:arguments:] + 139</div><div class="line">     [6] 0x0000000024d17cd1 Foundation`+[NSString stringWithFormat:] + 61</div><div class="line">     [7] 0x00000000000d7343 testMallocStack`-[ViewController create:] + 97 at ViewController.m:23:28</div><div class="line">     [8] 0x00000000287a5771 UIKit`-[UIApplication sendAction:to:from:forEvent:] + 81</div><div class="line">     [9] 0x00000000287a5701 UIKit`-[UIControl sendAction:to:forEvent:] + 65</div><div class="line">     [10] 0x000000002878d61f UIKit`-[UIControl _sendActionsForEvents:withEvent:] + 447</div><div class="line">     [11] 0x00000000287a5051 UIKit`-[UIControl touchesEnded:withEvent:] + 617</div><div class="line">     [12] 0x00000000287a4cbf UIKit`-[UIWindow _sendTouchesForEvent:] + 647</div><div class="line">     [13] 0x000000002879d5d7 UIKit`-[UIWindow sendEvent:] + 643</div><div class="line">     [14] 0x000000002876e119 UIKit`-[UIApplication sendEvent:] + 205</div><div class="line">     [15] 0x000000002876c757 UIKit`_UIApplicationHandleEventQueue + 5135</div><div class="line">     [16] 0x0000000024599257 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 15</div><div class="line">     [17] 0x0000000024598e47 CoreFoundation`__CFRunLoopDoSources0 + 455</div><div class="line">     [18] 0x00000000245971af CoreFoundation`__CFRunLoopRun + 807</div><div class="line">     [19] 0x00000000244e9bb9 CoreFoundation`CFRunLoopRunSpecific + 517</div><div class="line">     [20] 0x00000000244e99ad CoreFoundation`CFRunLoopRunInMode + 109</div><div class="line">     [21] 0x0000000025763af9 GraphicsServices`GSEventRunModal + 161</div><div class="line">     [22] 0x00000000287d5fb5 UIKit`UIApplicationMain + 145</div><div class="line">     [23] 0x00000000000d7587 testMallocStack`main + 107 at main.m:14:9</div><div class="line">     [24] 0x000000002419c873 libdyld.dylib`start + 3</div><div class="line">     [25] 0x000000003a9c0001 libsystem_pthread.dylib`_thread + 1</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªå·¥å…·æ˜¯ç»§æ‰¿è‡ªgdbçš„<code>malloc_history</code>ï¼Œä¸è¿‡<code>malloc_history</code>åªèƒ½ç”¨åœ¨æ¨¡æ‹Ÿå™¨ä¸Šï¼Œè€Œ<code>malloc_info</code>åœ¨æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºä¸Šéƒ½å¯ä»¥ä½¿ç”¨ã€‚å¦å¤–ï¼Œæ–°ç‰ˆXcodeåˆå¢åŠ äº†ä¸€ä¸ªæ–°çš„lldbå·¥å…·<code>memory history</code>ï¼Œåœ¨<code>Product-&gt;Scheme-&gt;Edit Scheme-&gt;Diagnistic</code>é‡Œå‹¾é€‰<code>Address Sanitizer</code>å³å¯ï¼Œæ•ˆæœç±»ä¼¼ã€‚</p>
<p>æ³¨æ„ï¼Œåœ¨Xcode8.3ä»¥åä½¿ç”¨<code>malloc_info</code>ä¼šcrashï¼Œä¼¼ä¹æ˜¯å‡ºbugäº†ï¼Œä¸€ç›´æ²¡ä¿®å¤ã€‚åœ¨Xcode8.2ä¸Šå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p>
<h2 id="åœ¨ä»»æ„appä¸Šå¼€å¯malloc-stack"><a href="#åœ¨ä»»æ„appä¸Šå¼€å¯malloc-stack" class="headerlink" title="åœ¨ä»»æ„appä¸Šå¼€å¯malloc stack"></a>åœ¨ä»»æ„appä¸Šå¼€å¯malloc stack</h2><p><code>Address Sanitizer</code>çš„<code>memory history</code>éœ€è¦é‡æ–°ç¼–è¯‘appï¼Œä½†æ˜¯<code>malloc stack</code>åªéœ€è¦åœ¨appå¯åŠ¨å‰è®¾ç½®ç¯å¢ƒå˜é‡<code>MallocStackLogging</code>å’Œ<code>MallocStackLoggingNoCompact</code>å³å¯ã€‚å¼€å¯åä¼šåœ¨ç³»ç»Ÿçš„<code>/tmp</code>ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code>.index</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œçš„å†…å®¹æ˜¯ä¾èµ–äºappçš„è¿è¡Œæ—¶ç¯å¢ƒçš„ï¼Œè¿›ç¨‹é€€å‡ºä»¥åè¿™ä¸ªæ–‡ä»¶ä¹Ÿå°±æ²¡ç”¨å¤„äº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œç°åœ¨çš„é—®é¢˜å°±å˜æˆäº†å¦‚ä½•ç»™appè®¾ç½®å¯åŠ¨ç¯å¢ƒå˜é‡ã€‚</p>
<h3 id="æ–¹æ³•ä¸€ï¼šexecve"><a href="#æ–¹æ³•ä¸€ï¼šexecve" class="headerlink" title="æ–¹æ³•ä¸€ï¼šexecve"></a>æ–¹æ³•ä¸€ï¼šexecve</h3><p>è¿™æ˜¯æˆ‘ä¸€å¼€å§‹ä½¿ç”¨çš„æ–¹æ³•ã€‚ä½¿ç”¨<code>execve</code>å‡½æ•°æ¥è¿è¡Œappçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<p>ç”±äºæ²™ç›’çš„é™åˆ¶ï¼Œéœ€è¦è®©appæ‹¥æœ‰rootæƒé™æ‰èƒ½ä½¿ç”¨<code>execve</code>ã€‚æ­¥éª¤å¦‚ä¸‹ã€‚</p>
<h4 id="1-é‡ç­¾åipa"><a href="#1-é‡ç­¾åipa" class="headerlink" title="1.é‡ç­¾åipa"></a>1.é‡ç­¾åipa</h4><p>é‡ç­¾åéœ€è¦é€†å‘çš„appã€‚å› ä¸ºéœ€è¦å¯¹appå†…å®¹ä½œå‡ºä¿®æ”¹ã€‚é‡ç­¾ååå®‰è£…åˆ°è¶Šç‹±è®¾å¤‡ä¸Šã€‚</p>
<h4 id="2-ç§»åŠ¨appåˆ°ç³»ç»Ÿappç›®å½•ä¸‹ï¼Œä¿®æ”¹æƒé™"><a href="#2-ç§»åŠ¨appåˆ°ç³»ç»Ÿappç›®å½•ä¸‹ï¼Œä¿®æ”¹æƒé™" class="headerlink" title="2.ç§»åŠ¨appåˆ°ç³»ç»Ÿappç›®å½•ä¸‹ï¼Œä¿®æ”¹æƒé™"></a>2.ç§»åŠ¨appåˆ°ç³»ç»Ÿappç›®å½•ä¸‹ï¼Œä¿®æ”¹æƒé™</h4><p>åªæœ‰ç³»ç»Ÿç›®å½•ä¸‹çš„appæ‰æœ‰rootæƒé™ã€‚</p>
<p>å‡è®¾éœ€è¦é€†å‘çš„appæ˜¯<code>YOUR_APP.app</code>ã€‚æŠŠappç§»åŠ¨åˆ°ç³»ç»Ÿappç›®å½•ä¸‹ï¼š<code>mv -f /var/containers/Bundle/Application/xxxxxxxxxxxxx/YOUR_APP.app /Applications/YOUR_APP.app</code>ã€‚</p>
<p>ç„¶åä¿®æ”¹æ–‡ä»¶æƒé™ï¼š</p>
<p><code>cd /Applications</code></p>
<p><code>chown -R root:wheel YOUR_APP.app</code></p>
<p><code>chmod 4755 YOUR_APP.app/YOUR_APP</code></p>
<p>ç§»åŠ¨åï¼Œç”¨<code>uicache</code>åˆ·æ–°appå›¾æ ‡ï¼Œç”¨<code>killall SpringBoard</code>é‡å¯<code>SpringBoard</code>ã€‚</p>
<h4 id="3-ä½¿ç”¨å¼•å¯¼ç¨‹åºå¯åŠ¨app"><a href="#3-ä½¿ç”¨å¼•å¯¼ç¨‹åºå¯åŠ¨app" class="headerlink" title="3.ä½¿ç”¨å¼•å¯¼ç¨‹åºå¯åŠ¨app"></a>3.ä½¿ç”¨å¼•å¯¼ç¨‹åºå¯åŠ¨app</h4><p>æœ€ç»ˆçš„ç›®çš„å°±æ˜¯ä½¿ç”¨å¼•å¯¼ç¨‹åºç”¨<code>execve</code>å¯åŠ¨appï¼Œåœ¨å¯åŠ¨å‰è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p>
<p>é¦–å…ˆé‡å‘½ååŸæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼š<code>mv YOUR_APP.app/YOUR_APP   YOUR_APP.app/YOUR_APP_Orig</code>ã€‚</p>
<p>ç„¶ååˆ¶ä½œå¼•å¯¼ç¨‹åºï¼Œéšä¾¿åˆ›å»ºä¸€ä¸ªiOSå·¥ç¨‹ï¼Œæ›¿æ¢main.mé‡Œçš„å†…å®¹ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">int main(int argc, char * argv[]) &#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        NSString* string = [[NSBundle mainBundle] pathForResource:@&quot;YOUR_APP_Orig&quot; ofType:nil];//YOUR_APP_Origæ˜¯æ‰€è¦å¯åŠ¨çš„äºŒè¿›åˆ¶æ–‡ä»¶å</div><div class="line">        argv[0] = (char*)[string UTF8String];</div><div class="line">        char *envp[] =</div><div class="line">        &#123;</div><div class="line">            &quot;HOME=/var/root&quot;,</div><div class="line">            &quot;LOGNAME=root&quot;,</div><div class="line">            &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/bin/X11:/usr/games&quot;,</div><div class="line">            &quot;USER=root&quot;,</div><div class="line">            &quot;MallocStackLogging=1&quot;,</div><div class="line">            &quot;MallocStackLoggingNoCompact=1&quot;</div><div class="line">            0</div><div class="line">        &#125;;</div><div class="line">        execve([string UTF8String], argv, envp);</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¼–è¯‘åï¼Œå–å‡ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‡å‘½åä¸º<code>YOUR_APP</code>ï¼Œå¤åˆ¶åˆ°è¶Šç‹±è®¾å¤‡çš„<code>/Application/YOUR_APP.app/</code>ç›®å½•ä¸‹ã€‚</p>
<p>ç»™å¼•å¯¼ç¨‹åºè®¾ç½®æ‰§è¡Œæƒé™ï¼š<code>chmod +x /Application/YOUR_APP.app/YOUR_APP</code>ã€‚</p>
<p>æœ€åé‡å¯SpringBoardï¼š<code>killall SpringBoard</code>ã€‚</p>
<p>è¿™æ ·ï¼Œæ¯æ¬¡å¯åŠ¨appå°±éƒ½ä¼šä½¿ç”¨å¼•å¯¼ç¨‹åºé—´æ¥å¯åŠ¨appã€‚</p>
<h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><ul>
<li>æ­¥éª¤ç¹çã€‚</li>
<li>æœ‰äº›appé‡ç­¾åå¾ˆéº»çƒ¦ã€‚</li>
<li>è¶Šç‹±åçš„ç³»ç»Ÿåˆ†åŒºå®¹é‡å¾ˆå°ï¼Œå¾ˆå®¹æ˜“å°±è¢«å æ»¡äº†ï¼Œæƒ³è¦æµ‹è¯•å¤§ä¸€ç‚¹çš„appå°±éº»çƒ¦äº†ã€‚</li>
<li>æ— æ³•ä½¿ç”¨<code>debugserver</code>å”¤é†’appï¼Œè°ƒè¯•å¯åŠ¨è¿‡ç¨‹ã€‚å› ä¸º<code>YOUR_APP</code>å’Œ<code>YOUR_APP_Orig</code>æ˜¯ä¸¤ä¸ªè¿›ç¨‹ï¼Œç¬¬ä¸€ä¸ªåœ¨<code>execve</code>æ‰§è¡Œå®Œå°±é€€å‡ºäº†ã€‚</li>
<li>æŠŠappæ”¾åˆ°ç³»ç»Ÿç›®å½•ä¸‹æœ‰æ—¶å€™ä¼šå¼•èµ·crashã€‚</li>
</ul>
<h3 id="æ–¹æ³•2ï¼šdebugserverå‚æ•°"><a href="#æ–¹æ³•2ï¼šdebugserverå‚æ•°" class="headerlink" title="æ–¹æ³•2ï¼šdebugserverå‚æ•°"></a>æ–¹æ³•2ï¼šdebugserverå‚æ•°</h3><p>æ–¹æ³•1å®åœ¨æ˜¯å¤ªéº»çƒ¦äº†ï¼Œæœ‰æ—¶å€™é‡ä¸Šé‡ç­¾åå¤±è´¥çš„appå°±æ›´éº»çƒ¦äº†ã€‚ä½†å…¶å®è¿˜æœ‰å¦ä¸€ä¸ªæ›´ç›´æ¥çš„æ–¹æ³•ã€‚å°±æ˜¯ä½¿ç”¨debugserverçš„å‘½ä»¤ã€‚</p>
<p>debugserveræ˜¯åŠ¨æ€è°ƒè¯•å·¥å…·ï¼Œå‚è€ƒï¼š<a href="http://gslab.qq.com/article-159-1.html" target="_blank" rel="external">IOSå¹³å°lldbåŠ¨æ€è°ƒè¯•ä»‹ç»</a>ã€‚</p>
<p>å®‰è£…å¥½åï¼Œåœ¨è¶Šç‹±è®¾å¤‡ä¸Šè¾“å…¥<code>debugserver *:1234 /var/containers/Bundle/Application/589822B6-BFDA-4A3D-A71C-AD0D30BA6077/WeChat.app/WeChat</code>å°±èƒ½å”¤é†’appè¿›è¡Œè°ƒè¯•ã€‚</p>
<p>ä½†æ˜¯ç½‘ä¸Šçš„æ•™ç¨‹éƒ½æ²¡æœ‰æåˆ°ï¼Œå…¶å®debugserverè¿˜æœ‰ä¸€ä¸ªéšè—çš„å‚æ•°<code>--env</code>(<code>-env</code>,<code>-e</code>éƒ½å¯ä»¥)ï¼Œå°±æ˜¯ç”¨æ¥è®¾ç½®è¿›ç¨‹çš„ç¯å¢ƒå˜é‡çš„ï¼š</p>
<p><code>debugserver *:1234 /var/containers/Bundle/Application/589822B6-BFDA-4A3D-A71C-AD0D30BA6077/WeChat.app/WeChat -env MallocStackLogging=1 -env MallocStackLoggingNoCompact=1</code></p>
<p>å½“æ—¶æˆ‘æƒ³debugserverä¼šä¸ä¼šæœ‰è®¾ç½®ç¯å¢ƒå˜é‡çš„åŠŸèƒ½ï¼Œæ²¡æƒ³åˆ°éšä¾¿è¯•äº†ä¸ª<code>-env</code>å°±æˆåŠŸäº†ã€‚åæ¥åœ¨debugserverçš„æºç é‡Œä¹Ÿå‘ç°äº†å®ƒçš„å­˜åœ¨ï¼š<a href="https://llvm.org/svn/llvm-project/lldb/trunk/tools/debugserver/source/debugserver.cpp" target="_blank" rel="external">debugserver.cpp</a>ï¼ˆæœç´¢<code>g_long_options</code>å¯ä»¥æ‰¾åˆ°<code>env</code>ï¼‰ã€‚</p>
<p>è¿™æ ·ï¼Œå³ä½¿appæ²¡æœ‰é‡ç­¾åï¼Œä¹Ÿå¯ä»¥ç›´æ¥è°ƒè¯•äº†ã€‚</p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>è¿™é‡Œä½¿ç”¨ä¸€ä¸ªé‡ç­¾åï¼Œå¹¶ä¸”æ¢å¤äº†ç¬¦å·è¡¨çš„å¾®ä¿¡è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>æ¯”å¦‚æ‰¾åˆ°å¾®ä¿¡æŸ¥çœ‹è¡¨æƒ…çš„ç•Œé¢ï¼Œæ‰“å°å‡ºå†…å­˜åœ°å€ä¸º<code>0x108795c20</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;MMEmoticonView: 0x108795c20; frame = (276.25 404.25; 215.5 215.5); autoresize = LM+RM+TM+BM; layer = &lt;CALayer: 0x170828700&gt;&gt;</div></pre></td></tr></table></figure>
<p>ç¬¬ä¸€æ¬¡ä½¿ç”¨<code>malloc_info</code>éœ€è¦åœ¨lldbé‡Œå¯¼å…¥<code>lldb.macosx.heap</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(lldb) command script import lldb.macosx.heap</div><div class="line">&quot;malloc_info&quot;, &quot;ptr_refs&quot;, &quot;cstr_refs&quot;, &quot;find_variable&quot;, and &quot;objc_refs&quot; commands have been installed, use the &quot;--help&quot; options on these commands for detailed help.</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>malloc_info</code>æ‰“å°åˆ›å»ºå †æ ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">(lldb) malloc_info -s 0x108795c20</div><div class="line">0x0000000108795c20: malloc(   480) -&gt; 0x108795c20 MMEmoticonView.UIView.UIResponder.NSObject.isa</div><div class="line">stack[0]: addr = 0x108795c20, type=malloc, frames:</div><div class="line">     [0] 0x000000018374e0ac libsystem_malloc.dylib`calloc + 40</div><div class="line">     [1] 0x000000018318b624 libobjc.A.dylib`class_createInstance + 76</div><div class="line">     [2] 0x0000000183199ae4 libobjc.A.dylib`_objc_rootAlloc + 52</div><div class="line">     [3] 0x00000001026d8fd4 WeChat`-[MMImageBrowseView InitEmoticonView:] + 432</div><div class="line">     [4] 0x000000010245e950 WeChat`-[MMEmotionMsgBrowseViewController initImageViewWithFrame:] + 404</div><div class="line">     [5] 0x000000010245ea74 WeChat`-[MMEmotionMsgBrowseViewController setupImageView] + 156</div><div class="line">     [6] 0x000000010245e024 WeChat`-[MMEmotionMsgBrowseViewController initView] + 224</div><div class="line">     [7] 0x000000010245d76c WeChat`-[MMEmotionMsgBrowseViewController viewDidLoad] + 112</div><div class="line">     [8] 0x000000018a5f7924 UIKit`-[UIViewController loadViewIfRequired] + 1056</div><div class="line">     [9] 0x000000018a60f4b4 UIKit`-[UIViewController __viewWillAppear:] + 132</div><div class="line">     [10] 0x00000001026e05f8 WeChat`-[MMUIViewController beginAppearanceTransition:animated:] + 92</div><div class="line">     [11] 0x000000018a7975b4 UIKit`-[UINavigationController _startCustomTransition:] + 1136</div><div class="line">     [12] 0x000000018a6afe74 UIKit`-[UINavigationController _startDeferredTransitionIfNeeded:] + 676</div><div class="line">     [13] 0x000000018a6afadc UIKit`-[UINavigationController __viewWillLayoutSubviews] + 64</div><div class="line">     [14] 0x000000018a6afa40 UIKit`-[UILayoutContainerView layoutSubviews] + 188</div><div class="line">     [15] 0x000000018a5f4a80 UIKit`-[UIView(CALayerDelegate) layoutSublayersOfLayer:] + 1196</div><div class="line">     [16] 0x0000000187aa29d8 QuartzCore`-[CALayer layoutSublayers] + 148</div><div class="line">     [17] 0x0000000187a974cc QuartzCore`CA::Layer::layout_if_needed(CA::Transaction*) + 292</div><div class="line">     [18] 0x0000000187a9738c QuartzCore`CA::Layer::layout_and_display_if_needed(CA::Transaction*) + 32</div><div class="line">     [19] 0x0000000187a143e0 QuartzCore`CA::Context::commit_transaction(CA::Transaction*) + 252</div><div class="line">     [20] 0x0000000187a3ba68 QuartzCore`CA::Transaction::commit() + 512</div><div class="line">     [21] 0x0000000187a3c488 QuartzCore`CA::Transaction::observer_callback(__CFRunLoopObserver*, unsigned long, void*) + 120</div><div class="line">     [22] 0x00000001846f60c0 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 32</div><div class="line">     [23] 0x00000001846f3cf0 CoreFoundation`__CFRunLoopDoObservers + 372</div><div class="line">     [24] 0x00000001846f4180 CoreFoundation`__CFRunLoopRun + 1024</div><div class="line">     [25] 0x00000001846222b8 CoreFoundation`CFRunLoopRunSpecific + 444</div><div class="line">     [26] 0x00000001860d6198 GraphicsServices`GSEventRunModal + 180</div><div class="line">     [27] 0x000000018a6627fc UIKit`-[UIApplication _run] + 684</div><div class="line">     [28] 0x000000018a65d534 UIKit`UIApplicationMain + 208</div><div class="line">     [29] 0x00000001000ebea4 WeChat`-[WATemplateMsgMngSwitchCell .cxx_destruct] + 372</div><div class="line">     [30] 0x00000001836055b8 libdyld.dylib`start + 4</div></pre></td></tr></table></figure>
<p>è¿™æ ·å°±ç›´æ¥æ‰¾åˆ°è¡¨æƒ…ç•Œé¢æ‰€åœ¨çš„ç±»ï¼Œä»¥åŠåœ¨å“ªé‡Œåˆå§‹åŒ–äº†ã€‚</p>
<p>è¿™æ ·çš„è¯ï¼Œåªè¦èƒ½æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œå°±èƒ½å¿«é€Ÿå®šä½åˆ°å…¶æ‰€åœ¨æ¨¡å—ã€‚æ¯”åŸæ¥æ‰“logï¼Œæ‰“æ–­ç‚¹ä¸€æ­¥æ­¥å›æº¯é«˜æ•ˆå¤šäº†ã€‚</p>
<h2 id="æ¢å¤ç¬¦å·è¡¨"><a href="#æ¢å¤ç¬¦å·è¡¨" class="headerlink" title="æ¢å¤ç¬¦å·è¡¨"></a>æ¢å¤ç¬¦å·è¡¨</h2><p>å»ºè®®åœ¨å¯¹appé‡ç­¾åæ—¶æ¢å¤ç¬¦å·è¡¨ã€‚æ¢å¤ç¬¦å·è¡¨åï¼Œå°±èƒ½ç›´æ¥åœ¨å †æ ˆä¸­çœ‹åˆ°æ–¹æ³•åï¼Œå…å»äº†è®¡ç®—åç§»é‡ç„¶ååœ¨hopperé‡ŒæŸ¥æ‰¾çš„éº»çƒ¦ã€‚</p>
<p>å‚è€ƒï¼š<a href="http://blog.imjun.net/posts/restore-symbol-of-iOS-app/" target="_blank" rel="external">iOSç¬¦å·è¡¨æ¢å¤&amp;é€†å‘æ”¯ä»˜å®</a>, <a href="https://github.com/tobefuturer/restore-symbol" target="_blank" rel="external">restore-symbol</a>ã€‚</p>
<h2 id="å…¶ä»–å‡ ä¸ªè°ƒè¯•å‘½ä»¤"><a href="#å…¶ä»–å‡ ä¸ªè°ƒè¯•å‘½ä»¤" class="headerlink" title="å…¶ä»–å‡ ä¸ªè°ƒè¯•å‘½ä»¤"></a>å…¶ä»–å‡ ä¸ªè°ƒè¯•å‘½ä»¤</h2><h3 id="ptr-refs"><a href="#ptr-refs" class="headerlink" title="ptr_refs"></a>ptr_refs</h3><p>å¯ä»¥åœ¨å†…å­˜ä¸­æ‰¾å‡ºå“ªäº›åœ°å€å¼•ç”¨äº†æŸä¸ªæŒ‡é’ˆï¼Œä¹Ÿå°±ç›¸å½“äºæŸ¥çœ‹æŸä¸ªå˜é‡åœ¨å“ªé‡Œè¢«å¼•ç”¨ã€‚</p>
<h3 id="cstr-refs"><a href="#cstr-refs" class="headerlink" title="cstr_refs"></a>cstr_refs</h3><p>åœ¨å†…å­˜ä¸­å¯»æ‰¾æŸä¸ªC Stringåœ¨å“ªé‡Œè¢«å¼•ç”¨ã€‚</p>
<h3 id="find-variable"><a href="#find-variable" class="headerlink" title="find_variable"></a>find_variable</h3><p>åœ¨å½“å‰æ ˆå¸§ä¸Šå¯»æ‰¾æŸä¸ªå±€éƒ¨å˜é‡åœ¨å“ªé‡Œè¢«å¼•ç”¨ã€‚</p>
<h3 id="objc-refs"><a href="#objc-refs" class="headerlink" title="objc_refs"></a>objc_refs</h3><p>åœ¨å†…å­˜ä¸­å¯»æ‰¾æŸä¸ªç±»çš„å®ä¾‹ã€‚</p>
<h2 id="è½¬åˆ°Xcodeä¸­è°ƒè¯•"><a href="#è½¬åˆ°Xcodeä¸­è°ƒè¯•" class="headerlink" title="è½¬åˆ°Xcodeä¸­è°ƒè¯•"></a>è½¬åˆ°Xcodeä¸­è°ƒè¯•</h2><p>å¦‚æœæƒ³è¦åœ¨Xcodeä¸­è°ƒè¯•å¹¶å¼€å¯<code>malloc stack</code>ï¼Œåˆ™éœ€è¦å…ˆç”¨<code>debugserver</code>å¯åŠ¨appï¼Œåœ¨ç»ˆç«¯çš„lldbé‡Œè¿æ¥ä¸Šä»¥åï¼Œå†ç”¨<code>process detach</code>æ–­å¼€è¿æ¥ã€‚æ¥ä¸‹æ¥ç”¨Xcodeçš„<code>Attach to Process</code>å°±å¯ä»¥äº†ï¼Œå‚è€ƒï¼š<a href="https://zuikyo.github.io/2017/05/04/iOSé€†å‘ï¼šç”¨Xcodeç›´æ¥è°ƒè¯•ç¬¬ä¸‰æ–¹app/" target="_blank" rel="external">iOSé€†å‘ï¼šç”¨Xcodeç›´æ¥è°ƒè¯•ç¬¬ä¸‰æ–¹app</a>ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/04/iOSé€†å‘ï¼šç”¨Xcodeç›´æ¥è°ƒè¯•ç¬¬ä¸‰æ–¹app/" itemprop="url">
                  iOSé€†å‘ï¼šç”¨Xcodeç›´æ¥è°ƒè¯•ç¬¬ä¸‰æ–¹app
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2017-05-04T20:48:00+08:00" content="2017-05-04">
              2017-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/é€†å‘å·¥ç¨‹/" itemprop="url" rel="index">
                    <span itemprop="name">é€†å‘å·¥ç¨‹</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/05/04/iOSé€†å‘ï¼šç”¨Xcodeç›´æ¥è°ƒè¯•ç¬¬ä¸‰æ–¹app/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/05/04/iOSé€†å‘ï¼šç”¨Xcodeç›´æ¥è°ƒè¯•ç¬¬ä¸‰æ–¹app/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ä¸€èˆ¬åŠ¨æ€è°ƒè¯•appæ—¶ï¼Œéƒ½æ˜¯åœ¨ç»ˆç«¯é‡Œç”¨lldbç›´æ¥è°ƒè¯•ï¼Œä½†æ˜¯ç”¨Xcodeçš„<code>Attach to Process</code>ä¹Ÿå¯ä»¥è¿æ¥åˆ°çœŸæœºä¸Šçš„è¿›ç¨‹è¿›è¡Œè°ƒè¯•ã€‚ä½†æ˜¯åªèƒ½è°ƒè¯•ç”¨è‡ªå·±çš„è¯ä¹¦ç­¾åçš„appã€‚</p>
<p>åœ¨Xcodeä¸Šè°ƒè¯•çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æœ‰UIç•Œé¢ï¼ŒæŸ¥çœ‹å †æ ˆæ›´ç›´æ¥ï¼Œå¯ä»¥ç”¨Xcodeæ‰“æ–­ç‚¹ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨<code>debug gauges</code>é‡Œçš„Diskå’ŒNetworkç­‰å·¥å…·ã€‚</li>
<li>è¾“å…¥lldbå‘½ä»¤æ—¶æœ‰è‡ªåŠ¨è¡¥å…¨ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨Xcodeçš„<code>Debug UI Hierarchy</code>åŠŸèƒ½ï¼Œç›´æ¥æŸ¥çœ‹appçš„ç•Œé¢å¸ƒå±€ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨Xcodeçš„<code>Debug Memory Graph</code>åŠŸèƒ½ï¼ŒæŸ¥çœ‹å½“å‰å†…å­˜ä¸­å­˜åœ¨çš„æ‰€æœ‰å¯¹è±¡ï¼Œä»¥åŠå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»ã€‚</li>
</ul>
<p>æ­¥éª¤å¦‚ä¸‹ã€‚</p>
<h2 id="1-é‡ç­¾åéœ€è¦é€†å‘çš„app"><a href="#1-é‡ç­¾åéœ€è¦é€†å‘çš„app" class="headerlink" title="1.é‡ç­¾åéœ€è¦é€†å‘çš„app"></a>1.é‡ç­¾åéœ€è¦é€†å‘çš„app</h2><p>é‡ç­¾ååæ‰èƒ½ç”¨Xcode attachã€‚è€Œé‡ç­¾åå‰éœ€è¦å¯¹appè¿›è¡Œç ¸å£³ã€‚è¿™äº›æ­¥éª¤å°±ä¸å†é‡å¤äº†ã€‚</p>
<p>é¢å¤–è¯´ä¸€å¥ï¼Œåœ¨ç ¸å£³åå»ºè®®è¿›è¡Œä¸€ä¸‹æ¢å¤ç¬¦å·è¡¨çš„æ“ä½œã€‚æ¢å¤ç¬¦å·è¡¨åï¼Œåœ¨è°ƒè¯•æ—¶å°±èƒ½ç›´æ¥åœ¨å †æ ˆä¸­çœ‹åˆ°æ–¹æ³•åï¼Œå…å»äº†è®¡ç®—åç§»é‡ç„¶ååœ¨hopperé‡ŒæŸ¥æ‰¾çš„éº»çƒ¦ã€‚å‚è€ƒï¼š<a href="http://blog.imjun.net/posts/restore-symbol-of-iOS-app/" target="_blank" rel="external">iOSç¬¦å·è¡¨æ¢å¤&amp;é€†å‘æ”¯ä»˜å®</a>, <a href="https://github.com/tobefuturer/restore-symbol" target="_blank" rel="external">restore-symbol</a>ã€‚</p>
<h2 id="2-Attach-to-Process"><a href="#2-Attach-to-Process" class="headerlink" title="2.Attach to Process"></a>2.Attach to Process</h2><p>é‡ç­¾ååå®‰è£…åˆ°è¶Šç‹±è®¾å¤‡ä¸Šï¼Œå¯åŠ¨appï¼Œåœ¨Xcodeä¸­éšä¾¿æ‰“å¼€ä¸€ä¸ªå·¥ç¨‹ï¼Œé€‰æ‹©è¶Šç‹±è®¾å¤‡ï¼Œå°±å¯ä»¥åœ¨<code>Debug-&gt;Attach to Process</code>ä¸­æ‰¾åˆ°æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹åå’Œè¿›ç¨‹idï¼Œç‚¹å‡»åå°±ä¼šå¼€å§‹è¿æ¥ã€‚å¤§æ¦‚è¿‡1åˆ†é’Ÿå°±ä¼šè¿æ¥ä¸Šã€‚</p>
<h2 id="3-æŸ¥çœ‹UI"><a href="#3-æŸ¥çœ‹UI" class="headerlink" title="3.æŸ¥çœ‹UI"></a>3.æŸ¥çœ‹UI</h2><p>è¿æ¥ä¸Šåï¼Œå°±å¯ä»¥ç‚¹å‡»ä½¿ç”¨Xcodeçš„<code>Debug UI Hierarchy</code>æ¥æŸ¥çœ‹ç•Œé¢å¸ƒå±€ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-b3652b738ff07228.jpg" alt="UI Hierarchy"></p>
<p>æ³¨æ„ï¼Œ<code>Debug UI Hierarchy</code>å¯¹Xcodeç‰ˆæœ¬ä¼¼ä¹æœ‰è¦æ±‚ï¼Œåœ¨è°ƒè¯•é‡ç­¾åappæ—¶ï¼ŒXcode8.3.2å¯ä»¥ï¼Œè€ŒXcode8.2å°±æ²¡æœ‰è¿™ä¸ªåŠŸèƒ½æŒ‰é’®ã€‚</p>
<h2 id="4-æŸ¥çœ‹å†…å­˜ä¿¡æ¯"><a href="#4-æŸ¥çœ‹å†…å­˜ä¿¡æ¯" class="headerlink" title="4.æŸ¥çœ‹å†…å­˜ä¿¡æ¯"></a>4.æŸ¥çœ‹å†…å­˜ä¿¡æ¯</h2><p>ç‚¹å‡»<code>Debug Memory Graph</code>æŒ‰é’®ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰å†…å­˜ä¸­å­˜åœ¨çš„æ•°æ®ã€‚æ‰“å°åœ°å€ï¼ŒæŸ¥çœ‹å¼•ç”¨å…³ç³»ï¼Œå¯ä»¥é…åˆ<code>malloc stack</code>è¿›è¡Œè¿½è¸ªã€‚å¦‚æœæ‰“å¼€äº†<code>malloc stack</code>ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨å³è¾¹æ˜¾ç¤ºè¿™ä¸ªå¯¹è±¡çš„åˆ›å»ºå †æ ˆã€‚å‚è€ƒï¼š<a href="https://zuikyo.github.io/2017/05/04/iOSé€†å‘ï¼šåœ¨ä»»æ„appä¸Šå¼€å¯malloc%20stackè¿½è¸ªå†…å­˜æ¥æº/" target="_blank" rel="external">iOSé€†å‘ï¼šåœ¨ä»»æ„appä¸Šå¼€å¯malloc%20stackè¿½è¸ªå†…å­˜æ¥æº</a>ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-d599a5233b28e245.jpg" alt="Memory Graph"></p>
<h2 id="5-æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶"><a href="#5-æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶" class="headerlink" title="5.æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶"></a>5.æŸ¥çœ‹æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶</h2><p><code>debug gauges</code>ä¸­çš„Diskå·¥å…·å¯ä»¥æŸ¥çœ‹appå½“å‰æ‰“å¼€çš„æ–‡ä»¶ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1865432-80d24111380e2e44.jpg" alt="Open Files"></p>
<h2 id="5-instrumentè°ƒè¯•"><a href="#5-instrumentè°ƒè¯•" class="headerlink" title="5.instrumentè°ƒè¯•"></a>5.instrumentè°ƒè¯•</h2><p>ç±»ä¼¼çš„ï¼Œä¹Ÿå¯ä»¥ç”¨instrumentè°ƒè¯•é‡ç­¾ååçš„appï¼Œä¸è¿‡å¹¶ä¸æ˜¯æ‰€æœ‰å·¥å…·éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå¯¹é€†å‘çš„å¸®åŠ©ä¸å¤§ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/05/ç§æœ‰API-ä¿®å¤iOS 10ä¸å¼¹å‡ºæ˜¯å¦å…è®¸xxxè®¿é—®æ•°æ®å¯¼è‡´appæ— æ³•è”ç½‘çš„bug/" itemprop="url">
                  ç§æœ‰API-ä¿®å¤iOS10ä¸å¼¹å‡º"æ˜¯å¦å…è®¸xxxè®¿é—®æ•°æ®"å¯¼è‡´appæ— æ³•è”ç½‘çš„bug
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2017-02-05T23:38:00+08:00" content="2017-02-05">
              2017-02-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ç§æœ‰API/" itemprop="url" rel="index">
                    <span itemprop="name">ç§æœ‰API</span>
                  </a>
                </span>

                
                
                  ï¼Œ 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ç§æœ‰API/bugä¿®å¤/" itemprop="url" rel="index">
                    <span itemprop="name">bugä¿®å¤</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/02/05/ç§æœ‰API-ä¿®å¤iOS 10ä¸å¼¹å‡ºæ˜¯å¦å…è®¸xxxè®¿é—®æ•°æ®å¯¼è‡´appæ— æ³•è”ç½‘çš„bug/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/02/05/ç§æœ‰API-ä¿®å¤iOS 10ä¸å¼¹å‡ºæ˜¯å¦å…è®¸xxxè®¿é—®æ•°æ®å¯¼è‡´appæ— æ³•è”ç½‘çš„bug/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>iOS 10æœ‰ä¸€ä¸ªç³»ç»Ÿbugï¼šappåœ¨ç¬¬ä¸€æ¬¡å®‰è£…æ—¶ï¼Œç¬¬ä¸€æ¬¡è”ç½‘æ“ä½œä¼šå¼¹å‡ºä¸€ä¸ªæˆæƒæ¡†ï¼Œæç¤ºâ€æ˜¯å¦å…è®¸xxxè®¿é—®æ•°æ®ï¼Ÿâ€ã€‚è€Œæœ‰æ—¶å€™ç³»ç»Ÿå¹¶ä¸ä¼šå¼¹å‡ºæˆæƒæ¡†ï¼Œå¯¼è‡´appæ— æ³•è”ç½‘ã€‚</p>
<p>è¯¦ç»†æƒ…å†µè§ï¼š</p>
<p><a href="http://www.jianshu.com/p/6cbde1b8b922" target="_blank" rel="external">iOS 10 çš„å‘ï¼šæ–°æœºé¦–æ¬¡å®‰è£… appï¼Œè¯·æ±‚ç½‘ç»œæƒé™â€œæ˜¯å¦å…è®¸ä½¿ç”¨æ•°æ®â€</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/22738261" target="_blank" rel="external">iOS 10 ä¸æç¤ºã€Œæ˜¯å¦å…è®¸åº”ç”¨è®¿é—®æ•°æ®ã€ï¼Œå¯¼è‡´åº”ç”¨æ— æ³•ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆ</a></p>
<p>å…³é”®ç‚¹æ€»ç»“ï¼š</p>
<ul>
<li>åªæœ‰iOS 10ä»¥ä¸Šã€å›½è¡Œæœºå‹ã€æœ‰èœ‚çªç½‘ç»œåŠŸèƒ½çš„è®¾å¤‡å­˜åœ¨è¿™ä¸ªæˆæƒé—®é¢˜ï¼ŒWiFiç‰ˆçš„iPadæ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼›</li>
<li>ç”±äºæˆæƒæ¡†æ˜¯åœ¨æœ‰ç½‘ç»œæ“ä½œæ—¶æ‰å¼¹å‡ºçš„ï¼Œè¿™å°±å¯¼è‡´appç¬¬ä¸€æ¬¡ç½‘ç»œè®¿é—®å¿…å®šå¤±è´¥ï¼›</li>
<li>å½“å‡ºç°ä¸å¼¹å‡ºæˆæƒæ¡†çš„bugæ—¶ï¼Œå»è®¾ç½®é‡Œæ›´æ”¹ä»»æ„appçš„èœ‚çªç½‘ç»œæƒé™ï¼Œæˆ–è€…æ‰“å¼€æ— çº¿å±€åŸŸç½‘åŠ©ç†ï¼Œè®©ç³»ç»Ÿæ›´æ–°ä¸€ä¸‹èœ‚çªç½‘ç»œç›¸å…³çš„æ•°æ®ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªbugã€‚</li>
</ul>
<p>è¿™ä¸ªç³»ç»Ÿbugå‡ºç°æ—¶ï¼Œå¯¹ç”¨æˆ·æ¥è¯´æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œappä¹Ÿéœ€è¦æä¾›è¯¦ç»†çš„æç¤ºè¯­æ¥åº”å¯¹è¿™ç§æƒ…å†µï¼Œååˆ†ä¸ä¼˜é›…ã€‚</p>
<h1 id="ä¿®å¤æ–¹æ³•"><a href="#ä¿®å¤æ–¹æ³•" class="headerlink" title="ä¿®å¤æ–¹æ³•"></a>ä¿®å¤æ–¹æ³•</h1><p>æ˜¥èŠ‚æœ‰ç‚¹ç©ºï¼Œæ‰¾åˆ°äº†å‡ ä¸ªç›¸å…³çš„ç§æœ‰APIæ¥ä¿®å¤è¿™ä¸ªbugã€‚</p>
<h2 id="å¼¹å‡ºæˆæƒæ¡†"><a href="#å¼¹å‡ºæˆæƒæ¡†" class="headerlink" title="å¼¹å‡ºæˆæƒæ¡†"></a>å¼¹å‡ºæˆæƒæ¡†</h2><p>é¦–å…ˆæ‰¾åˆ°çš„æ˜¯ä¸€ä¸ªèƒ½ç›´æ¥å¼¹å‡ºæˆæƒæ¡†çš„APIã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//Image: /System/Library/PrivateFrameworks/FTServices.framework/FTServices</div><div class="line"></div><div class="line">@interface FTNetworkSupport : NSObject</div><div class="line">+ (id)sharedInstance;</div><div class="line">- (bool)dataActiveAndReachable;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>å¤´æ–‡ä»¶å‚è€ƒï¼š<a href="https://github.com/JaviSoto/iOS10-Runtime-Headers/blob/master/PrivateFrameworks/FTServices.framework/FTNetworkSupport.h" target="_blank" rel="external">FTNetworkSupport.h</a></p>
<p>å½“appä¹‹å‰æ²¡æœ‰è¯·æ±‚è¿‡ç½‘ç»œæƒé™æ—¶ï¼Œè°ƒç”¨<code>dataActiveAndReachable</code>ä¼šå¼¹å‡ºâ€æ˜¯å¦å…è®¸xxxè®¿é—®æ•°æ®ï¼Ÿâ€çš„æˆæƒæ¡†ï¼Œå¦‚æœç½‘ç»œæƒé™å·²ç»ç¡®å®šï¼Œåˆ™ä¸ä¼šå¼¹å‡ºã€‚</p>
<h3 id="è°ƒç”¨æ–¹å¼"><a href="#è°ƒç”¨æ–¹å¼" class="headerlink" title="è°ƒç”¨æ–¹å¼"></a>è°ƒç”¨æ–¹å¼</h3><p>ç”±äº<code>FTNetworkSupport</code>æ˜¯åœ¨<code>PrivateFrameworks</code>ç›®å½•ä¸‹ï¼Œappå¹¶æ²¡æœ‰åŠ è½½è¿™ä¸ªåº“ï¼Œæ‰€ä»¥è¦ä½¿ç”¨é‡Œé¢çš„ç±»å‰ï¼Œéœ€è¦ç”¨<code>dlopen</code>åŠ è½½<code>FTServices.framework</code>,ç®€å•ç¤ºæ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#import &lt;dlfcn.h&gt;</div><div class="line"></div><div class="line">//åŠ è½½FTServices.framework</div><div class="line">void * FTServicesHandle = dlopen(&quot;/System/Library/PrivateFrameworks/FTServices.framework/FTServices&quot;, RTLD_LAZY);</div><div class="line">Class NetworkSupport = NSClassFromString(@&quot;FTNetworkSupport&quot;);</div><div class="line">id networkSupport = [NetworkSupport performSelector:NSSelectorFromString(@&quot;sharedInstance&quot;)];</div><div class="line">[networkSupport performSelector:NSSelectorFromString(@&quot;dataActiveAndReachable&quot;)];</div><div class="line">//å¸è½½FTServices.framework</div><div class="line">dlclose(FTServicesHandle);</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªAPIèƒ½è§£å†³ç½‘ç»œæƒé™å¯¼è‡´ç¬¬ä¸€ä¸ªè”ç½‘æ“ä½œå¤±è´¥çš„é—®é¢˜ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯å­˜åœ¨æœ‰æ—¶å€™ä¸ä¼šå¼¹å‡ºæˆæƒæ¡†çš„bugã€‚</p>
<h2 id="è®©ç³»ç»Ÿæ›´æ–°èœ‚çªç½‘ç»œæƒé™æ•°æ®"><a href="#è®©ç³»ç»Ÿæ›´æ–°èœ‚çªç½‘ç»œæƒé™æ•°æ®" class="headerlink" title="è®©ç³»ç»Ÿæ›´æ–°èœ‚çªç½‘ç»œæƒé™æ•°æ®"></a>è®©ç³»ç»Ÿæ›´æ–°èœ‚çªç½‘ç»œæƒé™æ•°æ®</h2><p>æ—¢ç„¶æ›´æ”¹ä»»æ„appçš„èœ‚çªç½‘ç»œæƒé™åï¼Œèƒ½è®©appå¼¹å‡ºæˆæƒæ¡†ï¼Œé‚£ä¹ˆåªè¦æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œèƒ½è®©ç³»ç»Ÿæ›´æ–°ä¸€ä¸‹ç½‘ç»œæƒé™ç›¸å…³çš„æ•°æ®å°±å¯ä»¥äº†ã€‚</p>
<p>ç”¨<code>hopper</code>åç¼–è¯‘ä¸€ä¸‹ç³»ç»Ÿçš„è®¾ç½®appç”¨åˆ°çš„åº“<code>PreferencesUI.framework</code>ï¼Œæ‰¾åˆ°äº†é‡Œé¢ä¿®æ”¹appç½‘ç»œæƒé™çš„APIã€‚ç”¨åˆ°çš„æ˜¯<code>CoreTelephony.framework</code>é‡Œçš„ä¸¤ä¸ªç§æœ‰Cå‡½æ•°ï¼š</p>
<p><code>CTServerConnection* _CTServerConnectionCreateOnTargetQueue(CFAllocatorRef, NSString *, dispatch_queue_t, void*/*ä¸€ä¸ªblockç±»å‹çš„å‚æ•°*/)</code></p>
<p><code>void _CTServerConnectionSetCellularUsagePolicy(CTServerConnection *, NSString *, NSDictionary *)</code></p>
<p>å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨æµ‹è¯•è¿™ä¸¤ä¸ªå‡½æ•°ä¸Šäº†ã€‚å‡ ä¸ªæœˆå‰æˆ‘ä¹Ÿç ”ç©¶è¿‡è¿™ä¸¤ä¸ªå‡½æ•°å°è¯•ä¿®å¤è¿™ä¸ªbugï¼Œä½†æ˜¯é‚£æ—¶å€™å‘ç°æ²¡ä»€ä¹ˆä½œç”¨ï¼Œå°±ä¸äº†äº†ä¹‹äº†ã€‚</p>
<h3 id="è°ƒç”¨æ–¹å¼-1"><a href="#è°ƒç”¨æ–¹å¼-1" class="headerlink" title="è°ƒç”¨æ–¹å¼"></a>è°ƒç”¨æ–¹å¼</h3><p>è¦è°ƒç”¨ç§æœ‰Cå‡½æ•°ï¼Œéœ€è¦ç”¨<code>dlsym</code>ï¼Œç®€å•ç¤ºæ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">void *CoreTelephonyHandle = dlopen(&quot;/System/Library/Frameworks/CoreTelephony.framework/CoreTelephony&quot;, RTLD_LAZY);</div><div class="line"></div><div class="line">//ç”¨å‡½æ•°æŒ‡é’ˆæ¥è°ƒç”¨ç§æœ‰Cå‡½æ•°ï¼Œç”¨ç¬¦å·åä»åº“é‡Œå¯»æ‰¾å‡½æ•°åœ°å€</div><div class="line">CFTypeRef (*connectionCreateOnTargetQueue)(CFAllocatorRef, NSString *, dispatch_queue_t, void*) = dlsym(CoreTelephonyHandle, &quot;_CTServerConnectionCreateOnTargetQueue&quot;);</div><div class="line">int (*changeCellularPolicy)(CFTypeRef, NSString *, NSDictionary *) = dlsym(CoreTelephonyHandle, &quot;_CTServerConnectionSetCellularUsagePolicy&quot;);</div><div class="line"></div><div class="line">//ä½¿ç”¨è®¾ç½®appçš„bundle idè¿›è¡Œä¼ªè£…</div><div class="line">CFTypeRef connection = connectionCreateOnTargetQueue(kCFAllocatorDefault,@&quot;com.apple.Preferences&quot;,dispatch_get_main_queue(),NULL);</div><div class="line">//è¯·æ±‚ä¿®æ”¹æœ¬appçš„ç½‘ç»œæƒé™ä¸ºallowedï¼Œä¸ä¼šçœŸçš„ä¿®æ”¹ï¼Œåªèƒ½è§¦å‘ç³»ç»Ÿæ›´æ–°ä¸€ä¸‹ç›¸å…³çš„æ•°æ®</div><div class="line">changeCellularPolicy(connection, @&quot;éœ€è¦æˆæƒçš„appçš„bundle id&quot;, @&#123;@&quot;kCTCellularUsagePolicyDataAllowed&quot;:@YES&#125;);</div><div class="line"></div><div class="line">dlclose(CoreTelephonyHandle);</div></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œåœ¨å£°æ˜connectionCreateOnTargetQueueå’ŒchangeCellularPolicyå‡½æ•°æŒ‡é’ˆæ—¶ï¼Œå‚æ•°ç±»å‹è¦ä¸¥æ ¼å¯¹åº”ï¼Œå¦‚æœç±»å‹é”™è¯¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå¯¹å‚æ•°æ‰§è¡Œé”™è¯¯çš„å†…å­˜ç®¡ç†ï¼Œå‡ºç°crashã€‚<code>CTServerConnection</code>æ˜¯ç§æœ‰çš„ï¼Œæ˜¯<code>CFTypeRef</code>çš„å­ç±»ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç”¨<code>CFTypeRef</code>æ¥ä»£æ›¿ã€‚</p>
<h3 id="å‡ºç°äº†ç„å­¦"><a href="#å‡ºç°äº†ç„å­¦" class="headerlink" title="å‡ºç°äº†ç„å­¦"></a>å‡ºç°äº†ç„å­¦</h3><p><code>_CTServerConnectionSetCellularUsagePolicy</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯éœ€è¦ä¿®æ”¹çš„appçš„bundle idã€‚åœ¨æµ‹è¯•æ—¶ï¼Œå‘ç°ä¼ å…¥è¿™ä¸ªå‚æ•°æ—¶ï¼Œå¯¹è±¡å¿…é¡»æ˜¯ç”¨å­—é¢é‡è¯­æ³•åˆ›å»ºçš„<code>NSString</code>ï¼Œä¾‹å¦‚<code>@&quot;com.who.testDemo&quot;</code>ï¼Œå½“ä¼ å…¥<code>[NSBundle mainBundle].bundleIdentifier</code>è¿™ç§åŠ¨æ€ç”Ÿæˆçš„<code>NSString</code>æ—¶ï¼Œä»ç„¶ä¼šå‡ºç°ä¸å¼¹å‡ºæˆæƒæ¡†çš„bugï¼Œä¹Ÿå°±æ˜¯å¹¶æ²¡æœ‰ä¿®å¤æˆåŠŸã€‚è¿ç»­æµ‹è¯•5-10æ¬¡å°±èƒ½é‡ç°ã€‚</p>
<p>ä¸è¿‡ï¼Œç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSMutableString *bundleIdentifier = [NSMutableString stringWithString:@&quot;com.who&quot;];</div><div class="line">[bundleIdentifier appendString:@&quot;.testDemo&quot;];</div></pre></td></tr></table></figure>
<p>è¿™æ ·çš„å­—ç¬¦ä¸²ä¹Ÿæ²¡é—®é¢˜ã€‚ç›¸åŒç‚¹æ˜¯æœ€ç»ˆéƒ½æ˜¯æ¥è‡ªå­—é¢é‡è¯­æ³•åˆ›å»ºçš„<code>NSString</code>ã€‚</p>
<p>è¿™ä¸ªç„å­¦é—®é¢˜ç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°åŸå› ã€‚</p>
<p>ç ”ç©¶äº†ä¸€ä¸‹å­—é¢é‡åˆ›å»ºå‡ºçš„<code>NSString</code>ï¼Œçš„ç¡®æ˜¯æœ‰äº›ç‰¹æ®Šçš„ã€‚å‚è€ƒï¼š<a href="http://bou.io/ConstantStringsInObjC.html" target="_blank" rel="external">Constant Strings in Objective-C</a>ã€‚å®ƒæ˜¯ä¸€ä¸ª<code>__NSCFConstantString</code>ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œåœ¨appçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ï¼Œè¿™ä¸ªå¯¹è±¡çš„å†…å­˜éƒ½ä¸ä¼šè¢«é‡Šæ”¾ã€‚éš¾é“iOSçš„XPCå¯¹ä½¿ç”¨åˆ°çš„å­—ç¬¦ä¸²è¿˜æœ‰è¦æ±‚ï¼Ÿ</p>
<p>æ—¶é—´æœ‰é™ï¼Œè¿™ä¸ªé—®é¢˜ä»¥åå†ç ”ç©¶å§ã€‚</p>
<h2 id="ç”¨æ§åˆ¶å°è·Ÿè¸ªè¿›ç¨‹é—´é€šä¿¡"><a href="#ç”¨æ§åˆ¶å°è·Ÿè¸ªè¿›ç¨‹é—´é€šä¿¡" class="headerlink" title="ç”¨æ§åˆ¶å°è·Ÿè¸ªè¿›ç¨‹é—´é€šä¿¡"></a><a name="debug-trace"></a>ç”¨æ§åˆ¶å°è·Ÿè¸ªè¿›ç¨‹é—´é€šä¿¡</h2><p>è¿™å‡ ä¸ªç§æœ‰APIéƒ½ç”¨äº†è¿›ç¨‹é—´é€šä¿¡ï¼Œè¦è¿›è¡Œè°ƒè¯•è·Ÿè¸ªæœ‰ç‚¹éº»çƒ¦ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨Macä¸Šçš„æ§åˆ¶å°æŸ¥çœ‹è®¾å¤‡çš„å®æ—¶logï¼Œå¯»æ‰¾é€šä¿¡è¡Œä¸ºã€‚æ‰“å¼€æ§åˆ¶å°appï¼Œåœ¨å·¦ä¾§é€‰æ‹©è¿æ¥åˆ°Macçš„iOSè®¾å¤‡ï¼Œå°±å¯ä»¥çœ‹åˆ°è®¾å¤‡logäº†ã€‚</p>
<p>ä¸‹é¢æ˜¯è°ƒç”¨äº†<code>_CTServerConnectionSetCellularUsagePolicy</code>ä¹‹åçš„logï¼Œä¼ å…¥bundle idæ—¶ç”¨çš„æ˜¯å­—é¢é‡åˆ›å»ºçš„å­—ç¬¦ä¸²ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/1865432-e5eec32d03c2fa7c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½¿ç”¨å­—é¢é‡å­—ç¬¦ä¸²ä¼ å…¥bundle id"><br>é«˜äº®çš„é‚£è¡Œæ˜¯æµ‹è¯•demoæ‰“çš„logï¼Œå¯ä»¥è®¤ä¸ºå°±æ˜¯åœ¨è¿™é‡Œè°ƒç”¨äº†<code>_CTServerConnectionSetCellularUsagePolicy</code>ï¼Œ<br>å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨ä¹‹åç³»ç»Ÿæ›´æ–°äº†æœ¬appçš„æƒé™çŠ¶æ€ã€‚<code>CommCenter</code>å°±æ˜¯è¿™å‡ ä¸ªç§æœ‰APIé€šä¿¡çš„å¯¹åº”è¿›ç¨‹ï¼Œç”¨äºç®¡ç†è®¾å¤‡çš„ç½‘ç»œã€‚å‚è€ƒ<a href="https://www.theiphonewiki.com/wiki//System/Library/Frameworks/CoreTelephony.Framework/Support/CommCenter" target="_blank" rel="external">CommCenter - The iPhone Wiki</a>ã€‚</p>
<p>ä¸‹é¢æ˜¯ç”¨<code>[NSBundle mainBundle].bundleIdentifier</code>ä¼ å…¥<code>_CTServerConnectionSetCellularUsagePolicy</code>çš„ç¬¬äºŒä¸ªå‚æ•°æ—¶çš„logï¼š<br><img src="http://upload-images.jianshu.io/upload_images/1865432-87dfca01425cbad0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä½¿ç”¨åŠ¨æ€åˆ›å»ºçš„å­—ç¬¦ä¸²ä¼ å…¥bundle id"><br>æ²¡æœ‰çœ‹åˆ°ç³»ç»Ÿæ›´æ–°appæƒé™çš„ç›¸å…³logï¼Œè¿›ç¨‹é—´é€šä¿¡å¯èƒ½å¤±è´¥äº†ã€‚å› æ­¤å¯ä»¥ç¡®å®šï¼Œä½¿ç”¨<code>_CTServerConnectionSetCellularUsagePolicy</code>æ—¶å¿…é¡»ä¼ å…¥å­—é¢é‡è¯­æ³•åˆ›å»ºçš„å­—ç¬¦ä¸²ã€‚</p>
<h1 id="æ£€æŸ¥ç½‘ç»œæƒé™æƒ…å†µ"><a href="#æ£€æŸ¥ç½‘ç»œæƒé™æƒ…å†µ" class="headerlink" title="æ£€æŸ¥ç½‘ç»œæƒé™æƒ…å†µ"></a>æ£€æŸ¥ç½‘ç»œæƒé™æƒ…å†µ</h1><p>ç”±äº<code>dataActiveAndReachable</code>é‡Œé¢æœ‰å¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥ä¸èƒ½ç«‹å³ç”¨<code>dlclose</code>å¸è½½<code>FTServices.framework</code>ã€‚è§£å†³æ–¹æ³•æ˜¯ç›‘å¬åˆ°èœ‚çªæƒé™å¼€å¯æ—¶å†å¸è½½ã€‚</p>
<p><code>CoreTelephony</code>é‡Œçš„<code>CTCellularData</code>å¯ä»¥ç”¨æ¥ç›‘æµ‹appçš„èœ‚çªç½‘ç»œæƒé™ï¼Œå¹¶ä¸”è¿™ä¸æ˜¯ä¸ªç§æœ‰APIã€‚ä½ ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥å¸®åŠ©ç”¨æˆ·æ£€æµ‹èœ‚çªæƒé™æ˜¯å¦è¢«å…³é—­ï¼Œå¹¶ç»™å‡ºæç¤ºï¼Œé˜²æ­¢å‡ºç°ç”¨æˆ·å…³äº†ç½‘ç»œæƒé™å¯¼è‡´appæ— æ³•è”ç½‘çš„æƒ…å†µã€‚</p>
<p><code>CTCellularData</code>çš„å¤´æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSUInteger, CTCellularDataRestrictedState) &#123;</div><div class="line">	kCTCellularDataRestrictedStateUnknown,//æƒé™æœªçŸ¥</div><div class="line">	kCTCellularDataRestricted,//èœ‚çªæƒé™è¢«å…³é—­ï¼Œæœ‰ ç½‘ç»œæƒé™å®Œå…¨å…³é—­ or åªæœ‰WiFiæƒé™ ä¸¤ç§æƒ…å†µ</div><div class="line">	kCTCellularDataNotRestricted//èœ‚çªæƒé™å¼€å¯</div><div class="line">&#125;;</div><div class="line"></div><div class="line">@interface CTCellularData : NSObject</div><div class="line">///æƒé™æ›´æ”¹æ—¶çš„å›è°ƒ</div><div class="line">@property (copy, nullable) CellularDataRestrictionDidUpdateNotifier cellularDataRestrictionDidUpdateNotifier;</div><div class="line">///å½“å‰çš„èœ‚çªæƒé™</div><div class="line">@property (nonatomic, readonly) CTCellularDataRestrictedState restrictedState;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#import &lt;CoreTelephony/CTCellularData.h&gt;</div><div class="line"></div><div class="line">CTCellularData *cellularDataHandle = [[CTCellularData alloc] init];</div><div class="line">cellularDataHandle.cellularDataRestrictionDidUpdateNotifier = ^(CTCellularDataRestrictedState state) &#123;</div><div class="line">        //èœ‚çªæƒé™æ›´æ”¹æ—¶çš„å›è°ƒ</div><div class="line">    &#125;;</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„å…³é”®ç‚¹ï¼š</p>
<ul>
<li><code>CTCellularData</code>åªèƒ½æ£€æµ‹èœ‚çªæƒé™ï¼Œä¸èƒ½æ£€æµ‹WiFiæƒé™ã€‚</li>
<li>ä¸€ä¸ª<code>CTCellularData</code>å®ä¾‹æ–°å»ºæ—¶ï¼Œ<code>restrictedState</code>æ˜¯<code>kCTCellularDataRestrictedStateUnknown</code>ï¼Œä¹‹ååœ¨<code>cellularDataRestrictionDidUpdateNotifier</code>é‡Œä¼šæœ‰ä¸€æ¬¡å›è°ƒï¼Œæ­¤æ—¶æ‰èƒ½è·å–åˆ°æ­£ç¡®çš„æƒé™çŠ¶æ€ã€‚</li>
<li>å½“ç”¨æˆ·åœ¨è®¾ç½®é‡Œæ›´æ”¹äº†appçš„æƒé™æ—¶ï¼Œ<code>cellularDataRestrictionDidUpdateNotifier</code>ä¼šæ”¶åˆ°å›è°ƒï¼Œå¦‚æœè¦åœæ­¢ç›‘å¬ï¼Œå¿…é¡»å°†<code>cellularDataRestrictionDidUpdateNotifier</code>è®¾ç½®ä¸º<code>nil</code>ã€‚</li>
<li>èµ‹å€¼ç»™<code>cellularDataRestrictionDidUpdateNotifier</code>çš„blockå¹¶ä¸ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œå³ä¾¿ä½ ç»™ä¸€ä¸ªå±€éƒ¨å˜é‡çš„<code>CTCellularData</code>å®ä¾‹è®¾ç½®ç›‘å¬ï¼Œå½“æƒé™æ›´æ”¹æ—¶ï¼Œè¿˜æ˜¯ä¼šæ”¶åˆ°å›è°ƒï¼Œæ‰€ä»¥è®°å¾—å°†blockç½®<code>nil</code>ã€‚</li>
</ul>
<h1 id="æ£€æµ‹å›½è¡Œæœºå‹å’Œæ˜¯å¦æœ‰èœ‚çªåŠŸèƒ½"><a href="#æ£€æµ‹å›½è¡Œæœºå‹å’Œæ˜¯å¦æœ‰èœ‚çªåŠŸèƒ½" class="headerlink" title="æ£€æµ‹å›½è¡Œæœºå‹å’Œæ˜¯å¦æœ‰èœ‚çªåŠŸèƒ½"></a>æ£€æµ‹å›½è¡Œæœºå‹å’Œæ˜¯å¦æœ‰èœ‚çªåŠŸèƒ½</h1><p>éå›½è¡Œæœºå‹ï¼Œä»¥åŠæ²¡æœ‰èœ‚çªåŠŸèƒ½çš„è®¾å¤‡æ˜¯ä¸éœ€è¦è¿›è¡Œä¿®å¤çš„ã€‚å› æ­¤ä¹Ÿè¦å¯»æ‰¾ç›¸å…³çš„ç§æœ‰APIè¿›è¡Œæ£€æµ‹ã€‚</p>
<p>ç”¨åˆ°çš„ç§æœ‰APIå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//Image: /System/Library/PrivateFrameworks/AppleAccount.framework/AppleAccount</div><div class="line"></div><div class="line">@interface AADeviceInfo : NSObject</div><div class="line">///æ˜¯å¦æœ‰èœ‚çªåŠŸèƒ½</div><div class="line">- (bool)hasCellularCapability;</div><div class="line">///è®¾å¤‡çš„åŒºåŸŸä»£ç ï¼Œä¾‹å¦‚å›½è¡Œæœºå°±æ˜¯CH</div><div class="line">- (id)regionCode;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>å¤´æ–‡ä»¶å‚è€ƒï¼š<a href="https://github.com/JaviSoto/iOS10-Runtime-Headers/blob/master/PrivateFrameworks/AppleAccount.framework/AADeviceInfo.h" target="_blank" rel="external">AADeviceInfo.h</a></p>
<p>ä½¿ç”¨æ–¹å¼å’Œ<code>FTServices.framework</code>ç±»ä¼¼ï¼Œä¸å†é‡å¤ã€‚</p>
<h1 id="æµ‹è¯•ä¿®å¤æ˜¯å¦æˆåŠŸçš„æ–¹æ³•"><a href="#æµ‹è¯•ä¿®å¤æ˜¯å¦æˆåŠŸçš„æ–¹æ³•" class="headerlink" title="æµ‹è¯•ä¿®å¤æ˜¯å¦æˆåŠŸçš„æ–¹æ³•"></a>æµ‹è¯•ä¿®å¤æ˜¯å¦æˆåŠŸçš„æ–¹æ³•</h1><p>æˆ‘çš„æµ‹è¯•æ–¹å¼æ˜¯æ¯æ¬¡è¿è¡Œéƒ½ä¿®æ”¹é¡¹ç›®çš„<code>bundle identifier</code>å’Œ<code>display name</code>ï¼Œè®©ç³»ç»Ÿæ¯æ¬¡éƒ½æŠŠå®ƒå½“åšä¸€ä¸ªæ–°appï¼Œä½¿ç”¨<code>Release</code>æ¨¡å¼ï¼Œæµ‹è¯•æ˜¯å¦æ¯æ¬¡éƒ½èƒ½å¤Ÿå¼¹å‡ºæˆæƒæ¡†ã€‚ç”±äºéœ€è¦ä¸æ–­ä¿®æ”¹<code>bundle identifier</code>ï¼Œå†™äº†ä¸ªè„šæœ¬åœ¨æ¯æ¬¡buildæ—¶è‡ªåŠ¨è¿è¡Œï¼Œä¼šè‡ªåŠ¨ç´¯åŠ å‡ ä¸ªåœ°æ–¹çš„<code>bundle identifier</code>åé¢çš„æ•°å­—ã€‚demoé‡Œå·²ç»é™„å¸¦äº†è¿™ä¸ªè„šæœ¬ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥æµ‹è¯•ä¸€ä¸‹ä¸æ‰§è¡Œä¿®å¤æ—¶ï¼Œè¿›è¡Œè”ç½‘æ“ä½œæ˜¯å¦ä¼šå¼¹å‡ºæˆæƒæ¡†ã€‚æˆ‘çš„æµ‹è¯•ç»“æœæ˜¯å¤§çº¦è¿è¡Œ5-10æ¬¡æ—¶ï¼Œå°±ä¼šå‡ºç°ä¸å¼¹å‡ºæˆæƒæ¡†çš„bugã€‚éœ€è¦æŠŠé¡¹ç›®æ”¹ä¸º<code>Release</code>æ¨¡å¼æ‰èƒ½å‡ºç°ï¼Œ<code>Debug</code>æ¨¡å¼ä¸‹ä¸ä¼šå‡ºbugã€‚</p>
<p>æ³¨æ„ï¼Œç”±äºbuildåè‡ªåŠ¨ç´¯åŠ çš„å…³ç³»ï¼Œ<code>ZIKCellularAuthorization.h</code>é‡Œçš„<code>AppBundleIdentifier</code>æ˜¯ä¸‹ä¸€æ¬¡appè¿è¡Œæ—¶çš„å€¼ã€‚å¦‚æœä½ è§‰å¾—è¿™ä¸ªè„šæœ¬æŠŠä½ ææ™•äº†ï¼Œå¯ä»¥åœ¨<code>Build Phases/Run Script</code>é‡Œå…³æ‰ï¼Œåœ¨<code>sh ${PROJECT_DIR}/IncreaseBundleId.sh</code>å‰é¢åŠ ä¸ª<code>#</code>æ³¨é‡Šæ‰å°±è¡Œäº†ã€‚</p>
<p>æ²¡æœ‰æµ‹è¯•è¦†ç›–å®‰è£…åŒä¸€ä¸ª<code>bundle identifier</code>çš„appï¼Œæˆ–è€…æ›´æ–°äº†ç‰ˆæœ¬å·çš„appæ˜¯å¦ä¹Ÿä¼šå‡ºç°è¿™ä¸ªbugï¼Œç°åœ¨æ˜¯è®¤ä¸ºåªæœ‰ç¬¬ä¸€æ¬¡å®‰è£…æ—¶æ‰ä¼šå‡ºç°bugã€‚</p>
<h1 id="å·¥å…·ä»£ç å’ŒDemo"><a href="#å·¥å…·ä»£ç å’ŒDemo" class="headerlink" title="å·¥å…·ä»£ç å’ŒDemo"></a>å·¥å…·ä»£ç å’ŒDemo</h1><p>åœ°å€åœ¨<a href="https://github.com/Zuikyo/ZIKCellularAuthorization" target="_blank" rel="external">ZIKCellularAuthorization</a>ï¼Œç”¨åˆ°çš„ç§æœ‰APIå·²ç»ç»è¿‡æ··æ·†ã€‚æµ‹è¯•å‰è®°å¾—å…ˆæŠŠ<code>Build Configuration</code>æ”¹ä¸º<code>Release</code>æ¨¡å¼ã€‚æœ‰å¸®åŠ©è¯·ç‚¹ä¸ªStar~</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="http://www.jianshu.com/p/6cbde1b8b922" target="_blank" rel="external">iOS 10 çš„å‘ï¼šæ–°æœºé¦–æ¬¡å®‰è£… appï¼Œè¯·æ±‚ç½‘ç»œæƒé™â€œæ˜¯å¦å…è®¸ä½¿ç”¨æ•°æ®â€</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/22738261" target="_blank" rel="external">iOS 10 ä¸æç¤ºã€Œæ˜¯å¦å…è®¸åº”ç”¨è®¿é—®æ•°æ®ã€ï¼Œå¯¼è‡´åº”ç”¨æ— æ³•ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆ</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/18/iOS Crashæ—¥å¿—åˆ†æå¿…å¤‡ï¼šç¬¦å·åŒ–ç³»ç»Ÿåº“æ–¹æ³•/" itemprop="url">
                  iOS Crashåˆ†æå¿…å¤‡ï¼šç¬¦å·åŒ–ç³»ç»Ÿåº“æ–¹æ³•
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2016-12-18T04:52:00+08:00" content="2016-12-18">
              2016-12-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/è°ƒè¯•æŠ€å·§/" itemprop="url" rel="index">
                    <span itemprop="name">è°ƒè¯•æŠ€å·§</span>
                  </a>
                </span>

                
                
                  ï¼Œ 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/è°ƒè¯•æŠ€å·§/crashåˆ†æ/" itemprop="url" rel="index">
                    <span itemprop="name">crashåˆ†æ</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/18/iOS Crashæ—¥å¿—åˆ†æå¿…å¤‡ï¼šç¬¦å·åŒ–ç³»ç»Ÿåº“æ–¹æ³•/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/12/18/iOS Crashæ—¥å¿—åˆ†æå¿…å¤‡ï¼šç¬¦å·åŒ–ç³»ç»Ÿåº“æ–¹æ³•/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>å¦‚æœä½ æœ‰è¿‡åˆ†æiOSå´©æºƒæ—¥å¿—çš„ç»éªŒï¼Œä¸€å®šç»å¸¸çœ‹åˆ°æ—¥å¿—é‡Œå‡ºç°å¾ˆå¤š<code>&lt;redacted&gt;</code>çš„å­—æ®µã€‚è¿™ç¯‡æ–‡ç« å°±æ˜¯å¸®åŠ©å¼€å‘è€…å°†è¿™äº›å­—æ®µç¬¦å·åŒ–ä¸ºå¯¹åº”çš„ç³»ç»Ÿåº“æ–¹æ³•åã€‚</p>
<p>å¦‚æœä½ å·²ç»æŒæ¡äº†è¿™æ–¹é¢çš„çŸ¥è¯†ï¼Œå°±ç›´æ¥å»ä¸‹é¢çš„<a href="#wang-pan">ç½‘ç›˜ä¸‹è½½åœ°å€</a>ç›®å½•ï¼Œä¸‹è½½æˆ‘æ•´ç†å¥½çš„ç³»ç»Ÿåº“ç¬¦å·æ–‡ä»¶å§ã€‚</p>
<h2 id="ç¬¦å·åŒ–çš„ä½œç”¨"><a href="#ç¬¦å·åŒ–çš„ä½œç”¨" class="headerlink" title="ç¬¦å·åŒ–çš„ä½œç”¨"></a>ç¬¦å·åŒ–çš„ä½œç”¨</h2><p>å½“è·å–åˆ°appçš„crashæ—¥å¿—æ—¶ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯å°†å…¶ç¬¦å·åŒ–ã€‚ä½œç”¨æ˜¯æŠŠæ—¥å¿—å †æ ˆä¸­çš„æ–¹æ³•è°ƒç”¨æ˜¾ç¤ºå‡ºæ¥ï¼Œå¯¹äºæ¥è‡ªappå†…éƒ¨çš„æ–¹æ³•ï¼Œè¿˜èƒ½ç›´æ¥ç»™å‡ºæ–¹æ³•å¯¹åº”.mæ–‡ä»¶çš„æ‰€åœ¨è¡Œã€‚</p>
<p>ç¬¦å·åŒ–å‰ï¼ˆè¿™é‡Œé¡¹ç›®çš„<code>Build Settings</code>é‡Œçš„<code>Strip Style</code>è®¾ä¸ºäº†<code>Debugging Symbols</code>ï¼Œæ‰€ä»¥è¿™é‡Œèƒ½ç›´æ¥çœ‹åˆ°<code>MyApp</code>çš„æ–¹æ³•åã€‚æ›´å¤šå’Œsymbolç›¸å…³çš„è®¾ç½®ï¼Œè¯·çœ‹<a href="http://www.jianshu.com/p/11710e7ab661" target="_blank" rel="external">è¿™é‡Œ</a>ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Thread 7:</div><div class="line">0   libsystem_kernel.dylib          0x000000018efb416c 0x18efb3000 + 4460 (mach_msg_trap + 8)</div><div class="line">1   libsystem_kernel.dylib          0x000000018efb3fdc 0x18efb3000 + 4060 (mach_msg + 72)</div><div class="line">2   MyApp                           0x000000010091e558 0x1000bc000 + 8791384 (ksmachexc_i_handleExceptions + 148)</div><div class="line">3   libsystem_pthread.dylib         0x000000018f097860 0x18f094000 + 14432 (&lt;redacted&gt; + 240)</div><div class="line">4   libsystem_pthread.dylib         0x000000018f097770 0x18f094000 + 14192 (_pthread_start + 284)</div></pre></td></tr></table></figure>
<p>ç¬¦å·åŒ–åï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Thread 7:</div><div class="line">0   libsystem_kernel.dylib          0x000000018efb416c mach_msg_trap + 8</div><div class="line">1   libsystem_kernel.dylib          0x000000018efb3fdc mach_msg + 72</div><div class="line">2   MyApp                           0x000000010091e558 ksmachexc_i_handleExceptions (KSCrashSentry_MachException.c:233)</div><div class="line">3   libsystem_pthread.dylib         0x000000018f097860 _pthread_body + 240</div><div class="line">4   libsystem_pthread.dylib         0x000000018f097770 _pthread_body + 0</div></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œframe 3é‡Œ<code>libsystem_pthread.dylib</code>çš„<code>&lt;redacted&gt;</code>å˜æˆäº†<code>_pthread_body</code>ï¼Œframe 2é‡Œ<code>MyApp</code>çš„<code>ksmachexc_i_handleExceptions</code>å˜æˆäº†æ›´ä¸ºå®Œæ•´çš„<code>ksmachexc_i_handleExceptions (KSCrashSentry_MachException.c:233)</code>ï¼Œç›´æ¥ç»™å‡ºäº†æ–¹æ³•åŠå…¶æ‰€åœ¨æ–‡ä»¶å’Œè¡Œæ•°ã€‚</p>
<p>è¯¦ç»†çš„ç¬¦å·åŒ–æ–¹æ³•ï¼Œè¯·å‚è€ƒ<a href="http://wufawei.com/2014/03/symbolicating-ios-crash-logs/" target="_blank" rel="external">ç¬¦å·åŒ–iOS Crashæ–‡ä»¶çš„3ç§æ–¹æ³•</a>ã€‚è¿™é‡Œå°±ä¸é‡å¤äº†ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œcrashæ—¥å¿—é‡Œå¹¶ä¸ä¼šæœ‰MyAppçš„è°ƒç”¨ï¼Œè€Œå…¨éƒ½æ˜¯ç³»ç»Ÿåº“çš„è°ƒç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Thread 0 name:  Dispatch queue: com.apple.main-thread</div><div class="line">Thread 0 Crashed:</div><div class="line">0   libobjc.A.dylib                 0x000000018b816f30 0x18b7fc000 + 110384 (objc_msgSend + 16)</div><div class="line">1   UIKit                           0x0000000192e0a79c 0x192c05000 + 2119580 (&lt;redacted&gt; + 72)</div><div class="line">2   UIKit                           0x0000000192c4db48 0x192c05000 + 297800 (&lt;redacted&gt; + 312)</div><div class="line">3   UIKit                           0x0000000192c4d988 0x192c05000 + 297352 (&lt;redacted&gt; + 160)</div><div class="line">4   QuartzCore                      0x00000001900d6404 0x18ffc5000 + 1119236 (&lt;redacted&gt; + 260)</div><div class="line">5   libdispatch.dylib               0x000000018bc551c0 0x18bc54000 + 4544 (&lt;redacted&gt; + 16)</div><div class="line">6   libdispatch.dylib               0x000000018bc59d6c 0x18bc54000 + 23916 (_dispatch_main_queue_callback_4CF + 1000)</div><div class="line">7   CoreFoundation                  0x000000018cd79f2c 0x18cc9d000 + 905004 (&lt;redacted&gt; + 12)</div><div class="line">8   CoreFoundation                  0x000000018cd77b18 0x18cc9d000 + 895768 (&lt;redacted&gt; + 1660)</div><div class="line">9   CoreFoundation                  0x000000018cca6048 0x18cc9d000 + 36936 (CFRunLoopRunSpecific + 444)</div><div class="line">10  GraphicsServices                0x000000018e729198 0x18e71d000 + 49560 (GSEventRunModal + 180)</div><div class="line">11  UIKit                           0x0000000192c80628 0x192c05000 + 505384 (&lt;redacted&gt; + 684)</div><div class="line">12  UIKit                           0x0000000192c7b360 0x192c05000 + 484192 (UIApplicationMain + 208)</div><div class="line">13  MyApp                           0x0000000100016e54 0x100004000 + 77396 (_mh_execute_header + 77396)</div><div class="line">14  libdyld.dylib                   0x000000018bc885b8 0x18bc84000 + 17848 (&lt;redacted&gt; + 4)</div></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™å°±å¿…é¡»ç¬¦å·åŒ–ç³»ç»Ÿåº“äº†ã€‚ç¬¦å·åŒ–åçš„æ—¥å¿—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Thread 0 name:  Dispatch queue: com.apple.main-thread</div><div class="line">Thread 0 Crashed:</div><div class="line">0   libobjc.A.dylib                 0x000000018b816f30 objc_msgSend + 16</div><div class="line">1   UIKit                           0x0000000192e0a79c -[UISearchDisplayController _sendDelegateDidBeginDidEndSearch] + 72</div><div class="line">2   UIKit                           0x0000000192c4db48 -[UIViewAnimationState sendDelegateAnimationDidStop:finished:] + 312</div><div class="line">3   UIKit                           0x0000000192c4d988 -[UIViewAnimationState animationDidStop:finished:] + 160</div><div class="line">4   QuartzCore                      0x00000001900d6404 CA::Layer::run_animation_callbacks(void*) + 260</div><div class="line">5   libdispatch.dylib               0x000000018bc551c0 _dispatch_client_callout + 16</div><div class="line">6   libdispatch.dylib               0x000000018bc59d6c _dispatch_main_queue_callback_4CF + 1000</div><div class="line">7   CoreFoundation                  0x000000018cd79f2c __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__ + 12</div><div class="line">8   CoreFoundation                  0x000000018cd77b18 __CFRunLoopRun + 1660</div><div class="line">9   CoreFoundation                  0x000000018cca6048 CFRunLoopRunSpecific + 444</div><div class="line">10  GraphicsServices                0x000000018e729198 GSEventRunModal + 180</div><div class="line">11  UIKit                           0x0000000192c80628 -[UIApplication _run] + 684</div><div class="line">12  UIKit                           0x0000000192c7b360 UIApplicationMain + 208</div><div class="line">13  MyApp                           0x0000000100016e54 main (main.m:15)</div><div class="line">14  libdyld.dylib                   0x000000018bc885b8 start + 4</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºæ˜¯<code>UISearchController</code>çš„<code>delegate</code>å¯¼è‡´çš„é—®é¢˜ï¼Œæ£€æŸ¥ä¸€ä¸‹å°±å‘ç°<code>UISearchDisplayController</code>çš„<code>delegate</code>æ˜¯<code>assign</code>çš„ï¼Œæ˜¯ç”±äºç‚¹å‡»æœç´¢æ¡çš„åŒæ—¶popäº†ç•Œé¢å¯¼è‡´çš„crashã€‚</p>
<p>ä»è¿™é‡Œå¯ä»¥å‘ç°ï¼Œç¬¦å·åŒ–ç³»ç»Ÿåº“æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p>
<p>##å¦‚ä½•ç¬¦å·åŒ–ç³»ç»Ÿåº“</p>
<p>ç¬¦å·åŒ–è‡ªå·±appçš„æ–¹æ³•åï¼Œéœ€è¦ç¼–è¯‘ipaæ—¶ç”Ÿæˆçš„dySYMæ–‡ä»¶ã€‚è€Œè¦å°†ç³»ç»Ÿåº“çš„<code>&lt;redacted&gt;</code>ç¬¦å·åŒ–ä¸ºå®Œæ•´çš„æ–¹æ³•åï¼Œä¹Ÿéœ€è¦ç³»ç»Ÿåº“çš„ç¬¦å·æ–‡ä»¶ã€‚</p>
<h3 id="1-åŒ¹é…å¯¹åº”çš„ç¬¦å·æ–‡ä»¶ç‰ˆæœ¬"><a href="#1-åŒ¹é…å¯¹åº”çš„ç¬¦å·æ–‡ä»¶ç‰ˆæœ¬" class="headerlink" title="1. åŒ¹é…å¯¹åº”çš„ç¬¦å·æ–‡ä»¶ç‰ˆæœ¬"></a>1. åŒ¹é…å¯¹åº”çš„ç¬¦å·æ–‡ä»¶ç‰ˆæœ¬</h3><p>ç³»ç»Ÿåº“ç¬¦å·æ–‡ä»¶ä¸æ˜¯é€šç”¨çš„ï¼Œè€Œæ˜¯å¯¹åº”crashæ‰€åœ¨è®¾å¤‡çš„ç³»ç»Ÿç‰ˆæœ¬å’ŒCPUå‹å·çš„ã€‚</p>
<p>crashæ—¥å¿—ä¸­æœ‰è¿™æ ·ä¸¤ä¸ªä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Code Type:       ARM-64</div><div class="line">OS Version:      iOS 10.2 (14C82)</div></pre></td></tr></table></figure>
<p><code>Code Type</code>è¡¨ç¤ºæ­¤è®¾å¤‡çš„CPUä¸º<code>armv7</code>ã€<code>armv7s</code>è¿˜æ˜¯<code>arm64</code>ã€‚</p>
<p><code>OS Version</code>è¡¨ç¤ºæ­¤è®¾å¤‡çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼Œæ‹¬å·ä¸­çš„å­—ç¬¦ä¸²ä»£è¡¨äº†æ­¤ç³»ç»Ÿçš„buildå·ã€‚å¯ä»¥åœ¨è¿™é‡ŒæŸ¥æ‰¾buildå·ï¼š<a href="https://en.wikipedia.org/wiki/IOS_SDK" target="_blank" rel="external">iOS SDK</a>ï¼Œ<a href="https://en.wikipedia.org/wiki/IOS_version_history#iOS_10" target="_blank" rel="external">iOS version history</a>ã€‚</p>
<h3 id="2-å°†å¯¹åº”ç‰ˆæœ¬çš„ç¬¦å·æ–‡ä»¶æ”¾åˆ°æŒ‡å®šç›®å½•"><a href="#2-å°†å¯¹åº”ç‰ˆæœ¬çš„ç¬¦å·æ–‡ä»¶æ”¾åˆ°æŒ‡å®šç›®å½•" class="headerlink" title="2. å°†å¯¹åº”ç‰ˆæœ¬çš„ç¬¦å·æ–‡ä»¶æ”¾åˆ°æŒ‡å®šç›®å½•"></a>2. å°†å¯¹åº”ç‰ˆæœ¬çš„ç¬¦å·æ–‡ä»¶æ”¾åˆ°æŒ‡å®šç›®å½•</h3><p>è¿™æ—¶å€™ï¼ŒæŠŠè·å–åˆ°çš„å¯¹åº”ç‰ˆæœ¬çš„ç¬¦å·æ–‡ä»¶æ”¾åˆ°Macçš„<code>~/Library/Developer/Xcode/iOS DeviceSupport</code>ç›®å½•ä¸‹ï¼Œå†ä½¿ç”¨<a href="http://wufawei.com/2014/03/symbolicating-ios-crash-logs/" target="_blank" rel="external">ç¬¦å·åŒ–iOS Crashæ–‡ä»¶çš„3ç§æ–¹æ³•</a>é‡Œæåˆ°çš„Xcodeè‡ªå¸¦çš„ç¬¦å·åŒ–å·¥å…·<code>symbolicatecrash</code>è¿›è¡Œç¬¦å·åŒ–ã€‚è¿™ä¸ªå·¥å…·ä¼šè‡ªåŠ¨æœç´¢ç³»ç»Ÿåº“ç¬¦å·æ–‡ä»¶ã€‚</p>
<h2 id="è·å–ç³»ç»Ÿç¬¦å·æ–‡ä»¶çš„4ä¸ªæ–¹æ³•"><a href="#è·å–ç³»ç»Ÿç¬¦å·æ–‡ä»¶çš„4ä¸ªæ–¹æ³•" class="headerlink" title="è·å–ç³»ç»Ÿç¬¦å·æ–‡ä»¶çš„4ä¸ªæ–¹æ³•"></a>è·å–ç³»ç»Ÿç¬¦å·æ–‡ä»¶çš„4ä¸ªæ–¹æ³•</h2><h3 id="ä»çœŸæœºä¸Šè·å–"><a href="#ä»çœŸæœºä¸Šè·å–" class="headerlink" title="ä»çœŸæœºä¸Šè·å–"></a>ä»çœŸæœºä¸Šè·å–</h3><p>å¤§éƒ¨åˆ†ç³»ç»Ÿåº“ç¬¦å·æ–‡ä»¶åªèƒ½ä»çœŸæœºä¸Šè·å–ï¼Œè‹¹æœä¹Ÿæ²¡æœ‰æä¾›ä¸‹è½½ã€‚<br>å½“ä½ ç”¨Xcodeç¬¬ä¸€æ¬¡è¿æ¥æŸå°è®¾å¤‡è¿›è¡ŒçœŸæœºè°ƒè¯•æ—¶ï¼Œä¼šçœ‹åˆ°Xcodeæ˜¾ç¤º<code>Processing symbol files</code>ï¼Œè¿™æ—¶å€™å°±æ˜¯åœ¨æ‹·è´çœŸæœºä¸Šçš„ç¬¦å·æ–‡ä»¶åˆ°Macç³»ç»Ÿçš„<code>/Users/xxx/Library/Developer/Xcode/iOS DeviceSupport</code>ç›®å½•ä¸‹ã€‚</p>
<p>ç›®å½•ä¸‹çš„<code>10.2(14C82)</code>è¿™æ ·çš„æ–‡ä»¶å¤¹å°±æ˜¯å¯¹åº”çš„ç¬¦å·æ–‡ä»¶ï¼Œé€šå¸¸éƒ½æœ‰1-3GBçš„å¤§å°ï¼Œå¾ˆå ç”¨ç©ºé—´ï¼ŒåŠ¨ä¸åŠ¨å°±ç´¯ç§¯æˆ3ã€40GBã€‚å¾ˆå¤šè®²æ¸…ç†Macåƒåœ¾æ–‡ä»¶çš„æ•™ç¨‹éƒ½ä¼šè¯´è¦åˆ é™¤è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ï¼ŒçœŸæ˜¯å‘çˆ¹ã€‚æ­£ç¡®åšæ³•æ˜¯åšæˆå‹ç¼©åŒ…ä¿å­˜åˆ°å¤–éƒ¨ç¡¬ç›˜é‡Œï¼Œéœ€è¦ç¬¦å·åŒ–çš„æ—¶å€™å†é‡æ–°è§£å‹åˆ°æ­¤ç›®å½•ã€‚</p>
<h3 id="å¯»æ‰¾è‹¹æœå®˜æ–¹çš„ä¸‹è½½åœ°å€"><a href="#å¯»æ‰¾è‹¹æœå®˜æ–¹çš„ä¸‹è½½åœ°å€" class="headerlink" title="å¯»æ‰¾è‹¹æœå®˜æ–¹çš„ä¸‹è½½åœ°å€"></a>å¯»æ‰¾è‹¹æœå®˜æ–¹çš„ä¸‹è½½åœ°å€</h3><p>ä¹‹å‰watchçš„è°ƒè¯•å‡ºç°bugæ—¶ï¼Œæœ‰äººæ‰¾å‡ºè¿‡å‡ ä¸ªwatchçš„ç¬¦å·æ–‡ä»¶ä¸‹è½½åœ°å€ã€‚è§<a href="https://forums.developer.apple.com/thread/3380" target="_blank" rel="external">No symbols for paired Apple Watch</a>ã€‚<br>ä½†æ˜¯æˆ‘å°è¯•æŒ‰ç…§å¯¹åº”çš„å‘½åæ ¼å¼ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°iOSç¬¦å·æ–‡ä»¶çš„ä¸‹è½½åœ°å€ã€‚</p>
<h3 id="ä»å·²è§£å¯†çš„å›ºä»¶ä¸­æå–ç¬¦å·æ–‡ä»¶"><a href="#ä»å·²è§£å¯†çš„å›ºä»¶ä¸­æå–ç¬¦å·æ–‡ä»¶" class="headerlink" title="ä»å·²è§£å¯†çš„å›ºä»¶ä¸­æå–ç¬¦å·æ–‡ä»¶"></a>ä»å·²è§£å¯†çš„å›ºä»¶ä¸­æå–ç¬¦å·æ–‡ä»¶</h3><p>æŸäº›å·²ç»è¢«ç ´è§£çš„å›ºä»¶å¯ä»¥ç›´æ¥æå–ç³»ç»Ÿæ–‡ä»¶ï¼Œä½†æ˜¯æœªç ´è§£çš„å›ºä»¶ï¼ˆè¾ƒæ–°çš„å›ºä»¶å’Œ<code>arm64</code>çš„å›ºä»¶ï¼‰ï¼Œæ— æ³•ç”¨è¿™ç§æ–¹å¼è·å–ã€‚</p>
<p>å›ºä»¶è§£å¯†æ­¥éª¤ï¼š</p>
<p>1.ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„.ipswå›ºä»¶ï¼Œç›´æ¥è§£å‹ï¼Œè§£å‹åé‡Œé¢æœ‰å‡ ä¸ª<code>.dmg</code>æ ¼å¼çš„é•œåƒæ–‡ä»¶ï¼Œæœ€å¤§çš„<code>.dmg</code>æ–‡ä»¶å°±æ˜¯ç³»ç»Ÿé•œåƒã€‚<br>2.ä»<a href="https://www.theiphonewiki.com/wiki/Firmware_Keys" target="_blank" rel="external">Firmware_Keys</a>æ‰¾åˆ°å¯¹åº”å›ºä»¶çš„è§£å¯†keyï¼ˆé¡µé¢ä¸Š<code>Root Filesystem</code>å­—æ®µçš„keyï¼‰ã€‚<br>3.ç”¨ä¸€ä¸ª<code>dmg</code>å·¥å…·è¿›è¡Œè§£å¯†ï¼Œ<a href="http://modmyi.com/attachments/forums/general-verizon-sprint-cdma-iphone-chat/643832d1372672304-cant-decrypt-ios-7-beta-help-dmg.zip" target="_blank" rel="external">ä¸‹è½½åœ°å€</a>ã€‚ä½¿ç”¨æ–¹å¼ï¼š<code>cd</code>åˆ°è§£å‹åçš„ipswæ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ<code>./dmg extract xxx-xxxx-xxx.dmg dec.dmg -k &lt;key&gt;</code>ã€‚<code>extract</code>åé¢è·Ÿä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç³»ç»Ÿé•œåƒdmgçš„åå­—å’Œè§£å¯†åçš„æ–‡ä»¶åï¼Œ-k åé¢å¡«å†™ç¬¬2æ­¥è·å–åˆ°çš„keyï¼Œå¦‚æœkeyä¸å¯¹ï¼Œè§£å¯†ä¼šå¤±è´¥ã€‚<br>4.ç­‰å¾…ã€‚æœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ª<code>dec.dmg</code>æ–‡ä»¶ï¼ŒåŒå‡»æ‰“å¼€å³å¯åŠ è½½ç³»ç»Ÿé•œåƒã€‚</p>
<p>æå–ç¬¦å·æ–‡ä»¶æ–¹æ³•ï¼š<br>å‚è€ƒ<a href="http://crash.163.com/#news/!newsId=31" target="_blank" rel="external">èŠèŠä»iOSå›ºä»¶æå–ç³»ç»Ÿåº“ç¬¦å·</a>ä¸­çš„<code>äºŒã€ç³»ç»Ÿåº“ç¬¦å·æå–</code>éƒ¨åˆ†ã€‚</p>
<h3 id="ä¸‹è½½æ—§ç‰ˆæœ¬Xcodeï¼Œæå–SDK"><a href="#ä¸‹è½½æ—§ç‰ˆæœ¬Xcodeï¼Œæå–SDK" class="headerlink" title="ä¸‹è½½æ—§ç‰ˆæœ¬Xcodeï¼Œæå–SDK"></a>ä¸‹è½½æ—§ç‰ˆæœ¬Xcodeï¼Œæå–SDK</h3><p>æ—§ç‰ˆæœ¬çš„Xcodeé‡ŒåŒ…å«äº†å¯¹åº”çš„iPhoneSDKï¼Œå¯ä»¥ä»ä¸­è·å¾—ç¬¦å·æ–‡ä»¶ã€‚<br>è·¯å¾„æ˜¯<code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk/</code>ã€‚é‡Œé¢çš„<code>System/Library</code>é‡Œå°±å¯ä»¥çœ‹åˆ°frameworkï¼Œè€Œä¸”åŒæ—¶åŒ…å«äº†<code>armv7</code>,<code>armv7s</code>,<code>arm64</code>3ä¸ªå¹³å°çš„ç‰ˆæœ¬ã€‚</p>
<p><code>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/version.plist</code>å¯ä»¥æŸ¥çœ‹æ˜¯å“ªä¸ªç‰ˆæœ¬ã€‚æŠŠ<code>iPhoneOS.sdk</code>æ–‡ä»¶å¤¹çš„åå­—æ”¹æˆå¯¹åº”çš„<code>CFBundleVersion (ProductBuildVersion)</code>æ ¼å¼ï¼Œç„¶ååœ¨é‡Œé¢åŠ ä¸€å±‚<code>Symbols</code>å­æ–‡ä»¶å¤¹ï¼ŒæŠŠ<code>System</code>,<code>Library</code>,<code>usr</code>éƒ½æ”¾è¿›<code>Symbols</code>é‡Œï¼Œå°±å¯ä»¥å’Œå…¶ä»–ç¬¦å·æ–‡ä»¶ä¸€æ ·ä½¿ç”¨äº†ã€‚</p>
<p>ä½†æ˜¯å½“iOSç‰ˆæœ¬åªåŒ…å«äº†bugä¿®å¤ï¼Œè€Œæ²¡æœ‰æ”¹å˜APIï¼ŒXcodeå°±ä¸ä¼šæœ‰é™„å¸¦å¯¹åº”çš„SDKï¼Œè¿˜æ˜¯éœ€è¦ä»çœŸæœºä¸Šè·å–ã€‚è€Œä¸”ä»Xcode7å¼€å§‹ï¼Œè‹¹æœç”¨<code>tbd</code>æ–‡ä»¶ä»£æ›¿äº†çœŸæœºç¬¦å·æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¹Ÿå¤±æ•ˆäº†ã€‚<br>å‚è€ƒï¼š<a href="http://stackoverflow.com/questions/14941773/xcode-software-image-for-user-ios-in-order-to-symbolicate-ios-calls" target="_blank" rel="external">Xcode software image for user iOS in order to symbolicate iOS calls</a>, <a href="http://stackoverflow.com/a/28408052/6380485" target="_blank" rel="external">Missing iOS symbols at â€œ~/Library/Developer/Xcode/iOS DeviceSupportâ€</a>ã€‚</p>
<h2 id="è·å–ç¬¦å·æ–‡ä»¶çš„éš¾é¢˜"><a href="#è·å–ç¬¦å·æ–‡ä»¶çš„éš¾é¢˜" class="headerlink" title="è·å–ç¬¦å·æ–‡ä»¶çš„éš¾é¢˜"></a>è·å–ç¬¦å·æ–‡ä»¶çš„éš¾é¢˜</h2><p>è¿™ä¸ªæ—¶å€™ï¼Œæ¸¸æˆå°±å¼€å§‹äº†ï¼š</p>
<ul>
<li>å¾ˆå¤šæ—¶å€™crashæ—¥å¿—åªç»™å‡ºäº†ç³»ç»Ÿçš„è°ƒç”¨æ ˆï¼Œä¸èƒ½ç›´æ¥å®šä½åˆ°è‡ªå·±appçš„ä»£ç ï¼Œå› æ­¤éœ€è¦ç¬¦å·åŒ–ç³»ç»Ÿåº“ã€‚</li>
<li>ç”¨æˆ·çš„crashæ¥è‡ªå„ç§ç³»ç»Ÿç‰ˆæœ¬ï¼Œéœ€è¦å¯¹åº”ç‰ˆæœ¬çš„ç³»ç»Ÿç¬¦å·æ–‡ä»¶æ‰èƒ½ç¬¦å·åŒ–ã€‚</li>
<li>ç³»ç»Ÿåº“ç¬¦å·æ–‡ä»¶åªèƒ½ä»çœŸæœºä¸Šè·å–ï¼Œè‹¹æœæ²¡æœ‰æä¾›ä¸‹è½½ã€‚</li>
<li>ä»<code>iOS 7.0(11A465)</code>åˆ°<code>iOS 10.2(14C92)</code>ä¸€å…±æœ‰50ä¸ªbuildç‰ˆæœ¬ï¼Œå…¬å¸çš„æµ‹è¯•æœºæ˜¯ä¸ä¼šè¦†ç›–åˆ°è¿™ä¹ˆå˜æ€çš„å®Œæ•´åº¦çš„ã€‚</li>
<li>åŒä¸€ä¸ªç‰ˆæœ¬ï¼Œæœ‰æ—¶å€™ä¼šç»™iPhoneå’ŒiPadã€ç”šè‡³6å’Œ6sæä¾›ä¸åŒbuildçš„å›ºä»¶ã€‚</li>
<li>æŸäº›ç‰ˆæœ¬æ˜¯æŸäº›æœºå­çš„ç‰¹ä¾›ç‰ˆï¼Œä¾‹å¦‚<code>10.0.3(14A551)</code>æ˜¯iPhone 7å’Œ 7 Plusç‹¬æœ‰çš„ï¼Œè¿™å°±æ›´åŠ å¤§äº†æ”¶é›†éš¾åº¦ã€‚</li>
<li>åŒä¸€ä¸ªiOSç‰ˆæœ¬å¯èƒ½æœ‰å¤šä¸ªbuildï¼Œä¾‹å¦‚<code>10.1(14B72)</code>å’Œ<code>10.1(14B72c)</code>ï¼Œè‹¹æœè§‰å¾—æ›´æ–°å¹…åº¦å¤ªå°ï¼Œå°±æ²¡æœ‰æå‡ç‰ˆæœ¬å·ã€‚</li>
<li>é™¤äº†buildå·çš„åŒºåˆ«ï¼Œç¬¦å·æ–‡ä»¶åœ¨ä¸åŒCPUå¹³å°ä¸Šä¹Ÿæœ‰åŒºåˆ«ï¼Œæ„å‘³ç€æ¥è‡ª4s(<code>armv7</code>)å’Œ6s(<code>arm64</code>)çš„ç¬¦å·æ–‡ä»¶ï¼Œå³ä¾¿buildå·æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ— æ³•é€šç”¨ã€‚æ‰€ä»¥50ä¸ªbuildå·åˆè¦ç¿»å€ï¼Œè¾¾åˆ°äº†88ä¸ªï¼Œæ‰€ä»¥ç²¾ç¡®æ¥è¯´æˆ‘åªæ˜¯æ”¶é›†äº†ï¼ˆ63/88ï¼‰çš„è¿›åº¦ã€‚å¹¸è¿çš„æ˜¯ï¼Œ<code>arm64</code>æœºå‹çš„ç³»ç»Ÿåº“é‡Œé™„å¸¦äº†<code>armv7s</code>ã€‚</li>
</ul>
<p>è§„åˆ™å¥½å‰å®³çš„æ”¶é›†æ¸¸æˆå•Šã€‚æ”¶é›†å“å…¶å®è¿˜æœ‰ç¨€æœ‰åº¦çš„åŒºåˆ«ï¼Œå…¶ä¸­æœ€å‰å®³çš„åº”è¯¥æ˜¯<code>10.0</code>ï¼Œè¿™æ˜¯iPhone 7å’Œ7 Plusç‹¬æœ‰çš„å‡ºå‚ç³»ç»Ÿï¼Œè€Œä¸”æ²¡æœ‰å›ºä»¶å¯ä»¥ä¸‹è½½ï¼Œå› æ­¤å³ä¾¿æœ‰iPhone 7ä¹Ÿä¸èƒ½é€šè¿‡åˆ·æœºæ¥å¾—åˆ°<code>10.0</code>ã€‚</p>
<p>å…¶å®æˆ‘ä¸€ç›´å¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆå¾ˆå°‘è§åˆ°å¼€å‘è€…æŠ±æ€¨æ‰¾ä¸åˆ°ç³»ç»Ÿç¬¦å·æ–‡ä»¶ï¼Œä»è€Œå¬é›†å¤§å®¶è¿›è¡Œæ”¶é›†å¹¶åˆ†äº«ï¼ŒçŒœæµ‹å¯èƒ½çš„åŸå› æ˜¯ï¼š</p>
<ul>
<li>æ‡’ã€‚é‡åˆ°æ— æ³•ç¬¦å·åŒ–çš„é—®é¢˜ï¼Œæ²¡æœ‰å»è§£å†³ã€‚</li>
<li>æœ‰äº›å…¬å¸å¯èƒ½å¾ˆæ—©å°±å¼€å§‹å¯¹crashæ—¥å¿—è‡ªåŠ¨ç¬¦å·åŒ–äº†ï¼Œå› æ­¤å¾ˆæ—©å°±å¼€å§‹æ”¶é›†ç¬¦å·æ–‡ä»¶ã€‚åªè¦ä¸€ç›´è·Ÿç€è‹¹æœçš„æ¯ä¸€ä¸ªç‰ˆæœ¬å‡çº§ï¼Œæ”¶é›†èµ·æ¥è¿˜æ˜¯æŒºç®€å•çš„ã€‚è€Œè¿™äº›èµ„æºï¼Œå¼€å‘è€…å¹¶ä¸ä¼šæ³¨æ„åˆ°å¯ä»¥å…±äº«å‡ºæ¥ã€‚</li>
<li>crashæ”¶é›†å’Œç¬¦å·åŒ–ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œç¬¬ä¸‰æ–¹å¹³å°ä¼šå¸®åŠ©ç¬¦å·åŒ–ç³»ç»Ÿåº“ã€‚</li>
</ul>
<p>ä½†æ˜¯æˆ‘æ‰¾äº†ä¸€ä¸‹ï¼Œæ²¡æœ‰æ‰¾åˆ°ä¸€å®¶æ˜ç¡®å£°æ˜äº†èƒ½å¤Ÿç¬¦å·åŒ–æ‰€æœ‰ç³»ç»Ÿåº“çš„ç¬¬ä¸‰æ–¹å¹³å°ã€‚ä»è…¾è®¯çš„Buglyè®ºå›é‡Œä¹Ÿèƒ½å‘ç°ï¼Œæœ‰äº›ç³»ç»Ÿæ–¹æ³•å¹¶æ²¡æœ‰ç¬¦å·åŒ–å‡ºæ¥ï¼Œç³»ç»Ÿåº“æ˜¯ç¼ºå¤±çš„ã€‚ï¼ˆ<strong>update</strong>ï¼šæ‰¾åˆ°äº†ä¸€ä¸ªå›½å¤–çš„å¹³å°ï¼Œåœ¨<a href="http://stackoverflow.com/questions/12058901/ios-system-symbol-symbolication-service" target="_blank" rel="external">stack overflow</a>ä¸Šè¯´èƒ½ç¬¦å·åŒ–æ‰€æœ‰ç‰ˆæœ¬çš„ç³»ç»Ÿåº“ï¼Œä½†æ˜¯æ˜¯æ”¶è´¹æœåŠ¡ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æµ‹è¯•ï¼‰</p>
<p>åœ¨å…¬å¸å°ç»„é‡Œï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯æˆ‘æ¥åˆ†æcrashæ—¥å¿—ï¼Œæ‰€ä»¥å½“é‡åˆ°ç¼ºå°‘ç³»ç»Ÿç¬¦å·æ–‡ä»¶çš„æƒ…å†µï¼Œå°±ä¼šååˆ†æ— å¥ˆã€‚å¾ˆå¤šæ—¶å€™ï¼Œæ²¡æœ‰ç¬¦å·åŒ–çš„crashæ—¥å¿—æ ¹æœ¬æ— æ³•æä¾›æœ‰ç”¨ä¿¡æ¯ã€‚</p>
<h2 id="ç³»ç»Ÿç¬¦å·æ–‡ä»¶ä¸‹è½½åœ°å€"><a href="#ç³»ç»Ÿç¬¦å·æ–‡ä»¶ä¸‹è½½åœ°å€" class="headerlink" title="ç³»ç»Ÿç¬¦å·æ–‡ä»¶ä¸‹è½½åœ°å€"></a>ç³»ç»Ÿç¬¦å·æ–‡ä»¶ä¸‹è½½åœ°å€</h2><h3 id="æš´åŠ›æ”¶é›†"><a href="#æš´åŠ›æ”¶é›†" class="headerlink" title="æš´åŠ›æ”¶é›†"></a>æš´åŠ›æ”¶é›†</h3><p>æ”¶é›†ä¸å…¨ä¸€ç›´è®©æˆ‘å¾ˆä¸çˆ½ã€‚ä¹‹å‰æœåˆ®äº†ç»„å†…çš„æµ‹è¯•æœºï¼Œåªæ”¶é›†åˆ°äº†æœ‰é™çš„å‡ ä¸ªï¼ˆæ„Ÿè°¢æ— ç§æä¾›iPhone 7è®©æˆ‘åˆ·æœºé™çº§çš„åŒäº‹ï¼‰ã€‚ç»ˆäºï¼Œè¿™å‘¨æœ«ç‰¹æ„è·‘å»äº†ä¸€è¶ŸäºŒæ‰‹æœºå¸‚åœºå¯»æ‰¾æ—§ç‰ˆæœ¬çš„è®¾å¤‡æ¥æ‹·è´ï¼Œæ€»ç®—æ˜¯æ”¶é›†å¾—å®Œæ•´äº†ä¸€ç‚¹ï¼Œä½†æ˜¯ä¹ŸèŠ±äº†æˆ‘121å—é’±ã€‚</p>
<p>å¿ƒæƒ…æ€»ç®—æ„‰æ‚¦äº†ã€‚</p>
<p>å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯æ‹·è´è‡ª<code>arm64</code>è®¾å¤‡çš„ï¼Œ<code>armv7</code>çš„ç¬¦å·æ–‡ä»¶æ”¶é›†æˆ‘æ˜¯æ”¾å¼ƒäº†ã€‚æœ‰å“ªä½å¤§ä¾ æœ‰å…´è¶£æŠŠè¿™ä¸ªæ¸¸æˆç©é€šå…³çš„å—ï¼Ÿè¿˜æœ‰ tvOS å’Œ watchOSçš„ç¬¦å·ï¼Œæˆ‘ä¹Ÿæ”¾å¼ƒäº†ã€‚<br>(update:åˆèŠ±äº†äº›æ—¶é—´ä»Xcodeçš„SDKå’Œå›ºä»¶é‡Œæå–äº†<code>armv7s</code>å’Œ<code>armv7</code>çš„å›ºä»¶ï¼Œç°åœ¨åªå‰©ä¸‹å‡ ä¸ª<code>arm64</code>çš„ç‰ˆæœ¬äº†)ã€‚</p>
<p>æ•´ç†äº†ä¸€ä¸‹ä¼ åˆ°äº†ç½‘ç›˜ï¼Œåœ°å€è§ä¸‹æ–¹ï¼Œæœ‰éœ€è¦çš„å»ä¸‹è½½å§ã€‚</p>
<h3 id="ç›®å‰è¿˜ç¼ºå°‘çš„ç¬¦å·æ–‡ä»¶"><a href="#ç›®å‰è¿˜ç¼ºå°‘çš„ç¬¦å·æ–‡ä»¶" class="headerlink" title="ç›®å‰è¿˜ç¼ºå°‘çš„ç¬¦å·æ–‡ä»¶"></a>ç›®å‰è¿˜ç¼ºå°‘çš„ç¬¦å·æ–‡ä»¶</h3><p>å¦‚æœæœ‰äººæœ‰è¿™å‡ ä¸ªç¬¦å·æ–‡ä»¶çš„ï¼Œæ³è¯·ä½ åˆ†äº«ï¼</p>
<p>åˆ†äº«å¯ä»¥ç›´æ¥è´´ä¸‹è½½åœ°å€ï¼Œä¹Ÿå¯ä»¥æäº¤åˆ°è¿™ä¸ªgithubé¡¹ç›®<a href="https://github.com/Zuikyo/iOS-System-Symbols" target="_blank" rel="external">iOS-System-Symbols</a>ã€‚å¦‚æœæˆ‘å¾—åˆ°äº†æ–°çš„ç¬¦å·æ–‡ä»¶ï¼Œä¹Ÿä¼šåœ¨è¿™ä¸ªé¡¹ç›®é‡Œæ›´æ–°ã€‚</p>
<table>
<thead>
<tr>
<th>ç¼ºå¤±ç¬¦å·çš„ç‰ˆæœ¬</th>
<th>ç¼ºå¤±çš„CPUç‰ˆæœ¬</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.0(14A346)</td>
<td>arm64</td>
<td>iPhone 7 å’Œ 7 Plusç‹¬å ï¼Œå‡ºå‚è‡ªå¸¦ç³»ç»Ÿ</td>
</tr>
<tr>
<td>9.3.2(13F72)</td>
<td>arm64</td>
<td>iPad Pro 9.7å¯¸ç‹¬å ï¼Œä¿®å¤äº†å˜ç –çš„é—®é¢˜</td>
</tr>
<tr>
<td>9.3(13E237)</td>
<td>arm64</td>
<td>5s, iPad Air å’Œ iPad mini2ç‹¬å ï¼Œä¿®å¤äº†ä¸èƒ½æ¿€æ´»çš„é—®é¢˜</td>
</tr>
<tr>
<td>9.3(13E234)</td>
<td>arm64</td>
<td>6s, 6s Plus å’Œ iPad Pro 9.7å¯¸ ç‹¬å </td>
</tr>
<tr>
<td>8.1.1 (12B435)</td>
<td>arm64</td>
<td>5s, iPad Air å’Œ iPad mini2 ç‹¬å </td>
</tr>
<tr>
<td>8.0.1(12A402)</td>
<td>arm64</td>
<td><code>8.0.1</code>æœ‰å¯¼è‡´å˜ç –çš„bugï¼Œå‘å¸ƒåå¾ˆå¿«å°±åœæ­¢æ¨é€äº†</td>
</tr>
<tr>
<td>7.1.2 (11D257)</td>
<td>arm64</td>
<td></td>
</tr>
<tr>
<td>7.0.2(11A501)</td>
<td>arm64</td>
<td></td>
</tr>
<tr>
<td>7.0.1(11A470a)</td>
<td>arm64</td>
<td>5s ç‹¬å </td>
</tr>
</tbody>
</table>
<p>æ³¨æ„ï¼Œarm64ï¼Œarmv7sï¼Œarmv7ç‰ˆæœ¬çš„æ–‡ä»¶éƒ½æ˜¯åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œçš„ï¼ˆä¾‹å¦‚<code>/Symbols/System/Library/Frameworks/UIKit.framework/UIKit</code>ï¼‰ï¼ŒXcodeåœ¨æ‹·è´armv7çš„ç¬¦å·æ–‡ä»¶æ—¶ï¼Œå¦‚æœ<code>iOS DeviceSupport</code>ç›®å½•é‡Œå·²ç»æœ‰<code>arm64</code>æˆ–<code>armv7s</code>çš„ç¬¦å·æ–‡ä»¶ï¼Œåˆ™ä¼šè‡ªåŠ¨è¿›è¡Œåˆå¹¶ã€‚å› æ­¤å¦‚æœä½ è¦åˆ†äº«ä¸€ä¸ª<code>armv7</code>ç‰ˆæœ¬çš„ç¬¦å·æ–‡ä»¶ï¼Œè¯·å…ˆæŠŠarm64ç­‰å…¶ä»–ç‰ˆæœ¬çš„æ‹·è´åˆ°<code>/Users/zhangweike/Library/Developer/Xcode/iOS DeviceSupport/</code>é‡Œï¼Œç„¶åå†ç”¨Xcodeè¿›è¡Œåˆå¹¶åå†å‹ç¼©åˆ†äº«ã€‚</p>
<h3 id="ç½‘ç›˜ä¸‹è½½åœ°å€"><a href="#ç½‘ç›˜ä¸‹è½½åœ°å€" class="headerlink" title="ç½‘ç›˜ä¸‹è½½åœ°å€"></a><a name="wang-pan"></a>ç½‘ç›˜ä¸‹è½½åœ°å€</h3><p><strong>ç½‘ç›˜é“¾æ¥: <a href="https://pan.baidu.com/s/1nvfi4g5" target="_blank" rel="external">https://pan.baidu.com/s/1nvfi4g5</a> å¯†ç : <code>79m8</code></strong></p>
<p>å¦‚æœæ˜¯åœ¨å›½å¤–ï¼Œå¯ä»¥ç”¨Google Driverï¼š<br><a href="https://drive.google.com/drive/folders/0B-0LZDbSzubRaUdMdTJQc1ZzMUU?usp=sharing" target="_blank" rel="external">google driveåˆ†äº«(7.0.3-9.2)</a><br>,<br><a href="https://drive.google.com/drive/folders/0B5oBYvBG2NS7aDVTR1JzX2JXaFE?usp=sharing" target="_blank" rel="external">google driveåˆ†äº«(9.2.1-10.2)</a></p>
<p>å¦‚æœæˆ‘å¾—åˆ°äº†æ–°çš„ç¬¦å·æ–‡ä»¶ï¼Œä¼šåœ¨è¿™ä¸ªé¡¹ç›®é‡Œæ›´æ–°ï¼š<a href="https://github.com/Zuikyo/iOS-System-Symbols" target="_blank" rel="external">iOS-System-Symbols</a>ã€‚</p>
<p>æˆ‘æŠŠé‡Œé¢çš„é‚£å‡ ä¸ª<code>dyld_shared_cache_xxxx</code>å¤§æ–‡ä»¶å•ç‹¬æ‹¿å‡ºæ¥äº†ï¼Œç›®çš„æ˜¯å‡å°å‹ç¼©åŒ…å¤§å°ã€‚å¦‚æœåªæ˜¯ç¬¦å·åŒ–çš„è¯ï¼Œç”¨ä¸åˆ°è¿™å‡ ä¸ªæ–‡ä»¶ï¼Œåªæ˜¯åœ¨çœŸæœºè°ƒè¯•çš„æ—¶å€™æ‰éœ€è¦ã€‚</p>
<h3 id="ç¬¦å·æ–‡ä»¶ç‰ˆæœ¬åˆ—è¡¨"><a href="#ç¬¦å·æ–‡ä»¶ç‰ˆæœ¬åˆ—è¡¨" class="headerlink" title="ç¬¦å·æ–‡ä»¶ç‰ˆæœ¬åˆ—è¡¨"></a>ç¬¦å·æ–‡ä»¶ç‰ˆæœ¬åˆ—è¡¨</h3><p>è¿™äº›æ˜¯æˆ‘å·²ç»æ”¶é›†åˆ°çš„ç¬¦å·æ–‡ä»¶ï¼ŒåŒ…æ‹¬äº†å¯¹åº”çš„CPUä¿¡æ¯ã€‚iOS10ç³»ç»Ÿå¼€å§‹ä¸æ”¯æŒ<code>armv7</code>çš„æœºå™¨ã€‚ä½†æ˜¯iOS9ä»¥ä¸‹è¿˜æ˜¯æ”¯æŒ<code>armv7</code>çš„ï¼Œè¿™é‡Œå¾ˆå¤šéƒ½ç¼ºå¤±äº†<code>armv7</code>ã€‚</p>
<p>æŸ¥çœ‹æ˜¯å¦å¸¦æœ‰å¯¹åº”CPUæ¶æ„çš„ç¬¦å·æ–‡ä»¶çš„æ–¹å¼ï¼šåˆ°<code>10.2 (14C92)/Symbols/System/Library/Caches/com.apple.dyld</code>è¿™æ ·çš„ç›®å½•ä¸‹ï¼Œä¼šæœ‰å¯¹åº”çš„<code>dyld_shared_cache_arm64</code>ï¼Œ<code>dyld_shared_cache_armv7s</code>ï¼Œ<code>dyld_shared_cache_armv7</code>æ–‡ä»¶ï¼Œå¦‚æœç¼ºå¤±äº†ï¼Œå°±è¯´æ˜å¯¹åº”çš„CPUæ¶æ„ç¬¦å·æ–‡ä»¶è¿˜ä¸å­˜åœ¨ã€‚ï¼ˆç»è¿‡è¯•éªŒï¼Œè¿™å‡ ä¸ªå¤§æ–‡ä»¶å¹¶ä¸å½±å“ç¬¦å·åŒ–ï¼Œåªæ˜¯åœ¨çœŸæœºè°ƒè¯•çš„æ—¶å€™æ‰æœ‰ç”¨ï¼Œå› æ­¤å¦‚æœå«Œå¤ªå ç”¨ç©ºé—´ï¼Œå¯ä»¥åˆ å»ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>å·²æ”¶é›†åˆ°çš„CPUç‰ˆæœ¬</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.2 (14C92)</td>
<td>arm64,armv7s</td>
<td></td>
</tr>
<tr>
<td>10.1.1 (14B150)</td>
<td>arm64,armv7s</td>
<td></td>
</tr>
<tr>
<td>10.1.1 (14B100)</td>
<td>arm64,armv7s</td>
<td></td>
</tr>
<tr>
<td>10.1 (14B72c)</td>
<td>arm64,armv7s</td>
<td></td>
</tr>
<tr>
<td>10.1 (14B72)</td>
<td>arm64,armv7s</td>
<td></td>
</tr>
<tr>
<td>10.0.3 (14A551)</td>
<td>arm64,armv7s</td>
<td></td>
</tr>
<tr>
<td>10.0.2 (14A456)</td>
<td>arm64,armv7s</td>
<td></td>
</tr>
<tr>
<td>10.0.1 (14A403)</td>
<td>arm64,armv7s</td>
<td></td>
</tr>
<tr>
<td><strong>10.0(14A346)</strong></td>
<td><strong>none</strong></td>
<td>iPhone 7 å’Œ 7 Plusç‹¬å ï¼Œå‡ºå‚è‡ªå¸¦ç³»ç»Ÿ</td>
</tr>
<tr>
<td>9.3.5 (13G36)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.3.4 (13G35)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.3.3 (13G34)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td><strong>9.3.2(13F72)</strong></td>
<td><strong>none</strong></td>
<td>iPad Pro 9.7å¯¸ç‹¬å ï¼Œä¿®å¤äº†å˜ç –çš„é—®é¢˜</td>
</tr>
<tr>
<td>9.3.2 (13F69)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.3.1 (13E238)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.3(13E237)</td>
<td>armv7s,armv7</td>
<td>5så’Œæ›´æ—§æœºå‹ç‹¬å ï¼Œä¿®å¤äº†ä¸èƒ½æ¿€æ´»çš„é—®é¢˜</td>
</tr>
<tr>
<td>9.3(13E236)</td>
<td>armv7</td>
<td>iPad2ç‹¬å ï¼Œä¿®å¤äº†ä¸èƒ½æ¿€æ´»çš„é—®é¢˜</td>
</tr>
<tr>
<td><strong>9.3(13E234)</strong></td>
<td><strong>none</strong></td>
<td>6s, 6s Plus and iPad Pro 9.7å¯¸ç‹¬å </td>
</tr>
<tr>
<td>9.3 (13E233)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.2.1 (13D20)</td>
<td>arm64,armv7s</td>
<td>iPhone 6 å’Œæ›´æ–°çš„æœºå‹ç‹¬å </td>
</tr>
<tr>
<td>9.2.1 (13D15)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.2 (13C75)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.1 (13B143)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.0.2(13A452)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.0.1(13A404)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>9.0 (13A344)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>8.4.1 (12H321)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>8.4 (12H143)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>8.3 (12F70)</td>
<td>arm64,armv7s,armv7</td>
<td>iPhoneç‹¬å </td>
</tr>
<tr>
<td>8.3 (12F69)</td>
<td>arm64,armv7s,armv7</td>
<td>iPadç‹¬å </td>
</tr>
<tr>
<td>8.2 (12D508)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>8.1.3 (12B466)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>8.1.2 (12B440)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>8.1.1 (12B436)</td>
<td>arm64,armv7s</td>
<td>iPhone 6 å’Œæ›´æ–°çš„æœºå‹ç‹¬å </td>
</tr>
<tr>
<td>8.1.1 (12B435)</td>
<td>armv7s,armv7</td>
<td>5så’Œæ›´æ—§æœºå‹ç‹¬å </td>
</tr>
<tr>
<td>8.1 (12B411)</td>
<td>arm64,armv7s,armv7</td>
<td>iPhoneç‹¬å </td>
</tr>
<tr>
<td>8.1 (12B410)</td>
<td>arm64,armv7s,armv7</td>
<td>iPadç‹¬å </td>
</tr>
<tr>
<td>8.0.2 (12A405)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>8.0.1(12A402)</td>
<td>armv7s,armv7</td>
<td><code>8.0.1</code>æœ‰å¯¼è‡´å˜ç –çš„bugï¼Œå‘å¸ƒåå¾ˆå¿«å°±åœæ­¢æ¨é€äº†</td>
</tr>
<tr>
<td>8.0 (12A366)</td>
<td>arm64,armv7s</td>
<td>6 Plusç‹¬å </td>
</tr>
<tr>
<td>8.0 (12A365)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>7.1.2 (11D257)</td>
<td>armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>7.1.1 (11D201)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>7.1 (11D167)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>7.0.6 (11B651)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>7.0.4 (11B554a)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>7.0.3 (11B511)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>7.0.2(11A501)</td>
<td>armv7s,armv7</td>
<td></td>
</tr>
<tr>
<td>7.0.1(11A470a)</td>
<td>armv7s</td>
<td>5s å’Œ 5c ç‹¬å </td>
</tr>
<tr>
<td>7.0(11A465)</td>
<td>arm64,armv7s,armv7</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="æœºå‹å¯¹åº”CPUæ¶æ„"><a href="#æœºå‹å¯¹åº”CPUæ¶æ„" class="headerlink" title="æœºå‹å¯¹åº”CPUæ¶æ„"></a>æœºå‹å¯¹åº”CPUæ¶æ„</h3><table>
<thead>
<tr>
<th>CPU</th>
<th>æœºå‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>armv6</td>
<td>iPhone, iPhone2, iPhone3G, iPod Touch 1 and 2</td>
</tr>
<tr>
<td>armv7</td>
<td>iPhone3GS, iPhone4, iPhone4Sï¼ŒiPad, iPad2, iPad3(The New iPad), iPad miniï¼ŒiPod Touch 3G, iPod Touch4, iPod Touch5</td>
</tr>
<tr>
<td>armv7s</td>
<td>iPhone5, iPhone5C, iPad4(iPad with Retina Display)</td>
</tr>
<tr>
<td>arm64</td>
<td>iPhone5S, iPad Air, iPad mini2(iPad mini with Retina Display), iPhone6, iPhone6s, iPhone7, iPhone7s and any new device in the future</td>
</tr>
</tbody>
</table>
<h2 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h2><p>æœ€åå†æ¬¡å‘¼åä¸€ä¸‹ï¼Œå¦‚æœè°æœ‰ä¸Šé¢ç¼ºå¤±çš„ç¬¦å·æ–‡ä»¶ï¼Œå°±è¯·å…±äº«ä¸€ä¸‹å§ã€‚è™½ç„¶åªæ˜¯åšä¸€ç‚¹å¾®å°çš„å·¥ä½œï¼Œä½†æ˜¯èƒ½å¤Ÿæœ‰å¾ˆå¤§å¸®åŠ©ã€‚</p>
<p>ä¸è§‰å¾—å¡«æ»¡ä¸Šé¢é‚£ä¸ªåˆ—è¡¨ä¼šå¾ˆçˆ½å—ï¼Ÿ</p>
<h3 id="é¢å¤–æç¤º"><a href="#é¢å¤–æç¤º" class="headerlink" title="é¢å¤–æç¤º"></a>é¢å¤–æç¤º</h3><p>å…¶å®è¿™äº›ç¬¦å·æ–‡ä»¶å°±æ˜¯çœŸæœºä¸Šçš„ç³»ç»Ÿåº“ï¼ŒåŒ…æ‹¬äº†å®Œæ•´çš„ç³»ç»Ÿåº“äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æœ‰æ—¶å€™è¦åç¼–è¯‘æŸäº›ç³»ç»Ÿframeworkï¼Œä½†æ˜¯æ¨¡æ‹Ÿå™¨SDKé‡Œæ²¡æœ‰å¯¹åº”çš„frameworkï¼ˆæ¯”å¦‚åªæœ‰çœŸæœºä¸Šæ‰æœ‰çš„<code>CoreMotion.framework</code>ï¼‰ï¼Œå°±å¯ä»¥åœ¨è¿™äº›çœŸæœºä¸Šçš„ç³»ç»Ÿåº“é‡Œæ‰¾åˆ°äº†ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://www.jianshu.com/p/11710e7ab661" target="_blank" rel="external">http://www.jianshu.com/p/11710e7ab661</a></li>
<li><a href="http://wufawei.com/2014/03/symbolicating-ios-crash-logs/" target="_blank" rel="external">ç¬¦å·åŒ–iOS Crashæ–‡ä»¶çš„3ç§æ–¹æ³•</a></li>
<li><a href="https://en.wikipedia.org/wiki/IOS_SDK" target="_blank" rel="external">iOS SDK</a></li>
<li><a href="https://en.wikipedia.org/wiki/IOS_version_history#iOS_10" target="_blank" rel="external">iOS version history</a></li>
<li><a href="https://forums.developer.apple.com/thread/3380" target="_blank" rel="external">No symbols for paired Apple Watch</a></li>
<li><a href="http://crash.163.com/#news/!newsId=31" target="_blank" rel="external">èŠèŠä»iOSå›ºä»¶æå–ç³»ç»Ÿåº“ç¬¦å·</a></li>
<li><a href="http://stackoverflow.com/questions/14941773/xcode-software-image-for-user-ios-in-order-to-symbolicate-ios-calls" target="_blank" rel="external">Xcode software image for user iOS in order to symbolicate iOS calls</a></li>
<li><a href="http://stackoverflow.com/a/28408052/6380485" target="_blank" rel="external">Missing iOS symbols at â€œ~/Library/Developer/Xcode/iOS DeviceSupportâ€</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/13/çº¦æŸå†²çªè°ƒè¯•å·¥å…·/" itemprop="url">
                  çº¦æŸå†²çªè°ƒè¯•å·¥å…·ï¼šè§£å†³iOS7è°ƒè¯•éš¾é¢˜
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2016-12-13T21:43:29+08:00" content="2016-12-13">
              2016-12-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/è°ƒè¯•æŠ€å·§/" itemprop="url" rel="index">
                    <span itemprop="name">è°ƒè¯•æŠ€å·§</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/13/çº¦æŸå†²çªè°ƒè¯•å·¥å…·/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/12/13/çº¦æŸå†²çªè°ƒè¯•å·¥å…·/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>åŠŸèƒ½</em>ï¼š</p>
<ul>
<li>åœ¨éè°ƒè¯•æ¨¡å¼ä¸‹ï¼Œè·å–å‡ºé”™çš„å…·ä½“çº¦æŸã€‚</li>
<li>ç›‘æµ‹çº¦æŸå†²çªï¼Œå¹¶è·å–å‡ºé”™çš„viewå’ŒviewControllerã€‚</li>
<li>ç›‘æµ‹iOS7ä¸ŠlayoutSubViewså¯¼è‡´çš„crashé—®é¢˜</li>
</ul>
<h2 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h2><h3 id="iOS7å¯¹Auto-Layoutçš„æ”¯æŒé—®é¢˜"><a href="#iOS7å¯¹Auto-Layoutçš„æ”¯æŒé—®é¢˜" class="headerlink" title="iOS7å¯¹Auto Layoutçš„æ”¯æŒé—®é¢˜"></a>iOS7å¯¹Auto Layoutçš„æ”¯æŒé—®é¢˜</h3><ul>
<li>iOS7çš„çº¦æŸæœ‰ä¸€äº›å¥‡æ€ªçš„bugï¼Œå¯¹Auto Layoutæ”¯æŒå¹¶ä¸å®Œç¾ã€‚</li>
<li>åœ¨å‡ºç°çº¦æŸå†²çªæ—¶ï¼Œç³»ç»Ÿä¼šå°è¯•ä¿®å¤çº¦æŸã€‚iOS7å’ŒiOS8çš„ä¿®å¤ç»“æœæœ‰å¯èƒ½ä¸ä¸€æ ·ã€‚</li>
<li>å¦‚æœviewçš„<code>layoutSubviews</code>é‡Œæ²¡æœ‰è°ƒç”¨<code>[super layoutSubviews]</code>ï¼Œé‚£ä¹ˆåœ¨å¾€è¿™ä¸ªviewä¸Šæ·»åŠ å­viewæ—¶ï¼Œåœ¨iOS7ä»¥ä¸‹ä¼šcrashã€‚ä¾‹å¦‚<code>UITableView</code>ï¼Œ<code>UITableViewCell</code>ã€‚</li>
</ul>
<h3 id="iOS7çš„è°ƒè¯•é—®é¢˜"><a href="#iOS7çš„è°ƒè¯•é—®é¢˜" class="headerlink" title="iOS7çš„è°ƒè¯•é—®é¢˜"></a>iOS7çš„è°ƒè¯•é—®é¢˜</h3><ul>
<li>Xcode7è™½ç„¶ä¸èƒ½ä½¿ç”¨iOS7æ¨¡æ‹Ÿå™¨è°ƒè¯•ï¼Œä½†æ˜¯è¿˜èƒ½ä½¿ç”¨iOS7çœŸæœºè°ƒè¯•ã€‚è€ŒXcode8å·²ç»è¿iOS7çš„çœŸæœºè°ƒè¯•éƒ½ä¸æ”¯æŒäº†ã€‚</li>
<li>Xcode8ä¸­ç¼–è¾‘è¿‡çš„xibæ–‡ä»¶åœ¨Xcode7ä¸Šä¼šæœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤xibä¸­çš„<code>&lt;capability name=&quot;documents saved in the Xcode 8 format&quot; minToolsVersion=&quot;8.0&quot;/&gt;</code>è¿™ä¸€è¡Œæ‰èƒ½åœ¨Xcode7ä¸Šç¼–è¯‘ã€‚å¦‚æœè¦ç»§ç»­ä½¿ç”¨Xcode7è°ƒè¯•ï¼Œå°±éœ€è¦ä¿®æ”¹è¿™äº›xibï¼Œååˆ†éº»çƒ¦ã€‚</li>
<li>å†…ç½‘å¼€å‘æ—¶ï¼Œæ— æ³•è¿›è¡ŒçœŸæœºè°ƒè¯•ï¼Œå¦‚æœè¦ç”¨æ¨¡æ‹Ÿå™¨è°ƒè¯•ï¼Œéœ€è¦å¦ä¸€å°ä½ç‰ˆæœ¬çš„Mac OSXç³»ç»Ÿçš„æœºå­ä»¥å®‰è£…Xcode6ï¼ŒåŒæ—¶ä¹Ÿä¼šé‡åˆ°Xcodeçš„å…¼å®¹æ€§é—®é¢˜ï¼Œå› æ­¤é‡åˆ°iOS7çš„çº¦æŸé—®é¢˜ååˆ†éº»çƒ¦ï¼Œå¦‚æœæ²¡æœ‰ç¯å¢ƒçš„è¯åªèƒ½é çŒœã€‚</li>
<li>çº¦æŸå†²çªå¯¼è‡´çš„crashå¾€å¾€åœ¨å †æ ˆä¸Šæ— æ³•å¾—åˆ°æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå› ä¸ºæ˜¯åœ¨ç³»ç»Ÿåº“é‡Œcrashï¼Œæ— æ³•ç›´æ¥çœ‹å‡ºæ˜¯å“ªä¸ªç•Œé¢çš„çº¦æŸå‡ºé”™ã€‚å¦‚æœæ˜¯åœ¨Xcodeé‡Œè°ƒè¯•ï¼Œè¿˜èƒ½ä½¿ç”¨llvmçš„å†…å­˜å‘½ä»¤è¿›è¡Œè°ƒè¯•ï¼Œä½†æ˜¯åœ¨çœŸæœºä¸Šå°±æ²¡åŠæ³•äº†ã€‚</li>
</ul>
<h2 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h2><p>å¦‚æœappèƒ½ç”¨ä»£ç ç›‘æµ‹åˆ°çº¦æŸå†²çªï¼Œå°±å¯ä»¥åœ¨éè°ƒè¯•æ¨¡å¼ä¸‹æ•è·åˆ°æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜ã€‚<br>å½“å‘ç”Ÿçº¦æŸå†²çªæ—¶ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºè¿™æ ·çš„æç¤º:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">**Unable to simultaneously satisfy constraints.**</div><div class="line">    Probably at least one of the constraints in the following list is one you don&apos;t want. Try this: (1) look at each constraint and try to figure out which you don&apos;t expect; (2) find the code that added the unwanted constraint or constraints and fix it. (Note: If you&apos;re seeing NSAutoresizingMaskLayoutConstraints that you don&apos;t understand, refer to the documentation for the UIView property translatesAutoresizingMaskIntoConstraints)</div><div class="line">(</div><div class="line">    &quot;&lt;NSLayoutConstraint:0x7fc82d3e18a0 H:[UIView:0x7fc82aba1210(768)]&gt;&quot;,</div><div class="line">    &quot;&lt;NSLayoutConstraint:0x7fc82d6369e0 H:[UIView:0x7fc82aba1210]-(0)-|   (Names: &apos;|&apos;:UIView:0x7fc82d6b9f80 )&gt;&quot;,</div><div class="line">    &quot;&lt;NSLayoutConstraint:0x7fc82d636a30 H:|-(0)-[UIView:0x7fc82aba1210]   (Names: &apos;|&apos;:UIView:0x7fc82d6b9f80 )&gt;&quot;,</div><div class="line">    &quot;&lt;NSLayoutConstraint:0x7fc82d3e7fd0 &apos;UIView-Encapsulated-Layout-Width&apos; H:[UIView:0x7fc82d6b9f80(50)]&gt;&quot;</div><div class="line">)</div><div class="line"></div><div class="line">Will attempt to recover by breaking constraint</div><div class="line">&lt;NSLayoutConstraint:0x7fc82d3e18a0 H:[UIView:0x7fc82aba1210(768)]&gt;</div><div class="line"></div><div class="line">Make a symbolic breakpoint at UIViewAlertForUnsatisfiableConstraints to catch this in the debugger.</div><div class="line">The methods in the UIConstraintBasedLayoutDebugging category on UIView listed in &lt;UIKit/UIView.h&gt; may also be helpful.</div></pre></td></tr></table></figure>
<p>æç¤ºæˆ‘ä»¬åœ¨<code>UIViewAlertForUnsatisfiableConstraints</code>ä¸Šæ‰“æ–­ç‚¹è°ƒè¯•ã€‚<br>è¿™æ˜¯ä¸€ä¸ªæ£€æµ‹åˆ°å‡ºé”™çº¦æŸæ—¶ï¼Œè¿›è¡Œå¤„ç†çš„Cå‡½æ•°ã€‚ä¸Šé¢é‚£ä¸²æ§åˆ¶å°çš„logå°±æ˜¯åœ¨è¿™ä¸ªå‡½æ•°é‡Œè¾“å‡ºçš„ã€‚</p>
<p>äºæ˜¯å¯ä»¥å°è¯•ç”¨method swizzlingæ›¿æ¢ç³»ç»Ÿåº“çš„æ–¹æ³•ï¼Œè®°å½•å‡ºç°å†²çªæ—¶çš„ä¿¡æ¯ã€‚<br>ç›‘æµ‹iOS7çš„crashé—®é¢˜ä¹Ÿæ˜¯åŒç†ã€‚</p>
<h2 id="å®ç°æ–¹æ³•"><a href="#å®ç°æ–¹æ³•" class="headerlink" title="å®ç°æ–¹æ³•"></a>å®ç°æ–¹æ³•</h2><h3 id="è·å–UIView"><a href="#è·å–UIView" class="headerlink" title="è·å–UIView"></a>è·å–UIView</h3><p>runtimeæ— æ³•æ›¿æ¢ç§æœ‰Cå‡½æ•°ï¼Œè€Œè°ƒç”¨æ ˆé‡Œ<code>NSISEngine</code>çš„é‚£å‡ ä¸ªæ–¹æ³•éƒ½æ²¡é™„å¸¦ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Œäºæ˜¯ç”¨hopperåç¼–è¯‘<code>UIKit.framework</code>ï¼Œæ‰¾åˆ°ä½¿ç”¨<code>UIViewAlertForUnsatisfiableConstraints</code>çš„åœ°æ–¹ï¼Œæ˜¯<code>-[UIView engine:willBreakConstraint:dueToMutuallyExclusiveConstraints:]</code>ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•é™„å¸¦äº†å‡ºé”™çº¦æŸçš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥è·å–åˆ°å†²çªæ‰€åœ¨çš„UIViewï¼Œäºæ˜¯ä¹Ÿèƒ½é€šè¿‡UIViewè·å–å¯¹åº”çš„viewControllerã€‚æ¥ä¸‹æ¥åªè¦hookè¿™ä¸ªæ–¹æ³•å°±å¯ä»¥äº†ã€‚</p>
<h3 id="è·å–view-controller"><a href="#è·å–view-controller" class="headerlink" title="è·å–view controller"></a>è·å–view controller</h3><p>è·å–viewå¯¹åº”çš„view controllerçš„æ–¹æ³•æœ‰ä¸¤ç§ã€‚</p>
<ul>
<li>ä½¿ç”¨<code>UIView</code>çš„ç§æœ‰API:<code>_viewDelegate</code>ã€‚</li>
<li>ä½¿ç”¨<code>UIResponder</code>çš„<code>nextResponder</code>ï¼š</li>
</ul>
<p>&gt;<br>The UIResponder class does not store or set the next responder automatically, instead returning nil by default. Subclasses must override this method to set the next responder. <strong>UIView implements this method by returning the UIViewController object that manages it (if it has one) or its superview (if it doesnâ€™t)</strong>; UIViewController implements the method by returning its viewâ€™s superview; UIWindow returns the application object, and UIApplication returns nil.<br>&gt;</p>
<p>å‚è€ƒ:<a href="http://stackoverflow.com/questions/1372977/given-a-view-how-do-i-get-its-viewcontroller" target="_blank" rel="external">Given a view, how do I get its viewController?</a></p>
<p>æˆ‘é€‰æ‹©äº†ç¬¬äºŒç§æ–¹å¼ã€‚</p>
<h3 id="ç›‘æµ‹iOS7çº¦æŸå¯¼è‡´çš„crash"><a href="#ç›‘æµ‹iOS7çº¦æŸå¯¼è‡´çš„crash" class="headerlink" title="ç›‘æµ‹iOS7çº¦æŸå¯¼è‡´çš„crash"></a>ç›‘æµ‹iOS7çº¦æŸå¯¼è‡´çš„crash</h3><p>å½“ä½ åœ¨å®ç°è‡ªå®šä¹‰viewçš„<code>layoutSubviews</code>æ–¹æ³•æ—¶ï¼Œè®°ä½ï¼š</p>
<ul>
<li>è°ƒç”¨<code>[super layoutSubviews]</code></li>
<li>ä¸è¦åœ¨<code>layoutSubviews</code>é‡Œå¢åŠ çº¦æŸ</li>
</ul>
<p>å¦‚æœä¸éµå®ˆè¿™ä¸¤æ¡ï¼Œå½“ä½ å‘è¿™ä¸ªviewä¸Šå¢åŠ å­viewæ—¶ï¼Œåœ¨iOS6å’ŒiOS7ä¸Šä¼šcrashï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºæç¤ºï¼š<code>&#39;Auto Layout still required after executing - layoutSubviews..&#39;</code> ã€‚iOS8å¼€å§‹åˆ™ä¸ä¼šcrashã€‚</p>
<p>æŸäº›ç³»ç»Ÿæ§ä»¶ï¼Œä¾‹å¦‚<code>UITableView</code>ï¼Œ<code>UITableViewCell</code>æ²¡æœ‰è°ƒç”¨<code>[super layoutSubviews]</code>ï¼Œæ‰€ä»¥åœ¨iOS6å’ŒiOS7ä¸Šä¸èƒ½åœ¨å®ƒä»¬ä¸Šé¢å¢åŠ å­viewï¼Œé™¤éä½ ç”¨method swizllingä¿®å¤å®ƒä»¬çš„<code>layoutSubviews</code>æ–¹æ³•ã€‚</p>
<p>ç»è¿‡åç¼–è¯‘åˆ†æï¼Œ<code>&#39;Auto Layout still required after executing - layoutSubviews..&#39;</code>å‘ç”Ÿåœ¨<code>UIView</code>çš„<code>layoutSublayersOfLayer:</code>é‡Œï¼Œå‘ç”Ÿé”™è¯¯ä¹‹å‰ä¼šç”¨<code>-[UIView _wantsWarningForMissingSuperLayoutSubviews]</code>æ¥ç›‘æµ‹æ˜¯å¦è°ƒç”¨äº†<code>[super layoutSubviews]</code>ï¼Œå¦‚æœæ²¡æœ‰åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚<br>å› æ­¤åªéœ€è¦hook<code>_wantsWarningForMissingSuperLayoutSubviews</code>å°±å¯ä»¥äº†ã€‚</p>
<h2 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h2><p>è®¾ç½®ç›‘å¬æ–¹å¼å¦‚ä¸‹ï¼Œè¿”å›çº¦æŸå†²çªæ‰€åœ¨çš„viewï¼ŒviewControllerï¼Œç³»ç»Ÿå°è¯•æ‰“ç ´çš„çº¦æŸï¼Œç›®å‰æ‰€æœ‰çš„çº¦æŸã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[ZIKConstraintsGuard monitorUnsatisfiableConstraintWithHandler:^(UIView *view, UIViewController *viewController, NSLayoutConstraint *constraintToBreak, NSArray&lt;NSLayoutConstraint *&gt; *currentConstraints) &#123;</div><div class="line">    NSLog(@&quot;æ£€æµ‹åˆ°çº¦æŸå†²çªï¼&quot;);</div><div class="line">    NSString *className = NSStringFromClass([viewController class]);</div><div class="line">    if ([className hasPrefix:@&quot;UI&quot;] &amp;&amp; ![className isEqualToString:@&quot;UIApplication&quot;]) &#123;</div><div class="line">    	  //ä½¿ç”¨æŸäº›ç³»ç»Ÿæ§ä»¶æ—¶ä¼šå‡ºç°çº¦æŸå†²çªï¼Œä¾‹å¦‚UIAlertController</div><div class="line">        NSLog(@&quot;ignore conflict in UIKit:%@&quot;,viewController);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    NSLog(@&quot;å†²çªæ‰€åœ¨çš„viewController:\n%@ \nview:\n%@&quot;,viewController,view);</div><div class="line">    //ä½¿ç”¨recursiveDescriptionæ¥æ‰“å°viewçš„å±‚çº§ï¼Œæ³¨æ„è¿™æ˜¯private API</div><div class="line">    NSLog(@&quot;view hierarchy:\n%@&quot;,[view valueForKeyPath:@&quot;recursiveDescription&quot;]);</div><div class="line">    NSLog(@&quot;ç›®å‰æ‰€æœ‰çš„çº¦æŸ:\n%@&quot;,currentConstraints);</div><div class="line">    NSLog(@&quot;ç³»ç»Ÿå°è¯•æ‰“ç ´çš„çº¦æŸ:\n%@&quot;,constraintToBreak);</div><div class="line">    </div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">æ£€æµ‹åˆ°çº¦æŸå†²çªï¼</div><div class="line"></div><div class="line">å†²çªæ‰€åœ¨çš„viewController:</div><div class="line">&lt;MyViewController: 0x100201ba0&gt; </div><div class="line">view:</div><div class="line">&lt;UIView: 0x10020cbb0; frame = (0 0; 375 667); autoresize = W+H; gestureRecognizers = &lt;NSArray: 0x170242b50&gt;; layer = &lt;UIWindowLayer: 0x17002b240&gt;&gt;</div><div class="line"></div><div class="line">view hierarchy:</div><div class="line"></div><div class="line">&lt;UIView: 0x10020cbb0; frame = (0 0; 375 667); autoresize = W+H; gestureRecognizers = &lt;NSArray: 0x170242b50&gt;; layer = &lt;UIWindowLayer: 0x17002b240&gt;&gt;</div><div class="line">   | &lt;UIView: 0x10020fd00; frame = (0 0; 375 667); autoresize = W+H; layer = &lt;CALayer: 0x17002b780&gt;&gt;</div><div class="line">   |    | &lt;_UILayoutGuide: 0x1002100a0; frame = (0 0; 0 0); hidden = YES; layer = &lt;CALayer: 0x17002b820&gt;&gt;</div><div class="line">   |    | &lt;_UILayoutGuide: 0x100210650; frame = (0 0; 0 0); hidden = YES; layer = &lt;CALayer: 0x17002b8e0&gt;&gt;</div><div class="line">   |    | &lt;UITableView: 0x10081cc00; frame = (100 100; 100 100); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x170243e70&gt;; layer = &lt;CALayer: 0x17002bf20&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;0, 0&#125;&gt;</div><div class="line">   |    |    | &lt;UITableViewWrapperView: 0x10080fe00; frame = (0 0; 100 100); gestureRecognizers = &lt;NSArray: 0x1702441a0&gt;; layer = &lt;CALayer: 0x17002bf80&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;100, 100&#125;&gt;</div><div class="line"></div><div class="line">ç›®å‰æ‰€æœ‰çš„çº¦æŸ:</div><div class="line">(</div><div class="line">    &quot;&lt;NSLayoutConstraint:0x17008a500 UITableView:0x10081cc00.top == UITableView:0x10081cc00.top + 10   (active)&gt;&quot;</div><div class="line">)</div><div class="line"></div><div class="line">ç³»ç»Ÿå°è¯•æ‰“ç ´çš„çº¦æŸ:</div><div class="line">&lt;NSLayoutConstraint:0x17008a500 UITableView:0x10081cc00.top == UITableView:0x10081cc00.top + 10   (active)&gt;</div></pre></td></tr></table></figure>
<p>è¿™æ ·å°±èƒ½æ ¹æ®è®°å½•åˆ°çš„å†…å­˜åœ°å€ï¼Œå‡†ç¡®åœ°æ‰¾åˆ°æ˜¯å“ªä¸ªç•Œé¢çš„å“ªä¸ªæ§ä»¶çš„çº¦æŸå‡ºé”™äº†ï¼Œå³ä¾¿åœ¨iOS7ä¸Šcrashï¼Œä¹Ÿèƒ½åœ¨crashä¹‹å‰è®°å½•åˆ°é”™è¯¯ä¿¡æ¯ã€‚</p>
<h2 id="éœ€è¦æ³¨æ„çš„é—®é¢˜"><a href="#éœ€è¦æ³¨æ„çš„é—®é¢˜" class="headerlink" title="éœ€è¦æ³¨æ„çš„é—®é¢˜"></a>éœ€è¦æ³¨æ„çš„é—®é¢˜</h2><ul>
<li>æŸäº›ç³»ç»Ÿæ§ä»¶æœ¬èº«å­˜åœ¨çº¦æŸå†²çªçš„é—®é¢˜ï¼Œä¾‹å¦‚åœ¨ä½¿ç”¨<code>UIAlertController</code>çš„æ—¶å€™ã€‚ç›®å‰æ˜¯åœ¨æ£€æµ‹åˆ°å†²çªæ—¶ï¼Œå†æ£€æµ‹viewControllerçš„ç±»å‹å‰ç¼€ï¼Œå¦‚æœæ˜¯<code>UI</code>å‰ç¼€åˆ™å¿½ç•¥ã€‚</li>
<li>åŒä¸€ä¸ªçº¦æŸå†²çªæœ‰æ—¶å€™ä¼šæœ‰å¤šæ¬¡å›è°ƒã€‚è¿™äº›å›è°ƒæ¥è‡ªå¤„ç†auto layoutçš„ä¸åŒé˜¶æ®µï¼Œä¾‹å¦‚æ·»åŠ é‡å¤çº¦æŸæ—¶ã€<code>addSubview</code>æ—¶ï¼Œ<code>layoutSubLayer</code>æ—¶ç­‰ã€‚</li>
</ul>
<h2 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="æºä»£ç "></a>æºä»£ç </h2><p>å·¥å…·åœ°å€åœ¨æ­¤ï¼š<a href="https://github.com/Zuikyo/ZIKConstraintsGuard" target="_blank" rel="external">ZIKConstraintsGuard</a>ã€‚</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/interfaceçš„è§„èŒƒå†™æ³•/" itemprop="url">
                  @inerfaceçš„11æ¡è§„èŒƒå†™æ³•
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2016-12-07T08:55:29+08:00" content="2016-12-07">
              2016-12-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ä»£ç è§„èŒƒ/" itemprop="url" rel="index">
                    <span itemprop="name">ä»£ç è§„èŒƒ</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/07/interfaceçš„è§„èŒƒå†™æ³•/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/12/07/interfaceçš„è§„èŒƒå†™æ³•/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ€»ç»“ä¸€äº›interfaceå£°æ˜æ—¶çš„è§„èŒƒï¼Œç›¸å…³å®çš„ä»‹ç»ï¼Œå®šä¹‰æ–¹æ³•æ—¶æœ‰ç”¨çš„ä¿®é¥°ç¬¦ï¼Œç¼–å†™æ³¨é‡Šçš„è§„èŒƒï¼Œæœ€ç»ˆå†™å‡ºä¸€ä¸ªåˆæ ¼çš„å¤´æ–‡ä»¶ã€‚</p>
<ul>
<li><a href="#readwrite">1.è¯»å†™æƒé™</a><ul>
<li><a href="#readwrite-1">1.1å®ä¾‹å˜é‡çš„@public,@protected,@privateå…³é”®å­—</a></li>
<li><a href="#readwrite-2">1.2å±æ€§çš„readonly,readwriteå…³é”®å­—</a></li>
</ul>
</li>
<li><a href="#forward-declaration">2.å‰å‘å£°æ˜</a></li>
<li><a href="#private">3.åªæš´éœ²å¿…è¦çš„æ¥å£å’Œå®ç°</a><ul>
<li><a href="#private-1">3.1ä¸è¦æš´éœ²ä»»ä½•åªåœ¨ç±»å†…éƒ¨ä½¿ç”¨çš„ç§æœ‰æ–¹æ³•</a></li>
<li><a href="#private-2">3.2ä¸è¦åœ¨å¤´æ–‡ä»¶é‡Œå£°æ˜ç±»å†…éƒ¨éµå¾ªçš„protocol</a></li>
</ul>
</li>
<li><a href="#nullability">4.nullabilityè¯´æ˜</a></li>
<li><a href="#enum">5.å®šä¹‰æšä¸¾</a><ul>
<li><a href="#enum-1">5.1 NS_ENUM</a></li>
<li><a href="#enum-2">5.2 NS_OPTIONS</a></li>
<li><a href="#enum-3">5.3 å­—ç¬¦ä¸²æšä¸¾</a></li>
</ul>
</li>
<li><a href="#extern">6.ä½¿ç”¨externå‘å¤–éƒ¨æä¾›åªè¯»å¸¸é‡</a></li>
<li><a href="#protected">7.å‘å­ç±»å’Œcategoryæä¾›çˆ¶ç±»çš„ç§æœ‰å±æ€§</a></li>
<li><a href="#designated-initializer">8.æ ‡æ˜designated initializer</a></li>
<li><a href="#version-control">9.APIç‰ˆæœ¬æ§åˆ¶</a><ul>
<li><a href="#version-control-1">9.1 available</a></li>
<li><a href="#version-control-2">9.2 unavailable</a></li>
<li><a href="#version-control-3">9.3 deprecated</a></li>
</ul>
</li>
<li><a href="#keywords">10.é¢å¤–çš„ä¿®é¥°ç¬¦</a><ul>
<li><a href="#keywords-1">10.1æ³›å‹</a></li>
<li><a href="#keywords-2">10.2 NS_REQUIRES_SUPER</a></li>
<li><a href="#keywords-3">10.3 NS_NOESCAPE</a></li>
</ul>
</li>
<li><a href="#comment">11.å†™æ³¨é‡Š</a><ul>
<li><a href="#comment-1">11.1å•è¡Œæ³¨é‡Š</a></li>
<li><a href="#comment-2">11.2å¤šè¡Œæ³¨é‡Š</a></li>
<li><a href="#comment-3">11.3æšä¸¾æ³¨é‡Š</a></li>
<li><a href="#comment-4">11.4å‡ ä¸ªæ³¨é‡Šçº¦å®š</a></li>
</ul>
</li>
</ul>
<hr>
<h2 id="1-è¯»å†™æƒé™"><a href="#1-è¯»å†™æƒé™" class="headerlink" title="1.è¯»å†™æƒé™"></a><a name="readwrite"></a>1.è¯»å†™æƒé™</h2><p>.hæ–‡ä»¶é‡Œçš„å£°æ˜æ˜¯ç”¨äºæš´éœ²ç»™å¤–éƒ¨çš„æ¥å£ï¼Œè€Œç±»å†…éƒ¨çš„ç§æœ‰æ–¹æ³•ã€ç§æœ‰å±æ€§å’Œå®ä¾‹å˜é‡ï¼Œåº”è¯¥æ”¾åˆ°.mæ–‡ä»¶çš„interface extensioné‡Œã€‚</p>
<h3 id="1-1-å®ä¾‹å˜é‡çš„-public-protected-privateå…³é”®å­—"><a href="#1-1-å®ä¾‹å˜é‡çš„-public-protected-privateå…³é”®å­—" class="headerlink" title="1.1 å®ä¾‹å˜é‡çš„@public,@protected,@privateå…³é”®å­—"></a><a name="readwrite-1"></a>1.1 å®ä¾‹å˜é‡çš„@public,@protected,@privateå…³é”®å­—</h3><p>è¿™3ä¸ªå…³é”®å­—ç”¨äºä¿®é¥°å®ä¾‹å˜é‡ï¼Œä¸èƒ½ç”¨äºä¿®é¥°å±æ€§ã€‚å½“é”™è¯¯åœ°ä½¿ç”¨äº†å®ä¾‹å˜é‡æ—¶ï¼ŒXcodeä¼šæŠ¥é”™æç¤ºã€‚</p>
<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>@private</td>
<td>ä½œç”¨èŒƒå›´åªèƒ½åœ¨è‡ªèº«ç±»</td>
</tr>
<tr>
<td>@protected</td>
<td>ä½œç”¨èŒƒå›´åœ¨è‡ªèº«ç±»å’Œç»§æ‰¿è‡ªå·±çš„å­ç±»ï¼Œä»€ä¹ˆéƒ½ä¸å†™ï¼Œé»˜è®¤æ˜¯æ­¤å±æ€§ã€‚</td>
</tr>
<tr>
<td>@public</td>
<td>ä½œç”¨èŒƒå›´æœ€å¤§ï¼Œåœ¨ä»»ä½•åœ°æ–¹ã€‚</td>
</tr>
</tbody>
</table>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//SearchManager.h</div><div class="line">@interface SearchManager : NSObject &#123;</div><div class="line">    @public    NSInteger *state;</div><div class="line">    @public    NSInteger *timeout;</div><div class="line">    @protected id *searchAPI;</div><div class="line">    @private   id _privateIvar;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ç”±äºä¼šæš´éœ²ç§æœ‰å˜é‡ï¼Œå¹¶ä¸”æ²¡æœ‰@propertyçš„ä¸€äº›é«˜çº§å…³é”®å­—ï¼Œå¾ˆå°‘åœ¨å¤´æ–‡ä»¶é‡Œå£°æ˜å®ä¾‹å˜é‡ã€‚ä¼˜å…ˆä½¿ç”¨@propertyã€‚</p>
<h3 id="1-2-å±æ€§çš„readonly-readwriteå…³é”®å­—"><a href="#1-2-å±æ€§çš„readonly-readwriteå…³é”®å­—" class="headerlink" title="1.2 å±æ€§çš„readonly,readwriteå…³é”®å­—"></a><a name="readwrite-2"></a>1.2 å±æ€§çš„readonly,readwriteå…³é”®å­—</h3><p>å¤´æ–‡ä»¶ä¸­çš„å±æ€§æ˜¯ç”¨äºæè¿°è¿™ä¸ªå¯¹è±¡çš„ä¸€ç³»åˆ—ç‰¹æ€§é›†åˆã€‚<br>å£°æ˜@propertyæ—¶ï¼Œåœ¨.hé‡Œä½¿ç”¨readonlyï¼Œè®©å¤–éƒ¨åªæœ‰è¯»çš„æƒé™ï¼Œåœ¨.mé‡Œä½¿ç”¨readwriteï¼Œä½¿å†…éƒ¨æ‹¥æœ‰è¯»å†™æƒé™ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//SearchManager.h</div><div class="line">@interface SearchManager : NSObject</div><div class="line">@property (nonatomic, readonly) NSInteger * state;</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//SearchManager.m</div><div class="line">@interface SearchManager : NSObject</div><div class="line">@property (nonatomic, readwrite) NSInteger * state;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h2 id="2-å‰å‘å£°æ˜"><a href="#2-å‰å‘å£°æ˜" class="headerlink" title="2.å‰å‘å£°æ˜"></a><a name="forward-declaration"></a>2.å‰å‘å£°æ˜</h2><p>å½“åœ¨@interfaceçš„æ¥å£é‡Œç”¨åˆ°äº†å…¶ä»–ç±»ï¼Œä¸è¦åœ¨.hé‡Œç›´æ¥å¯¼å…¥ç±»çš„å¤´æ–‡ä»¶ï¼Œè¿™æ ·ä¼šè®©ä½¿ç”¨æ­¤å¤´æ–‡ä»¶çš„åœ°æ–¹ä¹Ÿå¯¼å…¥è¿™äº›ä¸å¿…è¦çš„å…¶ä»–å¤´æ–‡ä»¶ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨å…³é”®å­—<code>@class</code>è¿›è¡Œå‰å‘å£°æ˜ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜¯ç»§æ‰¿äº†çˆ¶ç±»ï¼Œè¿˜æ˜¯éœ€è¦importçˆ¶ç±»çš„å¤´æ–‡ä»¶ã€‚<br>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//SearchManager.h</div><div class="line">#import &quot;SearchManagerBase.h&quot;//å¯¼å…¥çˆ¶ç±»çš„å¤´æ–‡ä»¶</div><div class="line"></div><div class="line">@class LocationModel;//å‰å‘å£°æ˜LocationModelç±»</div><div class="line"></div><div class="line">typedef void(^LocationSearchCompletionHandler)(LocationModel *location, NSError *error);</div><div class="line">@interface LocationSearchManager : SearchManagerBase</div><div class="line">- (void)searchLocationWithKeyword:(NSString *)keyword completionHandler:(LocationSearchCompletionHandler)completionHandler;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨@classä¼šå‘Šè¯‰ç¼–è¯‘å™¨æœ‰è¿™ä¹ˆä¸€ä¸ªç±»å­˜åœ¨ï¼Œä½†æ˜¯ç°åœ¨å¹¶ä¸å…³å¿ƒè¿™ä¸ªç±»çš„å…·ä½“å®ç°ï¼Œç­‰åˆ°è°ƒç”¨è€…åœ¨.mé‡Œä½¿ç”¨çš„æ—¶å€™å†importè¿™ä¸ªç±»å³å¯ã€‚ä½¿ç”¨@classå’Œ@protocolåˆ†åˆ«å£°æ˜ä¸€ä¸ªç±»å’Œä¸€ä¸ªprotocolã€‚<br>ä½¿ç”¨å‰å‘å¼•ç”¨çš„åŸå› æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>æå‡ç¼–è¯‘æ•ˆç‡ã€‚<br>å¦‚æœimportäº†<code>LocationModel.h</code>ï¼Œé‚£ä¹ˆå½“<code>LocationModel.h</code>çš„å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰importäº†<code>LocationModel.h</code>çš„åœ°æ–¹éƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€‚å¦‚æœ.må¼•ç”¨äº†<code>SearchManager.h</code>ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä½¿ç”¨<code>LocationModel</code>ï¼Œå°±ä¼šå¢åŠ ä¸å¿…è¦çš„ç¼–è¯‘ï¼Œé™ä½å¼€å‘æ•ˆç‡ã€‚</li>
<li>è§£å†³äº¤å‰å¼•ç”¨çš„é—®é¢˜ã€‚<br>å¦‚æœç±»Açš„å¤´æ–‡ä»¶importäº†Bï¼Œç±»Bçš„å¤´æ–‡ä»¶importäº†Aï¼Œè¿™æ ·åœ¨ç¼–è¯‘æ—¶ä¼šæŠ¥é”™ï¼šâ€œcan not find interface declarationâ€ï¼Œè¿™æ˜¯å› ä¸ºObjective-Cä¸å…è®¸äº¤å‰å¼•ç”¨ã€‚</li>
</ul>
<h2 id="3-åªæš´éœ²å¿…è¦çš„æ¥å£å’Œå®ç°"><a href="#3-åªæš´éœ²å¿…è¦çš„æ¥å£å’Œå®ç°" class="headerlink" title="3.åªæš´éœ²å¿…è¦çš„æ¥å£å’Œå®ç°"></a><a name="private"></a>3.åªæš´éœ²å¿…è¦çš„æ¥å£å’Œå®ç°</h2><h3 id="3-1ä¸è¦æš´éœ²ä»»ä½•åªåœ¨ç±»å†…éƒ¨ä½¿ç”¨çš„ç§æœ‰æ–¹æ³•"><a href="#3-1ä¸è¦æš´éœ²ä»»ä½•åªåœ¨ç±»å†…éƒ¨ä½¿ç”¨çš„ç§æœ‰æ–¹æ³•" class="headerlink" title="3.1ä¸è¦æš´éœ²ä»»ä½•åªåœ¨ç±»å†…éƒ¨ä½¿ç”¨çš„ç§æœ‰æ–¹æ³•"></a><a name="private-1"></a>3.1ä¸è¦æš´éœ²ä»»ä½•åªåœ¨ç±»å†…éƒ¨ä½¿ç”¨çš„ç§æœ‰æ–¹æ³•</h3><p>å¤´æ–‡ä»¶é‡Œåªå£°æ˜é‚£äº›ç»™å¤–éƒ¨ä½¿ç”¨çš„å…¬å¼€æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨è®¾è®¡æ—¶éœ€è¦è€ƒè™‘åˆ°å¯æµ‹è¯•æ€§ï¼Œéµå¾ªå•ä¸€èŒè´£ã€‚<br>ç§æœ‰æ–¹æ³•åªå®šä¹‰åœ¨ç±»å†…éƒ¨ï¼Œå¹¶ä¸”ä¸ºäº†è¿›è¡ŒåŒºåˆ«ï¼Œå»ºè®®åœ¨ç§æœ‰æ–¹æ³•å‰åŠ ä¸Šå‰ç¼€ï¼Œä¾‹å¦‚<code>- (void)p_myPrivateMethod</code>ã€‚<br>ç”±äºAppleåœ¨å®ƒçš„ç¼–ç è§„èŒƒé‡Œå£°æ˜äº†ï¼ŒAppleå…¬å¸æ‹¥æœ‰ä¸‹åˆ’çº¿çš„æ–¹æ³•å‰ç¼€ï¼Œå°±åƒå®ƒæ‹¥æœ‰<code>NS</code>,<code>UI</code>è¿™äº›ç±»åå‰ç¼€ä¸€æ ·ï¼Œå› æ­¤ä¸å»ºè®®æˆ‘ä»¬çš„ç§æœ‰æ–¹æ³•ç›´æ¥ä½¿ç”¨ä¸‹åˆ’çº¿ä½œä¸ºå‰ç¼€ã€‚å¦åˆ™ï¼Œå½“ä½ åœ¨ç»§æ‰¿Cocoa Touchçš„ç±»æ—¶ï¼Œæœ‰å¯èƒ½ä¼šè¦†ç›–çˆ¶ç±»çš„ç§æœ‰æ–¹æ³•ï¼Œé€ æˆéš¾ä»¥è°ƒè¯•çš„é”™è¯¯ã€‚</p>
<h3 id="3-2ä¸è¦åœ¨å¤´æ–‡ä»¶é‡Œå£°æ˜ç±»å†…éƒ¨éµå¾ªçš„protocol"><a href="#3-2ä¸è¦åœ¨å¤´æ–‡ä»¶é‡Œå£°æ˜ç±»å†…éƒ¨éµå¾ªçš„protocol" class="headerlink" title="3.2ä¸è¦åœ¨å¤´æ–‡ä»¶é‡Œå£°æ˜ç±»å†…éƒ¨éµå¾ªçš„protocol"></a><a name="private-2"></a>3.2ä¸è¦åœ¨å¤´æ–‡ä»¶é‡Œå£°æ˜ç±»å†…éƒ¨éµå¾ªçš„protocol</h3><p><strong>é”™è¯¯</strong>çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//SearchManager.h</div><div class="line">@interface SearchManager : NSObject&lt;NSCoding, UITableViewDelegate&gt;</div><div class="line">@property (nonatomic, readonly) NSInteger * state;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p><code>UITableViewDelegate</code>æ˜¯ç±»å†…éƒ¨ä½¿ç”¨æ—¶éµå¾ªçš„protocolï¼Œæ²¡æœ‰å¿…è¦æš´éœ²ç»™å¤–éƒ¨ï¼Œå› æ­¤åº”è¯¥æ”¾åˆ°.mæ–‡ä»¶é‡Œã€‚<br>è€Œ<code>NSCoding</code>åˆ™æè¿°äº†ç±»çš„ç‰¹æ€§ï¼Œç”¨äºå‘Šè¯‰å¤–éƒ¨æœ¬ç±»å¯ä»¥ä½¿ç”¨å½’æ¡£ï¼Œå› æ­¤åº”è¯¥æ”¾åœ¨å¤´æ–‡ä»¶é‡Œã€‚</p>
<h2 id="4-nullabilityè¯´æ˜"><a href="#4-nullabilityè¯´æ˜" class="headerlink" title="4.nullabilityè¯´æ˜"></a><a name="nullability"></a>4.nullabilityè¯´æ˜</h2><p>åœ¨å£°æ˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—å…³é”®å­—æè¿°å¯¹è±¡æ˜¯å¦å¯ä»¥ä¸ºnilã€‚</p>
<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>nullable</td>
<td>å¯ç©ºï¼Œç”¨äºæè¿°objcå¯¹è±¡</td>
</tr>
<tr>
<td>nonnull</td>
<td>ä¸å¯ç©ºï¼Œç”¨äºæè¿°objcå¯¹è±¡</td>
</tr>
<tr>
<td>null_unspecified</td>
<td>ä¸ç¡®å®šï¼Œç”¨äºæè¿°objcå¯¹è±¡</td>
</tr>
<tr>
<td>null_resettable</td>
<td>setå¯ç©ºï¼Œgetä¸ä¸ºç©ºã€‚ä»…ç”¨äºproperty</td>
</tr>
<tr>
<td>_Nullable</td>
<td>å¯ç©ºï¼Œç”¨äºæè¿°CæŒ‡é’ˆå’Œblock</td>
</tr>
<tr>
<td>_Nonnull</td>
<td>ä¸å¯ç©ºï¼Œç”¨äºæè¿°CæŒ‡é’ˆå’Œblock</td>
</tr>
<tr>
<td>_Null_unspecified</td>
<td>ä¸ç¡®å®šï¼Œç”¨äºæè¿°CæŒ‡é’ˆå’Œblock</td>
</tr>
</tbody>
</table>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//SearchManager.h</div><div class="line">#import &quot;SearchManagerBase.h&quot;</div><div class="line">@class LocationModel;</div><div class="line"></div><div class="line">typedef void(^LocationSearchCompletionHandler)(LocationModel *_Nullable location, NSError *_Nullable error);</div><div class="line">@interface LocationSearchManager : SearchManagerBase</div><div class="line">- (void)searchLocationWithKeyword:(nonnull NSString *)keyword completionHandler:(LocationSearchCompletionHandler _Nonnull)completionHandler;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>å¦‚æœå‘ä¸€ä¸ªä½¿ç”¨nonnullä¿®é¥°çš„å€¼èµ‹ç©ºï¼Œç¼–è¯‘å™¨ä¼šç»™å‡ºè­¦å‘Šã€‚<br>åœ¨å¼€å‘æ—¶ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ä½¿ç”¨çš„éƒ½æ˜¯nonnullï¼Œå› æ­¤Appleæä¾›äº†ä¸€å¯¹å®<code>NS_ASSUME_NONNULL_BEGIN</code>å’Œ<code>NS_ASSUME_NONNULL_END</code>æ¥è¿›è¡Œå¿«é€Ÿä¿®é¥°ï¼Œå†™åœ¨ä¸¤ä¸ªå®ä¹‹é—´çš„å±æ€§ã€æ–¹æ³•ï¼Œå‡ä¼šä½¿ç”¨<code>nonnull</code>ä¿®é¥°ã€‚<br>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//LocationSearchManager.h</div><div class="line"></div><div class="line">#import &quot;SearchManagerBase.h&quot;</div><div class="line">@class LocationModel;</div><div class="line"></div><div class="line">NS_ASSUME_NONNULL_BEGIN</div><div class="line">typedef void(^LocationSearchCompletionHandler)(LocationModel *_Nullable location, NSError *_Nullable error);</div><div class="line">@interface LocationSearchManager : SearchManagerBase</div><div class="line">- (void)searchLocationWithKeyword:(NSString *)keyword completionHandler:(LocationSearchCompletionHandler)completionHandler;</div><div class="line">@end</div><div class="line">NS_ASSUME_NONNULL_END</div></pre></td></tr></table></figure>
<h2 id="5-å®šä¹‰æšä¸¾"><a href="#5-å®šä¹‰æšä¸¾" class="headerlink" title="5.å®šä¹‰æšä¸¾"></a><a name="enum"></a>5.å®šä¹‰æšä¸¾</h2><p>å…³äºNS_ENUMå’ŒNS_OPTIONSçš„åŒºåˆ«ï¼Œå‚è€ƒ<a href="http://nshipster.cn/ns_enum-ns_options/" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚<br>ç®€å•æ¥è¯´ï¼ŒNS_OPTIONSæä¾›äº†æŒ‰ä½æ©ç çš„åŠŸèƒ½ã€‚</p>
<h3 id="5-1-NS-ENUM"><a href="#5-1-NS-ENUM" class="headerlink" title="5.1 NS_ENUM"></a><a name="enum-1"></a>5.1 NS_ENUM</h3><p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger,SearchState) &#123;</div><div class="line">    SearchStateNotSearch,</div><div class="line">    SearchStateSearching,</div><div class="line">    SearchStateSearchFinished,</div><div class="line">    SearchStateSearchFailed</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="5-2-NS-OPTIONS"><a href="#5-2-NS-OPTIONS" class="headerlink" title="5.2 NS_OPTIONS"></a><a name="enum-2"></a>5.2 NS_OPTIONS</h3><p>ç¤ºä¾‹ä»£ç ï¼Œå‚è€ƒ<code>NSKeyValueObserving.h</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">typedef NS_OPTIONS(NSUInteger, NSKeyValueObservingOptions) &#123;</div><div class="line">    NSKeyValueObservingOptionNew,</div><div class="line">    NSKeyValueObservingOptionOld,</div><div class="line">    NSKeyValueObservingOptionInitial,</div><div class="line">    NSKeyValueObservingOptionPrior</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨æ—¶å°±å¯ä»¥ç”¨<code>|</code>ç»„åˆå¤šä¸ªoptionï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[_webView addObserver:self forKeyPath:@&quot;title&quot; options:NSKeyValueObservingOptionInitial | NSKeyValueObservingOptionNew context:NULL];</div></pre></td></tr></table></figure></p>
<h3 id="5-3-å­—ç¬¦ä¸²æšä¸¾"><a href="#5-3-å­—ç¬¦ä¸²æšä¸¾" class="headerlink" title="5.3 å­—ç¬¦ä¸²æšä¸¾"></a><a name="enum-3"></a>5.3 å­—ç¬¦ä¸²æšä¸¾</h3><p>å½“ä½¿ç”¨å­—å…¸ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œæˆ–è€…ä½œä¸ºè¿”å›å€¼æ—¶ï¼Œå¾€å¾€éš¾ä»¥ç›´æ¥æä¾›å­—å…¸çš„keyï¼Œç°åœ¨ä½¿ç”¨å­—ç¬¦ä¸²æšä¸¾å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>ç¤ºä¾‹ä»£ç ï¼Œå‚è€ƒ<code>NSKeyValueObserving.h</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//ä½¿ç”¨NS_STRING_ENUMå®ï¼Œå®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»å‹</div><div class="line">typedef NSString * NSKeyValueChangeKey NS_STRING_ENUM;</div><div class="line"></div><div class="line">FOUNDATION_EXPORT NSKeyValueChangeKey const NSKeyValueChangeKindKey;</div><div class="line">FOUNDATION_EXPORT NSKeyValueChangeKey const NSKeyValueChangeNewKey;</div><div class="line">FOUNDATION_EXPORT NSKeyValueChangeKey const NSKeyValueChangeOldKey;</div><div class="line">FOUNDATION_EXPORT NSKeyValueChangeKey const NSKeyValueChangeIndexesKey;</div><div class="line">FOUNDATION_EXPORT NSKeyValueChangeKey const NSKeyValueChangeNotificationIsPriorKey;</div><div class="line"></div><div class="line">//ä½¿ç”¨æ³›å‹ï¼Œå£°æ˜äº†changeå‚æ•°ç”¨åˆ°çš„keyï¼Œæ˜¯åœ¨NSKeyValueChangeKeyçš„æšä¸¾èŒƒå›´ä¸­</div><div class="line">- (void)observeValueForKeyPath:(nullable NSString *)keyPath ofObject:(nullable id)object change:(nullable NSDictionary&lt;NSKeyValueChangeKey, id&gt; *)change context:(nullable void *)context;</div></pre></td></tr></table></figure>
<h2 id="6-ä½¿ç”¨externå‘å¤–éƒ¨æä¾›åªè¯»å¸¸é‡"><a href="#6-ä½¿ç”¨externå‘å¤–éƒ¨æä¾›åªè¯»å¸¸é‡" class="headerlink" title="6.ä½¿ç”¨externå‘å¤–éƒ¨æä¾›åªè¯»å¸¸é‡"></a><a name="extern"></a>6.ä½¿ç”¨externå‘å¤–éƒ¨æä¾›åªè¯»å¸¸é‡</h2><p>è¿™ä¸å…³@interfaceçš„äº‹ï¼Œä½†æ˜¯å’Œå¤´æ–‡ä»¶æœ‰å…³ï¼Œå°±æ”¾åœ¨ä¸€èµ·è¯´æ˜äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//SearchManager.h</div><div class="line">extern NSString *const SearchErrorDomain;</div><div class="line">extern NSInteger SearchDefaultTimeout;</div><div class="line"></div><div class="line">@interface SearchManager : NSObject</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//SearchManager.m</div><div class="line">NSString *const SearchErrorDomain = @&quot;SearchErrorDomain&quot;;</div><div class="line">const NSInteger SearchDefaultTimeout = 20;</div><div class="line"></div><div class="line">@interface SearchManager()</div><div class="line">@end</div></pre></td></tr></table></figure>
<h2 id="7-å‘å­ç±»å’Œcategoryæä¾›çˆ¶ç±»çš„ç§æœ‰å±æ€§"><a href="#7-å‘å­ç±»å’Œcategoryæä¾›çˆ¶ç±»çš„ç§æœ‰å±æ€§" class="headerlink" title="7.å‘å­ç±»å’Œcategoryæä¾›çˆ¶ç±»çš„ç§æœ‰å±æ€§"></a><a name="protected"></a>7.å‘å­ç±»å’Œcategoryæä¾›çˆ¶ç±»çš„ç§æœ‰å±æ€§</h2><p>ç”±äºç±»çš„å¤´æ–‡ä»¶åªå­˜æ”¾é‚£äº›æš´éœ²ç»™å¤–éƒ¨çš„å±æ€§å’Œæ–¹æ³•ï¼Œåœ¨é‡åˆ°è¿™äº›æƒ…å†µæ—¶ï¼Œä¼šé‡åˆ°éšœç¢ï¼š</p>
<ul>
<li>åœ¨å­ç±»é‡Œæˆ–è€…categoryé‡Œï¼Œæƒ³è¦ä½¿ç”¨çˆ¶ç±»å®šä¹‰åœ¨.mé‡Œçš„ç§æœ‰å±æ€§ã€‚</li>
<li>åœ¨ç±»çš„å¤´æ–‡ä»¶é‡Œå±æ€§æ˜¯readonlyï¼Œä½†æ˜¯åœ¨å­ç±»æˆ–è€…categoryé‡Œï¼Œéœ€è¦readwriteæƒé™ã€‚<br>ç”±äºè¿™äº›å±æ€§å¹¶æ²¡æœ‰æš´éœ²åœ¨å¤´æ–‡ä»¶é‡Œï¼Œå› æ­¤éœ€è¦å¦å¤–å»ºç«‹ä¸€ä¸ªç§æœ‰å¤´æ–‡ä»¶ï¼Œç”¨æ¥å­˜æ”¾è¿™äº›éœ€è¦æš´éœ²ç»™å­ç±»å’Œcategoryçš„å±æ€§ã€‚<br>å¯ä»¥å‚è€ƒAppleå®˜æ–¹çš„<code>UIGestureRecognizerSubclass.h</code>ã€‚<br>ç¤ºä¾‹ä»£ç ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//SearchManager.h</div><div class="line">@interface SearchManager : NSObject</div><div class="line">///å¤–éƒ¨è®¿é—®ï¼Œåªæœ‰è¯»æƒé™</div><div class="line">@property (nonatomic, readonly) SearchState *state;</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//SearchManager.m</div><div class="line">@interface SearchManager()</div><div class="line">///å†…éƒ¨ä½¿ç”¨ï¼Œæœ‰è¯»å†™æƒé™</div><div class="line">@property (nonatomic, assign) SearchState *state;</div><div class="line">///åªåœ¨å†…éƒ¨ä½¿ç”¨çš„ç§æœ‰å±æ€§</div><div class="line">@property (nonatomic, strong) id searchAPI;</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">///æš´éœ²ç»™å­ç±»å’Œcategoryçš„ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•</div><div class="line">//SearchManagerInternal.h</div><div class="line">///é™åˆ¶ä½¿ç”¨æ­¤å¤´æ–‡ä»¶ï¼Œé˜²æ­¢è¢«åˆ«çš„ç±»è¯¯ç”¨</div><div class="line">#ifdef SEARCHMANAGER_PROTECTED_ACCESS</div><div class="line"></div><div class="line">#import &quot;SearchManager.h&quot;</div><div class="line">@interface SearchManager()</div><div class="line">///åœ¨internal.hé‡Œï¼Œé‡æ–°å£°æ˜ä¸ºreadwriteæƒé™</div><div class="line">@property (nonatomic, readwrite, assgin) SearchState *state;</div><div class="line">///æš´éœ²ç§æœ‰å±æ€§</div><div class="line">@property (nonatomic, strong) id searchAPI;</div><div class="line">///æš´éœ²ç§æœ‰æ–¹æ³•</div><div class="line">- (void)p_privateMethod;</div><div class="line">@end</div><div class="line"></div><div class="line">#else</div><div class="line">#error Only be included by SearchManager&apos;s subclass or category!</div><div class="line">#endif</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">///categoryçš„å®ç°æ–‡ä»¶</div><div class="line">//SearchManager+Category.m</div><div class="line">///å£°æ˜ç§æœ‰å¤´æ–‡ä»¶çš„ä½¿ç”¨æƒé™</div><div class="line">#define SEARCHMANAGER_PROTECTED_ACCESS</div><div class="line">///å¯¼å…¥ç§æœ‰å¤´æ–‡ä»¶</div><div class="line">#import &quot;SearchManagerInternal.h&quot;</div><div class="line"></div><div class="line">@implementation SearchManager(Category)</div><div class="line">- (void)categoryMethod &#123;</div><div class="line">    //æ‹¥æœ‰äº†è¯»å†™æƒé™</div><div class="line">    self.state = SearchStateSearching;</div><div class="line">    //å¯ä»¥è®¿é—®ç§æœ‰å±æ€§</div><div class="line">    [self.searchAPI startSearch];</div><div class="line">    //å¯ä»¥ä½¿ç”¨ç§æœ‰æ–¹æ³•</div><div class="line">    [self p_privateMethod];</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p><code>SearchManagerInternal.h</code>å…¶å®ä¹Ÿæ˜¯å…¬å¼€çš„ï¼Œå…¶ä»–ç±»ä¹Ÿèƒ½å¤Ÿå¯¼å…¥å¹¶ä½¿ç”¨ï¼Œåªèƒ½åœ¨å¼€å‘æ—¶è¿›è¡Œçº¦å®šã€‚å¦‚æœæƒ³è¦é™åˆ¶å…¶ä»–ç±»å¯¼å…¥ï¼Œå¹¶ä¸”æç¤ºé”™è¯¯ï¼Œ<code>Internal.h</code>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#ifdef MYCLASS_PROTECTED_ACCESS</div><div class="line">//å£°æ˜éƒ¨åˆ†</div><div class="line">#else</div><div class="line">#error Only be included by MYCLASS&apos;s subclass or category!</div><div class="line">#endif</div></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨åˆ«çš„ç±»å†…æ„å¤–åœ°å¯¼å…¥äº†<code>Internal.h</code>æ—¶å°±ä¼šäº§ç”Ÿç¼–è¯‘è­¦å‘Šï¼Œå¹¶ä¸”æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚ç¼ºç‚¹æ˜¯éœ€è¦åœ¨æ‰€æœ‰ä½¿ç”¨åˆ°<code>Internal.h</code>çš„åœ°æ–¹éƒ½<code>#define MYCLASS_PROTECTED_ACCESS</code>ã€‚</p>
<h2 id="8-æ ‡æ˜designated-initializer"><a href="#8-æ ‡æ˜designated-initializer" class="headerlink" title="8.æ ‡æ˜designated initializer"></a><a name="designated-initializer"></a>8.æ ‡æ˜designated initializer</h2><p>æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œå³æ¥æ”¶å‚æ•°æœ€å¤šçš„é‚£ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œå…¶ä»–åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨å®ƒå³å¯ï¼Œè¿™æ ·è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ‰€æœ‰åˆå§‹åŒ–æ–¹æ³•éƒ½æ­£ç¡®åœ°åˆå§‹åŒ–å®ä¾‹å˜é‡ã€‚<br>åœ¨æ–¹æ³•åé¢åŠ ä¸Š<code>NS_DESIGNATED_INITIALIZER</code>å®å³å¯ã€‚è¿™æ ·ï¼Œå½“ä½ å­ç±»åŒ–è¿™ä¸ªç±»æ—¶ï¼Œåœ¨å­ç±»çš„åˆå§‹åŒ–æ–¹æ³•é‡Œå¦‚æœæ²¡æœ‰æ­£ç¡®åœ°è°ƒç”¨çˆ¶ç±»çš„designated initializerï¼Œç¼–è¯‘å™¨å°±ä¼šç»™å‡ºè­¦å‘Šã€‚<br>å®ä¾‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@interface WKWebView : UIView</div><div class="line">- (instancetype)initWithFrame:(CGRect)frame configuration:(WKWebViewConfiguration *)configuration NS_DESIGNATED_INITIALIZER;</div><div class="line">- (nullable instancetype)initWithCoder:(NSCoder *)coder NS_DESIGNATED_INITIALIZER;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>å…³äºdesignated initializeræ›´è¯¦ç»†çš„è¯´æ˜ï¼Œå‚è€ƒ:</p>
<ul>
<li><a href="https://github.com/100mango/zen/blob/master/Objective-C%20æ‹¾é—ï¼šdesignated%20initializer/Objective-C%20æ‹¾é—ï¼šdesignated%20initializer.md" target="_blank" rel="external">Objective-C æ‹¾é—ï¼šdesignated initializer</a></li>
<li><a href="http://www.starfelix.com/blog/2014/04/13/zheng-que-bian-xie-designated-initializerde-ji-ge-yuan-ze/" target="_blank" rel="external">æ­£ç¡®ç¼–å†™Designated Initializerçš„å‡ ä¸ªåŸåˆ™</a></li>
</ul>
<h2 id="9-APIç‰ˆæœ¬æ§åˆ¶"><a href="#9-APIç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="9.APIç‰ˆæœ¬æ§åˆ¶"></a><a name="version-control"></a>9.APIç‰ˆæœ¬æ§åˆ¶</h2><p>åœ¨æ›´æ–°æ¥å£ï¼Œæˆ–è€…å¼€å‘frameworkæ—¶ï¼Œéœ€è¦æ ‡æ˜ç‰ˆæœ¬ä¿¡æ¯ï¼Œå‘Šè¯‰ä½¿ç”¨è€…æ­¤æ¥å£çš„å¹³å°é™åˆ¶ã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€æ˜¯å¦å¯ç”¨ã€æ˜¯å¦å·²å¼ƒç”¨ç­‰ã€‚<br>è‹¹æœç»™å‡ºäº†å‡ ä¸ªè‡ªå¸¦çš„å®ç”¨äºæ ‡æ˜ç‰ˆæœ¬ï¼ŒXcodeåœ¨æ£€æµ‹åˆ°é”™è¯¯ä½¿ç”¨æ—¶ä¼šç»™å‡ºè­¦å‘Šã€‚åªéœ€è¦åœ¨æ–¹æ³•ååé¢åŠ ä¸Šå¯¹åº”çš„å®å³å¯ã€‚</p>
<h3 id="9-1-available"><a href="#9-1-available" class="headerlink" title="9.1 available"></a><a name="version-control-1"></a>9.1 available</h3><p>å£°æ˜æœ¬æ¥å£æœ€ä½æ”¯æŒçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€‚<br>å½“ä½ çš„æ¥å£ä½¿ç”¨äº†æ–°ç³»ç»Ÿçš„APIï¼Œä¾‹å¦‚iOS8ä»¥ä¸Šæ‰æœ‰çš„UIAlertControllerï¼Œä½†æ˜¯é¡¹ç›®çš„deployment targetå´æ˜¯iOS7æ—¶ï¼Œéœ€è¦æ ‡æ˜æ­¤æ¥å£çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œè®©ä½¿ç”¨è€…è¿›è¡Œå…¼å®¹ã€‚<br>ç¤ºä¾‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//SearchManager.h</div><div class="line"></div><div class="line">typedef NS_ENUM(NSInteger,SearchState) &#123;</div><div class="line">    SearchStateNotSearch,</div><div class="line">    SearchStateSearching,</div><div class="line">    SearchStateSearchFinished,</div><div class="line">    SearchStateSearchFailed</div><div class="line">&#125; NS_ENUM_AVAILABLE_IOS(2_0);//æ­¤æšä¸¾åœ¨iOS2.0ä»¥ä¸Šæ‰èƒ½ä½¿ç”¨</div><div class="line"></div><div class="line">NS_CLASS_AVAILABLE_IOS(2_0) //æ­¤ç±»åœ¨iOS2.0ä»¥ä¸Šæ‰èƒ½ä½¿ç”¨</div><div class="line">@interface SearchManager : NSObject</div><div class="line">- (void)reSearch NS_AVAILABLE_IOS(5_0);//æ­¤æ–¹æ³•åœ¨iOS5.0ä»¥ä¸Šæ‰èƒ½ä½¿ç”¨</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>è¿™å‡ ä¸ªå®æœ‰å¯¹åº”å¹³å°çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚NS_AVAILABLE_MAC, NS_AVAILABLE_IOS, NS_AVAILABLE_IPHONEã€‚<br>iOS10å¼€å§‹æä¾›äº†æ–°çš„availableå®<code>API_AVAILABLE</code>ï¼Œç”¨æ¥ç»Ÿä¸€macOSã€iOSã€watchOSã€tvOSå‡ ä¸ªå¹³å°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">API_AVAILABLE(macos(10.10))</div><div class="line">API_AVAILABLE(macos(10.9), ios(10.0))</div><div class="line">API_AVAILABLE(macos(10.4), ios(8.0), watchos(2.0), tvos(10.0))</div></pre></td></tr></table></figure>
<h3 id="9-2-unavailable"><a href="#9-2-unavailable" class="headerlink" title="9.2 unavailable"></a><a name="version-control-2"></a>9.2 unavailable</h3><p>å£°æ˜æ­¤æ¥å£ä¸å¯ç”¨ï¼Œå¤§å¤šæ•°æ—¶å€™æ˜¯ç”¨äºå£°æ˜æ‰€åœ¨å¹³å°é™åˆ¶ã€‚<br>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@interface SearchManager : NSObject</div><div class="line">- (void)searchInWatch NS_UNAVAILABLE;//ä¸èƒ½ç”¨æ­¤æ¥å£</div><div class="line">- (void)searchInHostApp NS_EXTENSION_UNAVAILABLE_IOS;//extensioné‡Œä¸èƒ½ç”¨æ­¤æ¥å£</div><div class="line">- (void)search __TVOS_PROHIBITED;//tvOSé‡Œä¸èƒ½ç”¨æ­¤æ¥å£ï¼Œå¯ä¿®é¥°æšä¸¾ï¼Œç±»ï¼Œæ–¹æ³•ï¼Œå‚æ•°</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>iOS10å¼€å§‹æä¾›äº†æ–°çš„unavailableå®<code>API_UNAVAILABLE</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">API_UNAVAILABLE(macos)</div><div class="line">API_UNAVAILABLE(watchos, tvos)</div></pre></td></tr></table></figure>
<h3 id="9-3-deprecated"><a href="#9-3-deprecated" class="headerlink" title="9.3 deprecated"></a><a name="version-control-3"></a>9.3 deprecated</h3><p>å£°æ˜æ­¤æ¥å£å·²ç»è¢«å¼ƒç”¨ï¼Œå¯ä»¥åŒæ—¶åŠ æ³¨é‡Šæ³¨æ˜æ›¿ä»£æ¥å£ã€‚<br>å½“deployment targetç‰ˆæœ¬å·è®¾ç½®æˆå¤§äºæˆ–ç­‰äºæ–¹æ³•è¢«å¼ƒç”¨çš„ç‰ˆæœ¬å·æ—¶ï¼ŒXcodeä¼šç»™å‡ºè­¦å‘Šã€‚<br>ç¤ºä¾‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//æ³¨æ˜åºŸå¼ƒç±»</div><div class="line">NS_CLASS_DEPRECATED_IOS(2_0, 9_0, &quot;UIAlertView is deprecated. Use UIAlertController with a preferredStyle of UIAlertControllerStyleAlert instead&quot;)</div><div class="line">@interface UIAlertView : UIView</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//æ³¨æ˜åºŸå¼ƒAPI</div><div class="line">@interface UIViewController : UIResponder</div><div class="line">- (void)viewDidUnload NS_DEPRECATED_IOS(3_0,6_0);</div><div class="line">@end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//æ³¨æ˜åºŸå¼ƒæšä¸¾</div><div class="line">typedef NS_ENUM(NSInteger, UIStatusBarStyle) &#123;</div><div class="line">    UIStatusBarStyleDefault                                     = 0, // Dark content, for use on light backgrounds</div><div class="line">    UIStatusBarStyleLightContent     NS_ENUM_AVAILABLE_IOS(7_0) = 1, // Light content, for use on dark backgrounds</div><div class="line">    </div><div class="line">    UIStatusBarStyleBlackTranslucent NS_ENUM_DEPRECATED_IOS(2_0, 7_0, &quot;Use UIStatusBarStyleLightContent&quot;) = 1,</div><div class="line">    UIStatusBarStyleBlackOpaque      NS_ENUM_DEPRECATED_IOS(2_0, 7_0, &quot;Use UIStatusBarStyleLightContent&quot;) = 2,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>iOS10å¼€å§‹æä¾›äº†æ–°çš„deprecatedå®<code>API_DEPRECATED</code>å’Œ<code>API_DEPRECATED_WITH_REPLACEMENT</code>ã€‚å‰è€…å¯ä»¥æ³¨æ˜å¼ƒç”¨åŸå› ï¼Œåè€…å¯ä»¥æ³¨æ˜æ›¿ä»£æ¥å£ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">API_DEPRECATED(&quot;No longer supported&quot;, macos(10.4, 10.8))</div><div class="line">API_DEPRECATED(&quot;No longer supported&quot;, macos(10.4, 10.8), ios(2.0, 3.0), watchos(2.0, 3.0), tvos(9.0, 10.0))</div><div class="line"></div><div class="line">API_DEPRECATED_WITH_REPLACEMENT(&quot;-setName:&quot;, tvos(10.0, 10.4), ios(9.0, 10.0))</div><div class="line">API_DEPRECATED_WITH_REPLACEMENT(&quot;SomeClassName&quot;, macos(10.4, 10.6), watchos(2.0, 3.0))</div></pre></td></tr></table></figure>
<h2 id="10-é¢å¤–çš„ä¿®é¥°ç¬¦"><a href="#10-é¢å¤–çš„ä¿®é¥°ç¬¦" class="headerlink" title="10.é¢å¤–çš„ä¿®é¥°ç¬¦"></a><a name"keywords"=""></a>10.é¢å¤–çš„ä¿®é¥°ç¬¦</h2><h3 id="10-1-æ³›å‹"><a href="#10-1-æ³›å‹" class="headerlink" title="10.1 æ³›å‹"></a><a name"keywords-1"=""></a>10.1 æ³›å‹</h3><p>åœ¨å£°æ˜æ—¶ï¼Œå¯¹é›†åˆç±»å‹çš„å¯¹è±¡å¢åŠ æ³›å‹çš„ä¿®é¥°ï¼Œå°±å¯ä»¥å£°æ˜é›†åˆå†…å­˜å‚¨çš„æ•°æ®ç±»å‹ã€‚<br>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic, strong) NSMutableArray&lt;NSString *&gt; *myArray;</div></pre></td></tr></table></figure>
<p>å½“ä½ å‘<code>myArray</code>é‡Œæ”¾å…¥ä¸€ä¸ªé<code>NSString *</code>ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç»™å‡ºè­¦å‘Šã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@property(nonatomic, strong) NSMutableArray&lt;__kindof UIView *&gt; * viewArray;</div></pre></td></tr></table></figure>
<p><code>_kindof</code>åªé™å®šäº†å­˜å‚¨ç±»å‹ä¸º<code>UIView</code>ï¼Œå› æ­¤ä¹Ÿå¯ä»¥å­˜å‚¨<code>UIView</code>çš„å­ç±»ï¼Œä¾‹å¦‚<code>UIButton</code>ã€‚<br>æ›´è¯¦ç»†çš„ä»‹ç»ï¼Œå‚è€ƒ:<a href="https://my.oschina.net/u/2340880/blog/514804" target="_blank" rel="external">Objectiveâ€”Cè¯­è¨€çš„æ–°é­…åŠ›â€”â€”Nullabilityã€æ³›å‹é›†åˆä¸ç±»å‹å»¶æ‹“</a></p>
<h3 id="10-2-NS-REQUIRES-SUPER"><a href="#10-2-NS-REQUIRES-SUPER" class="headerlink" title="10.2 NS_REQUIRES_SUPER"></a><a name"keywords-2"=""></a>10.2 NS_REQUIRES_SUPER</h3><p><code>NS_REQUIRES_SUPER</code>å®ç”¨äºå£°æ˜å­ç±»åœ¨é‡è½½çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œéœ€è¦è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (void)viewWillAppear:(BOOL)animated NS_REQUIRES_SUPER;</div></pre></td></tr></table></figure>
<h3 id="10-3-NS-NOESCAPE"><a href="#10-3-NS-NOESCAPE" class="headerlink" title="10.3 NS_NOESCAPE"></a><a name"keywords-3"=""></a>10.3 NS_NOESCAPE</h3><p><code>NS_NOESCAPE</code>ç”¨äºä¿®é¥°æ–¹æ³•ä¸­çš„blockç±»å‹å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@interface NSArray: NSObject</div><div class="line">- (NSArray *)sortedArrayUsingComparator:(NSComparator NS_NOESCAPE)cmptr</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œ<code>cmptr</code>è¿™ä¸ªblockåœ¨<code>sortedArrayUsingComparator:</code>æ–¹æ³•è¿”å›ä¹‹å‰å°±ä¼šæ‰§è¡Œå®Œæ¯•ï¼Œè€Œä¸æ˜¯è¢«ä¿å­˜èµ·æ¥åœ¨ä¹‹åçš„æŸä¸ªæ—¶å€™å†æ‰§è¡Œã€‚<br>ç±»ä¼¼äºè¿™æ ·çš„å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (void)performWithLock:(NS_NOESCAPE void (^)())block &#123;  // exposed as @noescape to Swift</div><div class="line">    [myLock lock];</div><div class="line">    block();</div><div class="line">    [myLock unlock];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç¼–è¯‘å™¨çŸ¥é“ä¹‹åï¼Œå°±ä¼šç›¸åº”åœ°åšä¸€äº›ä¼˜åŒ–ï¼Œä¾‹å¦‚å»æ‰ä¸€äº›å¤šä½™çš„å¯¹<code>self</code>çš„æ•è·ã€retainã€releaseæ“ä½œã€‚å› ä¸ºblockçš„å­˜æ´»èŒƒå›´ä»…é™äºæœ¬æ–¹æ³•å†…ï¼Œæ²¡æœ‰å¿…è¦å†åœ¨blockå†…ä¿ç•™<code>self</code>äº†ã€‚<br>æ›´è¯¦ç»†çš„ä»‹ç»ï¼Œå‚è€ƒ<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0012-add-noescape-to-public-library-api.md" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
<h2 id="11-å†™æ³¨é‡Š"><a href="#11-å†™æ³¨é‡Š" class="headerlink" title="11.å†™æ³¨é‡Š"></a><a name="comment"></a>11.å†™æ³¨é‡Š</h2><p>å¤´æ–‡ä»¶å°±æ˜¯æ–‡æ¡£ï¼Œéœ€è¦è®©ä½¿ç”¨è€…å¿«é€ŸçŸ¥é“è¿™ä¸ªç±»çš„ä½œç”¨ã€‚ä¸€ä¸ªå¥½çš„æ–¹æ³•åå¯ä»¥è®©ä½¿ç”¨è€…å¿«é€Ÿç†è§£ï¼Œä½†å¤§éƒ¨åˆ†æ—¶å€™è¿˜æ˜¯éœ€è¦ç›¸åº”çš„æ³¨é‡Šã€‚<br>å†™å¥½æ ¼å¼åŒ–æ³¨é‡Šåï¼Œå½“å…‰æ ‡åœç•™åœ¨æ–¹æ³•åå’Œå±æ€§ä¸Šæ—¶ï¼Œåœ¨Xcodeå³ä¾§çš„Quick Helpæ é‡Œä¼šå‡ºç°æ³¨é‡Šå†…å®¹ï¼ŒæŒ‰ä½<code>option</code>å¹¶å•å‡»ï¼Œä¹Ÿä¼šå¼¹å‡ºæ³¨é‡Šæ¡†ã€‚</p>
<h3 id="11-1å•è¡Œæ³¨é‡Š"><a href="#11-1å•è¡Œæ³¨é‡Š" class="headerlink" title="11.1å•è¡Œæ³¨é‡Š"></a><a name="comment-1"></a>11.1å•è¡Œæ³¨é‡Š</h3><p>ç›´æ¥åœ¨æ–¹æ³•æˆ–è€…å±æ€§å£°æ˜çš„ä¸Šä¸€è¡Œä½¿ç”¨<code>///</code>ï¼Œåé¢åŠ æ³¨é‡Šï¼ŒåŒæ—¶å…¼å®¹Xcodeå’ŒappleDocã€‚Xcodeä¹Ÿæ”¯æŒ<code>//!</code>ï¼Œä½†æ˜¯appleDocä¸æ”¯æŒã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//SearchManagerBase.h</div><div class="line"></div><div class="line">///æœç´¢managerçš„åŸºç±»</div><div class="line">@interface SearchManagerBase : NSObject</div><div class="line">///æœç´¢çŠ¶æ€</div><div class="line">@property (nonatomic, readonly) NSInteger * state;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h3 id="11-2å¤šè¡Œæ³¨é‡Š"><a href="#11-2å¤šè¡Œæ³¨é‡Š" class="headerlink" title="11.2å¤šè¡Œæ³¨é‡Š"></a><a name="comment-2"></a>11.2å¤šè¡Œæ³¨é‡Š</h3><p>å¤šè¡Œæ³¨é‡Šä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> æ³¨é‡Šå†…å®¹</div><div class="line">*/</div></pre></td></tr></table></figure>
<p>Xcode8æä¾›äº†å¿«é€Ÿç”Ÿæˆæ ¼å¼åŒ–æ³¨é‡Šçš„å¿«æ·é”®ï¼š<code>option</code>+<code>command</code>+<code>/</code>ã€‚å¦‚æœæ–¹æ³•æœ‰å‚æ•°ï¼Œä¼šè‡ªåŠ¨æ·»åŠ @paramå…³é”®å­—ï¼Œç”¨äºæè¿°å¯¹åº”çš„å‚æ•°ã€‚<br>Appleæä¾›äº†å®˜æ–¹çš„headDocè¯­æ³•ï¼Œä½†æ˜¯å¾ˆå¤šéƒ½å·²ç»åœ¨Xcodeä¸­å¤±æ•ˆäº†ï¼Œè€Œä¸”æœ‰äº›å…³é”®å­—ä¹Ÿå’ŒappleDocä¸å…¼å®¹ã€‚ä¸‹é¢å‡ ç§åˆ—ä¸¾å‡ºäº†åœ¨Xcodeä¸­ä»ç„¶æœ‰æ•ˆçš„ä¸€äº›å…³é”®å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> æ¼”ç¤ºè‹¹æœheadDocçš„è¯­æ³•ã€‚è¿™é‡Œå¯ä»¥å†™æ–¹æ³•ç®€ä»‹</div><div class="line"> </div><div class="line"> @brief æ–¹æ³•çš„ç®€ä»‹(appleDocä¸æ”¯æŒæ­¤å…³é”®å­—)</div><div class="line"> @discussion æ–¹æ³•çš„è¯¦ç»†è¯´æ˜</div><div class="line"> </div><div class="line"> @code //ç¤ºä¾‹ä»£ç (è¿™ä¸ªåœ¨Xcodeé‡Œå¸¸ç”¨ï¼Œä½†æ˜¯appleDocä¸æ”¯æŒæ­¤å…³é”®å­—)</div><div class="line"> UIView *view;</div><div class="line"> @endcode</div><div class="line"> </div><div class="line"> @bug       å­˜åœ¨çš„bugçš„è¯´æ˜</div><div class="line"> @note      éœ€è¦æ³¨æ„çš„æç¤º</div><div class="line"> @warning   è­¦å‘Š</div><div class="line"> @since     iOS7.0</div><div class="line"> @exception æ–¹æ³•ä¼šæŠ›å‡ºçš„å¼‚å¸¸çš„è¯´æ˜</div><div class="line"> </div><div class="line"> @attention æ³¨æ„ï¼Œä»è¿™é‡Œå¼€å§‹å¾€ä¸‹çš„å…³é”®å­—ï¼ŒappleDocéƒ½ä¸æ”¯æŒ</div><div class="line"> @author    ç¼–å†™è€…</div><div class="line"> @copyright ç‰ˆæƒ</div><div class="line"> @date      æ—¥æœŸ</div><div class="line"> @invariant ä¸å˜é‡</div><div class="line"> @post      åç½®æ¡ä»¶</div><div class="line"> @pre       å‰ç½®æ¡ä»¶</div><div class="line"> @remarks   å¤‡æ³¨</div><div class="line"> @todo      todo text</div><div class="line"> @version   ç‰ˆæœ¬</div><div class="line"> */</div><div class="line">- (void)sampleMethod;</div></pre></td></tr></table></figure>
<p>åœ¨Xcodeä¸­ï¼Œå°±ä¼šæ˜¾ç¤ºä¸ºè¿™æ ·ï¼š<br><img src="http://upload-images.jianshu.io/upload_images/1865432-dfc9a9b1de31ec47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="comment.png"></p>
<h3 id="11-3-æšä¸¾æ³¨é‡Š"><a href="#11-3-æšä¸¾æ³¨é‡Š" class="headerlink" title="11.3 æšä¸¾æ³¨é‡Š"></a><a name="comment-3"></a>11.3 æšä¸¾æ³¨é‡Š</h3><p>å¦‚æœè¦ç»™æšä¸¾æ³¨é‡Šï¼Œéœ€è¦åœ¨æ¯ä¸ªæšä¸¾å€¼å‰æ³¨é‡Šï¼ŒæŒ‰ç…§å¦‚ä¸‹æ ¼å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">///æœç´¢çŠ¶æ€</div><div class="line">typedef NS_ENUM(NSInteger,SearchState) &#123;</div><div class="line">    ///æ²¡æœ‰å¼€å§‹æœç´¢</div><div class="line">    SearchStateNotSearch,</div><div class="line">    ///æœç´¢ä¸­</div><div class="line">    SearchStateSearching,</div><div class="line">    ///æœç´¢ç»“æŸ</div><div class="line">    SearchStateSearchFinished,</div><div class="line">    ///æœç´¢å¤±è´¥</div><div class="line">    SearchStateSearchFailed</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="11-4-å‡ ä¸ªæ³¨é‡Šçº¦å®š"><a href="#11-4-å‡ ä¸ªæ³¨é‡Šçº¦å®š" class="headerlink" title="11.4 å‡ ä¸ªæ³¨é‡Šçº¦å®š"></a><a name="comment-4"></a>11.4 å‡ ä¸ªæ³¨é‡Šçº¦å®š</h3><p>éœ€è¦æ³¨é‡Šçš„å†…å®¹ï¼š</p>
<ul>
<li>å°½é‡ä¸ºç±»æ·»åŠ æè¿°ï¼Œå³ä¾¿åªæœ‰ä¸€å¥è¯ã€‚</li>
<li>æ ‡æ˜æŸäº›å‚æ•°å’Œå±æ€§çš„é»˜è®¤å€¼ï¼Œæ¯”å¦‚è¶…æ—¶timeã€‚</li>
<li>å¦‚æœå±æ€§æ˜¯KVOå…¼å®¹çš„ï¼Œå³å¤–éƒ¨å¯ä»¥ä½¿ç”¨KVOç›‘å¬æ­¤å±æ€§ï¼Œåˆ™åœ¨å±æ€§æ³¨é‡Šé‡Œå£°æ˜ã€‚</li>
<li>å›è°ƒblockå‚æ•°éœ€è¦è¯´æ˜å›è°ƒæ‰€åœ¨çš„çº¿ç¨‹ï¼Œé¿å…è®©ä½¿ç”¨è€…åœ¨blocké‡Œè¿›è¡Œå¤šä½™çš„çº¿ç¨‹åˆ¤æ–­ã€‚</li>
<li>å¦‚æœéœ€è¦çš„è¯ï¼Œè¯´æ˜ä½¿ç”¨æ­¤APIéœ€è¦çš„å‰ç½®æ¡ä»¶ï¼Œé˜²æ­¢è¢«é”™è¯¯åœ°è°ƒç”¨ã€‚</li>
<li>å¯¹ä½¿ç”¨äº†method swizzlingçš„APIè¿›è¡Œç»Ÿä¸€å½¢å¼çš„æ ‡æ³¨ï¼Œæ–¹ä¾¿é‡åˆ°runtimeçš„bugæ—¶è¿›è¡Œæ’æŸ¥ã€‚</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://blog.sunnyxx.com/2014/04/13/objc_dig_interface/" target="_blank" rel="external">http://blog.sunnyxx.com/2014/04/13/objc_dig_interface/</a></li>
<li><a href="http://blog.sunnyxx.com/2015/06/12/objc-new-features-in-2015/" target="_blank" rel="external">http://blog.sunnyxx.com/2015/06/12/objc-new-features-in-2015/</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/10/ç§æœ‰API-iOS10 openURLæ–¹æ³•è·³è½¬åˆ°è®¾ç½®ç•Œé¢å¤±æ•ˆçš„è§£å†³æ–¹æ³•/" itemprop="url">
                  ç§æœ‰API-iOS10 openURLæ–¹æ³•è·³è½¬åˆ°è®¾ç½®ç•Œé¢å¤±æ•ˆçš„è§£å†³æ–¹æ³•
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2016-10-10T08:48:29+08:00" content="2016-10-10">
              2016-10-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ç§æœ‰API/" itemprop="url" rel="index">
                    <span itemprop="name">ç§æœ‰API</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/10/ç§æœ‰API-iOS10 openURLæ–¹æ³•è·³è½¬åˆ°è®¾ç½®ç•Œé¢å¤±æ•ˆçš„è§£å†³æ–¹æ³•/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/10/10/ç§æœ‰API-iOS10 openURLæ–¹æ³•è·³è½¬åˆ°è®¾ç½®ç•Œé¢å¤±æ•ˆçš„è§£å†³æ–¹æ³•/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>åœ¨iOS10ä¹‹å‰ï¼Œè·³è½¬åˆ°ç³»ç»Ÿè®¾ç½®ç•Œé¢çš„æŸä¸ªæŒ‡å®šç•Œé¢çš„æ–¹å¼å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//æ‰“å¼€å®šä½æœåŠ¡ç•Œé¢</div><div class="line">NSURL*url=[NSURL URLWithString:@&quot;prefs:root=Privacy&amp;path=LOCATION&quot;];</div><div class="line">if ([[UIApplication sharedApplication] canOpenURL:url]) &#123;</div><div class="line">    [[UIApplication sharedApplication] openURL:url];</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯åœ¨iOS10ä¸Šï¼Œè°ƒç”¨canOpenURL:æ‰“å¼€ç³»ç»Ÿè®¾ç½®ç•Œé¢æ—¶æ§åˆ¶å°ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼Œå¹¶ä¸”æ— æ³•è·³è½¬ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-canOpenURL: failed for URL: &quot;Prefs:root=Privacy&amp;path=LOCATION&quot; - error: &quot;The operation couldnâ€™t be completed. (OSStatus error -10814.)&quot;</div></pre></td></tr></table></figure></p>
<p>åŸå› æ˜¯iOS10åªå…è®¸å¦‚ä¸‹æ–¹å¼è·³è½¬åˆ°è®¾ç½®é‡Œè‡ªå·±appçš„ç•Œé¢ï¼Œå¯¹è·³è½¬åˆ°å…¶ä»–ç•Œé¢åšäº†é™åˆ¶ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[UIApplication sharedApplication] openURL:[NSURL URLWithString:UIApplicationOpenSettingsURLString]];</div></pre></td></tr></table></figure></p>
<h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><p>å¯ä»¥ä½¿ç”¨<code>MobileCoreServices.framework</code>é‡Œçš„ç§æœ‰API:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (BOOL)openSensitiveURL:(id)arg1 withOptions:(id)arg2;</div></pre></td></tr></table></figure></p>
<p>å¤´æ–‡ä»¶å‚è€ƒï¼š<a href="https://github.com/JaviSoto/iOS10-Runtime-Headers/blob/master/Frameworks/MobileCoreServices.framework/LSApplicationWorkspace.h" target="_blank" rel="external">LSApplicationWorkspace.h</a><br>ä½¿ç”¨æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//æ³¨æ„é¦–å­—æ¯æ”¹æˆäº†å¤§å†™ï¼Œprefs-&gt;Prefs</div><div class="line">NSURL*url=[NSURL URLWithString:@&quot;Prefs:root=Privacy&amp;path=LOCATION&quot;];</div><div class="line">Class LSApplicationWorkspace = NSClassFromString(@&quot;LSApplicationWorkspace&quot;);</div><div class="line">[[LSApplicationWorkspace performSelector:@selector(defaultWorkspace)] performSelector:@selector(openSensitiveURL:withOptions:) withObject:url withObject:nil];</div></pre></td></tr></table></figure></p>
<p><code>MobileCoreServices.framework</code>ä¸æ˜¯ç§æœ‰åº“ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨<code>performSelector:</code>å³å¯è°ƒç”¨ç§æœ‰APIã€‚</p>
<h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ul>
<li>iOS10çš„ç³»ç»ŸURLSchemeæ”¹æˆäº†é¦–å­—æ¯å¤§å†™ï¼Œä½¿ç”¨å°å†™çš„æ–¹å¼ä¼šæ— æ³•æ‰“å¼€ã€‚</li>
<li>ä½¿ç”¨ç§æœ‰APIçš„appæ— æ³•é€šè¿‡App Storeå®¡æ ¸ã€‚ä½ ä¹Ÿå¯ä»¥å°è¯•æŠŠç§æœ‰ç±»åå’Œselectorå­—ç¬¦ä¸²æ··æ·†ä¸€ä¸‹ï¼Œç»•è¿‡å®¡æ ¸ã€‚ä¾‹å¦‚<a href="http://blog.csdn.net/wenmingzheng/article/details/50475671" target="_blank" rel="external">è¿™ä½ä»å…„</a>ç”¨ASCIIæ··æ·†çš„æ–¹æ³•ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (UIView *)statusBarView &#123; </div><div class="line">    UIView *statusBar = nil; </div><div class="line">    NSData *data = [NSData dataWithBytes:(unsigned char [])&#123;0x73, 0x74, 0x61, 0x74, 0x75, 0x73, 0x42, 0x61, 0x72&#125; length:9]; </div><div class="line">    NSString *key = [[NSString alloc] initWithData:data encoding:NSASCIIStringEncoding]; </div><div class="line">    id object = [UIApplication sharedApplication]; </div><div class="line">    if ([object respondsToSelector:NSSelectorFromString(key)]) &#123;</div><div class="line">        statusBar = [object valueForKey:key]; </div><div class="line">    &#125;</div><div class="line">    return statusBar; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸è¿‡ï¼Œè¿˜æ˜¯ä¸å»ºè®®ä½¿ç”¨ç§æœ‰APIï¼Œå› ä¸ºå®ƒæ˜¯ä¸å¯é çš„ã€‚ä¹Ÿè®¸æŸå¤©è‹¹æœå°±æŠŠå®ƒç§»é™¤äº†ã€‚</p>
<h4 id="update"><a href="#update" class="headerlink" title="update:"></a><em>update:</em></h4><ul>
<li>è¿˜æœ‰ä¸€æ­¥é—æ¼äº†ï¼Œappéœ€è¦æ·»åŠ ä¸€ä¸ª<code>Prefs</code>çš„URL Schemesï¼Œå³æ·»åŠ åˆ°<code>info.plist</code>çš„<code>LSApplicationQueriesSchemes</code>é¡¹ä¸­ã€‚</li>
</ul>
<h4 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h4><p><a href="http://stackoverflow.com/a/39102075/6380485" target="_blank" rel="external">http://stackoverflow.com/a/39102075/6380485</a><br><a href="https://www.zhihu.com/question/50635906/answer/125195317" target="_blank" rel="external">https://www.zhihu.com/question/50635906/answer/125195317</a><br><a href="https://github.com/cyanzhong/app-tutorials/blob/master/schemes.md" target="_blank" rel="external">iOS10ç³»ç»ŸURLScheme</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          

          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="zuik" />
          <p class="site-author-name" itemprop="name">zuik</p>
          <p class="site-description motion-element" itemprop="description">ğŸ¼</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zuik</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

<script>
(function(){
var bp = document.createElement('script');
bp.src = '//push.zhanzhang.baidu.com/push.js';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(bp, s);
})();
</script>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'zuikyo';
      var disqus_identifier = 'index.html';
      var disqus_title = "";
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  




  
  

  

  

  

</body>
</html>
